---
src       : src/plfa/Compositional.lagda
title     : "Compositional: The denotational semantics is compositional"
layout    : page
prev      : /Denotational/
permalink : /Compositional/
next      : /Soundness/
---

<pre class="Agda">{% raw %}<a id="192" class="Keyword">module</a> <a id="199" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}" class="Module">plfa.Compositional</a> <a id="218" class="Keyword">where</a>{% endraw %}</pre>

## Introduction

In this chapter we prove that the denotational semantics is compositional,
which means we fill in the ellipses in the following equations.

    ℰ (ƛ M) ≃ ... ℰ M ...
    ℰ (M · N) ≃ ... ℰ M ... ℰ N ...

## Imports

<pre class="Agda">{% raw %}<a id="481" class="Keyword">open</a> <a id="486" class="Keyword">import</a> <a id="493" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}" class="Module">plfa.Untyped</a>
  <a id="508" class="Keyword">using</a> <a id="514" class="Symbol">(</a><a id="515" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2980" class="Datatype">Context</a><a id="522" class="Symbol">;</a> <a id="524" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">_,_</a><a id="527" class="Symbol">;</a> <a id="529" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="530" class="Symbol">;</a> <a id="532" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3365" class="Datatype Operator">_∋_</a><a id="535" class="Symbol">;</a> <a id="537" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">_⊢_</a><a id="540" class="Symbol">;</a> <a id="542" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4186" class="InductiveConstructor Operator">`_</a><a id="544" class="Symbol">;</a> <a id="546" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ_</a><a id="548" class="Symbol">;</a> <a id="550" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">_·_</a><a id="553" class="Symbol">)</a>
<a id="555" class="Keyword">open</a> <a id="560" class="Keyword">import</a> <a id="567" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}" class="Module">plfa.Denotational</a>
  <a id="587" class="Keyword">using</a> <a id="593" class="Symbol">(</a><a id="594" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4000" class="Datatype">Value</a><a id="599" class="Symbol">;</a> <a id="601" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">_↦_</a><a id="604" class="Symbol">;</a> <a id="606" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7407" class="Function Operator">_`,_</a><a id="610" class="Symbol">;</a> <a id="612" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">_⊔_</a><a id="615" class="Symbol">;</a> <a id="617" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4020" class="InductiveConstructor">⊥</a><a id="618" class="Symbol">;</a> <a id="620" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">_⊑_</a><a id="623" class="Symbol">;</a> <a id="625" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9520" class="Datatype Operator">_⊢_↓_</a><a id="630" class="Symbol">;</a> <a id="632" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8098" class="Function">nth</a><a id="635" class="Symbol">;</a>
         <a id="646" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4406" class="InductiveConstructor">Bot⊑</a><a id="650" class="Symbol">;</a> <a id="652" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4742" class="InductiveConstructor">Fun⊑</a><a id="656" class="Symbol">;</a> <a id="658" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4430" class="InductiveConstructor">ConjL⊑</a><a id="664" class="Symbol">;</a> <a id="666" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4520" class="InductiveConstructor">ConjR1⊑</a><a id="673" class="Symbol">;</a> <a id="675" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4594" class="InductiveConstructor">ConjR2⊑</a><a id="682" class="Symbol">;</a> <a id="684" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4856" class="InductiveConstructor">Dist⊑</a><a id="689" class="Symbol">;</a> <a id="691" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a><a id="696" class="Symbol">;</a> <a id="698" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4668" class="InductiveConstructor">Trans⊑</a><a id="704" class="Symbol">;</a> <a id="706" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#6196" class="Function">Dist⊔↦⊔</a><a id="713" class="Symbol">;</a>
         <a id="724" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9574" class="InductiveConstructor">var</a><a id="727" class="Symbol">;</a> <a id="729" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9791" class="InductiveConstructor">↦-intro</a><a id="736" class="Symbol">;</a> <a id="738" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9653" class="InductiveConstructor">↦-elim</a><a id="744" class="Symbol">;</a> <a id="746" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a><a id="753" class="Symbol">;</a> <a id="755" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9915" class="InductiveConstructor">⊥-intro</a><a id="762" class="Symbol">;</a> <a id="764" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a><a id="767" class="Symbol">;</a>
         <a id="778" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#25757" class="Function">up-env</a><a id="784" class="Symbol">;</a> <a id="786" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a><a id="787" class="Symbol">;</a> <a id="789" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">_≃_</a><a id="792" class="Symbol">;</a> <a id="794" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18484" class="Function">≃-sym</a><a id="799" class="Symbol">;</a> <a id="801" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a><a id="811" class="Symbol">;</a> <a id="813" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a><a id="816" class="Symbol">)</a>
<a id="818" class="Keyword">open</a> <a id="823" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19072" class="Module">plfa.Denotational.≃-Reasoning</a>

<a id="854" class="Keyword">open</a> <a id="859" class="Keyword">import</a> <a id="866" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html" class="Module">Data.Product</a> <a id="879" class="Keyword">using</a> <a id="885" class="Symbol">(</a><a id="886" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">_×_</a><a id="889" class="Symbol">;</a> <a id="891" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="892" class="Symbol">;</a> <a id="894" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ-syntax</a><a id="902" class="Symbol">;</a> <a id="904" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#881" class="Function">∃</a><a id="905" class="Symbol">;</a> <a id="907" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#942" class="Function">∃-syntax</a><a id="915" class="Symbol">;</a> <a id="917" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="922" class="Symbol">;</a> <a id="924" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="929" class="Symbol">)</a>
  <a id="933" class="Keyword">renaming</a> <a id="942" class="Symbol">(</a><a id="943" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="947" class="Symbol">to</a> <a id="950" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="955" class="Symbol">)</a>
<a id="957" class="Keyword">open</a> <a id="962" class="Keyword">import</a> <a id="969" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.html" class="Module">Data.Sum</a> <a id="978" class="Keyword">using</a> <a id="984" class="Symbol">(</a><a id="985" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#419" class="Datatype Operator">_⊎_</a><a id="988" class="Symbol">;</a> <a id="990" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a><a id="994" class="Symbol">;</a> <a id="996" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a><a id="1000" class="Symbol">)</a>
<a id="1002" class="Keyword">open</a> <a id="1007" class="Keyword">import</a> <a id="1014" href="https://agda.github.io/agda-stdlib/v0.17/Data.Unit.html" class="Module">Data.Unit</a> <a id="1024" class="Keyword">using</a> <a id="1030" class="Symbol">(</a><a id="1031" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Unit.html#69" class="Record">⊤</a><a id="1032" class="Symbol">;</a> <a id="1034" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Unit.html#106" class="InductiveConstructor">tt</a><a id="1036" class="Symbol">)</a>{% endraw %}</pre>

## Equation for lambda abstraction

Regarding the first equation

    ℰ (ƛ M) ≃ ... ℰ M ...
    
we need to define a function that maps a `Denotation (Γ , ★)` to a
`Denotation Γ`. This function, let us name it `ℱ`, should mimic the
non-recursive part of the semantics when applied to a lambda term.  In
particular, we need to consider the rules `↦-intro`, `⊥-intro`, and
`⊔-intro`. So `ℱ` has three parameters, the denotation `D` of the
subterm `M`, an environment `γ`, and a value `v`.  If we define `ℱ` by
recursion on the value `v`, then it matches up nicely with the three
rules `↦-intro`, `⊥-intro`, and `⊔-intro`.

<pre class="Agda">{% raw %}<a id="ℱ"></a><a id="1684" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="1686" class="Symbol">:</a> <a id="1688" class="Symbol">∀{</a><a id="1690" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1690" class="Bound">Γ</a><a id="1691" class="Symbol">}</a> <a id="1693" class="Symbol">→</a> <a id="1695" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="1706" class="Symbol">(</a><a id="1707" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1690" class="Bound">Γ</a> <a id="1709" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="1711" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="1712" class="Symbol">)</a> <a id="1714" class="Symbol">→</a> <a id="1716" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="1727" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1690" class="Bound">Γ</a>
<a id="1729" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="1731" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1731" class="Bound">D</a> <a id="1733" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1733" class="Bound">γ</a> <a id="1735" class="Symbol">(</a><a id="1736" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1736" class="Bound">v</a> <a id="1738" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="1740" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1740" class="Bound">w</a><a id="1741" class="Symbol">)</a> <a id="1743" class="Symbol">=</a> <a id="1745" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1731" class="Bound">D</a> <a id="1747" class="Symbol">(</a><a id="1748" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1733" class="Bound">γ</a> <a id="1750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7407" class="Function Operator">`,</a> <a id="1753" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1736" class="Bound">v</a><a id="1754" class="Symbol">)</a> <a id="1756" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1740" class="Bound">w</a>
<a id="1758" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="1760" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1760" class="Bound">D</a> <a id="1762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1762" class="Bound">γ</a> <a id="1764" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4020" class="InductiveConstructor">⊥</a> <a id="1766" class="Symbol">=</a> <a id="1768" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Unit.html#69" class="Record">⊤</a>
<a id="1770" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="1772" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1772" class="Bound">D</a> <a id="1774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1774" class="Bound">γ</a> <a id="1776" class="Symbol">(</a><a id="1777" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1777" class="Bound">u</a> <a id="1779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="1781" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1781" class="Bound">v</a><a id="1782" class="Symbol">)</a> <a id="1784" class="Symbol">=</a> <a id="1786" class="Symbol">(</a><a id="1787" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="1789" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1772" class="Bound">D</a> <a id="1791" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1774" class="Bound">γ</a> <a id="1793" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1777" class="Bound">u</a><a id="1794" class="Symbol">)</a> <a id="1796" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a> <a id="1798" class="Symbol">(</a><a id="1799" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="1801" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1772" class="Bound">D</a> <a id="1803" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1774" class="Bound">γ</a> <a id="1805" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1781" class="Bound">v</a><a id="1806" class="Symbol">)</a>{% endraw %}</pre>

Using this `ℱ`, we hope to prove that

    ℰ (ƛ N) ≃ ℱ (ℰ N)

The function `ℱ` is preserved when going from a larger value `v` to a
smaller value `u`. The proof is a straightforward induction on the
derivation of `u ⊑ v`, using the `up-env` lemma in the case for the
`Fun⊑` rule.

<pre class="Agda">{% raw %}<a id="sub-ℱ"></a><a id="2114" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2120" class="Symbol">:</a> <a id="2122" class="Symbol">∀{</a><a id="2124" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2124" class="Bound">Γ</a><a id="2125" class="Symbol">}{</a><a id="2127" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2127" class="Bound">N</a> <a id="2129" class="Symbol">:</a> <a id="2131" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2124" class="Bound">Γ</a> <a id="2133" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="2135" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="2137" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="2139" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="2140" class="Symbol">}{</a><a id="2142" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2142" class="Bound">γ</a> <a id="2144" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2144" class="Bound">v</a> <a id="2146" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2146" class="Bound">u</a><a id="2147" class="Symbol">}</a>
      <a id="2155" class="Symbol">→</a> <a id="2157" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="2159" class="Symbol">(</a><a id="2160" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="2162" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2127" class="Bound">N</a><a id="2163" class="Symbol">)</a> <a id="2165" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2142" class="Bound">γ</a> <a id="2167" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2144" class="Bound">v</a>
      <a id="2175" class="Symbol">→</a> <a id="2177" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2146" class="Bound">u</a> <a id="2179" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">⊑</a> <a id="2181" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2144" class="Bound">v</a>
        <a id="2191" class="Comment">------------</a>
      <a id="2210" class="Symbol">→</a> <a id="2212" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="2214" class="Symbol">(</a><a id="2215" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="2217" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2127" class="Bound">N</a><a id="2218" class="Symbol">)</a> <a id="2220" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2142" class="Bound">γ</a> <a id="2222" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2146" class="Bound">u</a>
<a id="2224" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2230" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2230" class="Bound">d</a> <a id="2232" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4406" class="InductiveConstructor">Bot⊑</a> <a id="2237" class="Symbol">=</a> <a id="2239" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Unit.html#106" class="InductiveConstructor">tt</a>
<a id="2242" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2248" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2248" class="Bound">d</a> <a id="2250" class="Symbol">(</a><a id="2251" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4742" class="InductiveConstructor">Fun⊑</a> <a id="2256" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2256" class="Bound">lt</a> <a id="2259" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2259" class="Bound">lt′</a><a id="2262" class="Symbol">)</a> <a id="2264" class="Symbol">=</a> <a id="2266" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="2270" class="Symbol">(</a><a id="2271" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#25757" class="Function">up-env</a> <a id="2278" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2248" class="Bound">d</a> <a id="2280" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2256" class="Bound">lt</a><a id="2282" class="Symbol">)</a> <a id="2284" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2259" class="Bound">lt′</a>
<a id="2288" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2294" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2294" class="Bound">d</a> <a id="2296" class="Symbol">(</a><a id="2297" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4430" class="InductiveConstructor">ConjL⊑</a> <a id="2304" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2304" class="Bound">lt</a> <a id="2307" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2307" class="Bound">lt₁</a><a id="2310" class="Symbol">)</a> <a id="2312" class="Symbol">=</a> <a id="2314" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="2316" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2322" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2294" class="Bound">d</a> <a id="2324" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2304" class="Bound">lt</a> <a id="2327" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="2329" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2335" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2294" class="Bound">d</a> <a id="2337" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2307" class="Bound">lt₁</a> <a id="2341" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="2343" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2349" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2349" class="Bound">d</a> <a id="2351" class="Symbol">(</a><a id="2352" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4520" class="InductiveConstructor">ConjR1⊑</a> <a id="2360" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2360" class="Bound">lt</a><a id="2362" class="Symbol">)</a> <a id="2364" class="Symbol">=</a> <a id="2366" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2372" class="Symbol">(</a><a id="2373" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a> <a id="2379" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2349" class="Bound">d</a><a id="2380" class="Symbol">)</a> <a id="2382" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2360" class="Bound">lt</a>
<a id="2385" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2391" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2391" class="Bound">d</a> <a id="2393" class="Symbol">(</a><a id="2394" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4594" class="InductiveConstructor">ConjR2⊑</a> <a id="2402" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2402" class="Bound">lt</a><a id="2404" class="Symbol">)</a> <a id="2406" class="Symbol">=</a> <a id="2408" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2414" class="Symbol">(</a><a id="2415" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a> <a id="2421" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2391" class="Bound">d</a><a id="2422" class="Symbol">)</a> <a id="2424" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2402" class="Bound">lt</a>
<a id="2427" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2433" class="Symbol">{</a><a id="2434" class="Argument">v</a> <a id="2436" class="Symbol">=</a> <a id="2438" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2438" class="Bound">v₁</a> <a id="2441" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="2443" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2443" class="Bound">v₂</a> <a id="2446" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="2448" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2438" class="Bound">v₁</a> <a id="2451" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="2453" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2453" class="Bound">v₃</a><a id="2455" class="Symbol">}</a> <a id="2457" class="Symbol">{</a><a id="2458" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2438" class="Bound">v₁</a> <a id="2461" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="2463" class="Symbol">(</a><a id="2464" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2443" class="Bound">v₂</a> <a id="2467" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="2469" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2453" class="Bound">v₃</a><a id="2471" class="Symbol">)}</a> <a id="2474" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="2476" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2476" class="Bound">N2</a> <a id="2479" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="2481" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2481" class="Bound">N3</a> <a id="2484" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="2486" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4856" class="InductiveConstructor">Dist⊑</a> <a id="2492" class="Symbol">=</a>
   <a id="2497" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a> <a id="2505" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2476" class="Bound">N2</a> <a id="2508" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2481" class="Bound">N3</a>
<a id="2511" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2517" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2517" class="Bound">d</a> <a id="2519" class="Symbol">(</a><a id="2520" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4668" class="InductiveConstructor">Trans⊑</a> <a id="2527" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2527" class="Bound">x₁</a> <a id="2530" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2530" class="Bound">x₂</a><a id="2532" class="Symbol">)</a> <a id="2534" class="Symbol">=</a> <a id="2536" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2542" class="Symbol">(</a><a id="2543" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="2549" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2517" class="Bound">d</a> <a id="2551" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2530" class="Bound">x₂</a><a id="2553" class="Symbol">)</a> <a id="2555" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2527" class="Bound">x₁</a>{% endraw %}</pre>

[PLW:
  If denotations were strengthened to be downward closed,
  we could rewrite the signature replacing (ℰ N) by d : Denotation (Γ , ★)]
  
With this subsumption property in hand, we can prove the forward
direction of the semantic equation for lambda.  The proof is by
induction on the semantics, using `sub-ℱ` in the case for the `sub`
rule.

<pre class="Agda">{% raw %}<a id="ℰƛ→ℱℰ"></a><a id="2930" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="2936" class="Symbol">:</a> <a id="2938" class="Symbol">∀{</a><a id="2940" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2940" class="Bound">Γ</a><a id="2941" class="Symbol">}{</a><a id="2943" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2943" class="Bound">γ</a> <a id="2945" class="Symbol">:</a> <a id="2947" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="2951" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2940" class="Bound">Γ</a><a id="2952" class="Symbol">}{</a><a id="2954" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2954" class="Bound">N</a> <a id="2956" class="Symbol">:</a> <a id="2958" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2940" class="Bound">Γ</a> <a id="2960" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="2962" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="2964" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="2966" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="2967" class="Symbol">}{</a><a id="2969" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2969" class="Bound">v</a> <a id="2971" class="Symbol">:</a> <a id="2973" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4000" class="Datatype">Value</a><a id="2978" class="Symbol">}</a>
        <a id="2988" class="Symbol">→</a> <a id="2990" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="2992" class="Symbol">(</a><a id="2993" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="2995" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2954" class="Bound">N</a><a id="2996" class="Symbol">)</a> <a id="2998" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2943" class="Bound">γ</a> <a id="3000" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2969" class="Bound">v</a>
          <a id="3012" class="Comment">------------</a>
        <a id="3033" class="Symbol">→</a> <a id="3035" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="3037" class="Symbol">(</a><a id="3038" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="3040" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2954" class="Bound">N</a><a id="3041" class="Symbol">)</a> <a id="3043" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2943" class="Bound">γ</a> <a id="3045" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2969" class="Bound">v</a>
<a id="3047" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3053" class="Symbol">(</a><a id="3054" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9791" class="InductiveConstructor">↦-intro</a> <a id="3062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3062" class="Bound">d</a><a id="3063" class="Symbol">)</a> <a id="3065" class="Symbol">=</a> <a id="3067" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3062" class="Bound">d</a>
<a id="3069" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3075" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9915" class="InductiveConstructor">⊥-intro</a> <a id="3083" class="Symbol">=</a> <a id="3085" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Unit.html#106" class="InductiveConstructor">tt</a>
<a id="3088" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3094" class="Symbol">(</a><a id="3095" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a> <a id="3103" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3103" class="Bound">d₁</a> <a id="3106" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3106" class="Bound">d₂</a><a id="3108" class="Symbol">)</a> <a id="3110" class="Symbol">=</a> <a id="3112" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="3114" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3120" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3103" class="Bound">d₁</a> <a id="3123" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="3125" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3131" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3106" class="Bound">d₂</a> <a id="3134" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="3136" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3142" class="Symbol">(</a><a id="3143" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="3147" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3147" class="Bound">d</a> <a id="3149" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3149" class="Bound">lt</a><a id="3151" class="Symbol">)</a> <a id="3153" class="Symbol">=</a> <a id="3155" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2114" class="Function">sub-ℱ</a> <a id="3161" class="Symbol">(</a><a id="3162" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="3168" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3147" class="Bound">d</a><a id="3169" class="Symbol">)</a> <a id="3171" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3149" class="Bound">lt</a>{% endraw %}</pre>

The "inversion lemma" for lambda abstraction is a special case of the
above. The inversion lemma is useful in proving that denotations are
preserved by reduction.

<pre class="Agda">{% raw %}<a id="lambda-inversion"></a><a id="3363" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3363" class="Function">lambda-inversion</a> <a id="3380" class="Symbol">:</a> <a id="3382" class="Symbol">∀{</a><a id="3384" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3384" class="Bound">Γ</a><a id="3385" class="Symbol">}{</a><a id="3387" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3387" class="Bound">γ</a> <a id="3389" class="Symbol">:</a> <a id="3391" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="3395" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3384" class="Bound">Γ</a><a id="3396" class="Symbol">}{</a><a id="3398" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3398" class="Bound">N</a> <a id="3400" class="Symbol">:</a> <a id="3402" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3384" class="Bound">Γ</a> <a id="3404" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="3406" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="3408" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="3410" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="3411" class="Symbol">}{</a><a id="3413" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3413" class="Bound">v₁</a> <a id="3416" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3416" class="Bound">v₂</a> <a id="3419" class="Symbol">:</a> <a id="3421" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4000" class="Datatype">Value</a><a id="3426" class="Symbol">}</a>
  <a id="3430" class="Symbol">→</a> <a id="3432" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3387" class="Bound">γ</a> <a id="3434" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9520" class="Datatype Operator">⊢</a> <a id="3436" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="3438" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3398" class="Bound">N</a> <a id="3440" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9520" class="Datatype Operator">↓</a> <a id="3442" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3413" class="Bound">v₁</a> <a id="3445" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="3447" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3416" class="Bound">v₂</a>
    <a id="3454" class="Comment">-----------------</a>
  <a id="3474" class="Symbol">→</a> <a id="3476" class="Symbol">(</a><a id="3477" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3387" class="Bound">γ</a> <a id="3479" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7407" class="Function Operator">`,</a> <a id="3482" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3413" class="Bound">v₁</a><a id="3484" class="Symbol">)</a> <a id="3486" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9520" class="Datatype Operator">⊢</a> <a id="3488" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3398" class="Bound">N</a> <a id="3490" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9520" class="Datatype Operator">↓</a> <a id="3492" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3416" class="Bound">v₂</a>
<a id="3495" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3363" class="Function">lambda-inversion</a><a id="3511" class="Symbol">{</a><a id="3512" class="Argument">v₁</a> <a id="3515" class="Symbol">=</a> <a id="3517" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3517" class="Bound">v₁</a><a id="3519" class="Symbol">}{</a><a id="3521" class="Argument">v₂</a> <a id="3524" class="Symbol">=</a> <a id="3526" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3526" class="Bound">v₂</a><a id="3528" class="Symbol">}</a> <a id="3530" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3530" class="Bound">d</a> <a id="3532" class="Symbol">=</a> <a id="3534" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a><a id="3539" class="Symbol">{</a><a id="3540" class="Argument">v</a> <a id="3542" class="Symbol">=</a> <a id="3544" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3517" class="Bound">v₁</a> <a id="3547" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="3549" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3526" class="Bound">v₂</a><a id="3551" class="Symbol">}</a> <a id="3553" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3530" class="Bound">d</a>{% endraw %}</pre>

The backward direction of the semantic equation for lambda is even
easier to prove than the forward direction. We proceed by induction on
the value v.

<pre class="Agda">{% raw %}<a id="ℱℰ→ℰƛ"></a><a id="3732" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="3738" class="Symbol">:</a> <a id="3740" class="Symbol">∀{</a><a id="3742" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3742" class="Bound">Γ</a><a id="3743" class="Symbol">}{</a><a id="3745" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3745" class="Bound">γ</a> <a id="3747" class="Symbol">:</a> <a id="3749" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="3753" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3742" class="Bound">Γ</a><a id="3754" class="Symbol">}{</a><a id="3756" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3756" class="Bound">N</a> <a id="3758" class="Symbol">:</a> <a id="3760" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3742" class="Bound">Γ</a> <a id="3762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="3764" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="3766" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="3768" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="3769" class="Symbol">}{</a><a id="3771" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3771" class="Bound">v</a> <a id="3773" class="Symbol">:</a> <a id="3775" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4000" class="Datatype">Value</a><a id="3780" class="Symbol">}</a>
        <a id="3790" class="Symbol">→</a> <a id="3792" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="3794" class="Symbol">(</a><a id="3795" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="3797" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3756" class="Bound">N</a><a id="3798" class="Symbol">)</a> <a id="3800" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3745" class="Bound">γ</a> <a id="3802" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3771" class="Bound">v</a>
          <a id="3814" class="Comment">------------</a>
        <a id="3835" class="Symbol">→</a> <a id="3837" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="3839" class="Symbol">(</a><a id="3840" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="3842" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3756" class="Bound">N</a><a id="3843" class="Symbol">)</a> <a id="3845" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3745" class="Bound">γ</a> <a id="3847" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3771" class="Bound">v</a>
<a id="3849" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="3855" class="Symbol">{</a><a id="3856" class="Argument">v</a> <a id="3858" class="Symbol">=</a> <a id="3860" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4020" class="InductiveConstructor">⊥</a><a id="3861" class="Symbol">}</a> <a id="3863" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3863" class="Bound">d</a> <a id="3865" class="Symbol">=</a> <a id="3867" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9915" class="InductiveConstructor">⊥-intro</a>
<a id="3875" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="3881" class="Symbol">{</a><a id="3882" class="Argument">v</a> <a id="3884" class="Symbol">=</a> <a id="3886" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3886" class="Bound">v₁</a> <a id="3889" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="3891" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3891" class="Bound">v₂</a><a id="3893" class="Symbol">}</a> <a id="3895" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3895" class="Bound">d</a> <a id="3897" class="Symbol">=</a> <a id="3899" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9791" class="InductiveConstructor">↦-intro</a> <a id="3907" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3895" class="Bound">d</a>
<a id="3909" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="3915" class="Symbol">{</a><a id="3916" class="Argument">v</a> <a id="3918" class="Symbol">=</a> <a id="3920" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3920" class="Bound">v₁</a> <a id="3923" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="3925" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3925" class="Bound">v₂</a><a id="3927" class="Symbol">}</a> <a id="3929" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="3931" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3931" class="Bound">d1</a> <a id="3934" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="3936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3936" class="Bound">d2</a> <a id="3939" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="3941" class="Symbol">=</a> <a id="3943" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a> <a id="3951" class="Symbol">(</a><a id="3952" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="3958" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3931" class="Bound">d1</a><a id="3960" class="Symbol">)</a> <a id="3962" class="Symbol">(</a><a id="3963" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="3969" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3936" class="Bound">d2</a><a id="3971" class="Symbol">)</a>{% endraw %}</pre>

So indeed, the denotational semantics is compositional with respect
to lambda abstraction, as witnessed by the function `ℱ`.

<pre class="Agda">{% raw %}<a id="lam-equiv"></a><a id="4124" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4124" class="Function">lam-equiv</a> <a id="4134" class="Symbol">:</a> <a id="4136" class="Symbol">∀{</a><a id="4138" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4138" class="Bound">Γ</a><a id="4139" class="Symbol">}{</a><a id="4141" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4141" class="Bound">N</a> <a id="4143" class="Symbol">:</a> <a id="4145" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4138" class="Bound">Γ</a> <a id="4147" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="4149" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="4151" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="4153" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="4154" class="Symbol">}</a>
          <a id="4166" class="Symbol">→</a> <a id="4168" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="4170" class="Symbol">(</a><a id="4171" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="4173" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4141" class="Bound">N</a><a id="4174" class="Symbol">)</a> <a id="4176" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="4178" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="4180" class="Symbol">(</a><a id="4181" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="4183" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4141" class="Bound">N</a><a id="4184" class="Symbol">)</a>
<a id="4186" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4124" class="Function">lam-equiv</a> <a id="4196" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4196" class="Bound">γ</a> <a id="4198" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4198" class="Bound">v</a> <a id="4200" class="Symbol">=</a> <a id="4202" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="4204" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#2930" class="Function">ℰƛ→ℱℰ</a> <a id="4210" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="4212" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#3732" class="Function">ℱℰ→ℰƛ</a> <a id="4218" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>{% endraw %}</pre>


## Equation for function application

Next we fill in the ellipses for the equation concerning function
application.

    ℰ (M · N) ≃ ... ℰ M ... ℰ N ...

For this we need to define a function that takes two denotations, both
in context `Γ`, and produces another one in context `Γ`. This
function, let us name it `●`, needs to mimic the non-recursive aspects
of the semantics of an application `L · M`.  We cannot proceed as
easily as for `ℱ` and define the function by recursion on value `v`
because, for example, the rule `↦-elim` applies to any value. Instead
we shall define `●` in a way that directly deals with the `↦-elim` and
`⊥-intro` rules but ignores `⊔-intro`. This makes the forward
direction of the proof more difficult, and the case for `⊔-intro`
demonstrates why the `Dist⊑` rule is important.

So we define the application of `D₁` to `D₂`, written `D₁ ● D₂`, to include
any value `w` equivalent to `⊥`, for the `⊥-intro` rule, and to include any
value `w` that is the output of an entry `v ↦ w` in `D₁`, provided the
input `v` is in `D₂`, for the `↦-elim` rule.

<pre class="Agda">{% raw %}<a id="5326" class="Keyword">infixl</a> <a id="5333" class="Number">7</a> <a id="5335" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">_●_</a>

<a id="_●_"></a><a id="5340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">_●_</a> <a id="5344" class="Symbol">:</a> <a id="5346" class="Symbol">∀{</a><a id="5348" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5348" class="Bound">Γ</a><a id="5349" class="Symbol">}</a> <a id="5351" class="Symbol">→</a> <a id="5353" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="5364" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5348" class="Bound">Γ</a> <a id="5366" class="Symbol">→</a> <a id="5368" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="5379" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5348" class="Bound">Γ</a> <a id="5381" class="Symbol">→</a> <a id="5383" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="5394" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5348" class="Bound">Γ</a>
<a id="5396" class="Symbol">(</a><a id="5397" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5397" class="Bound">D₁</a> <a id="5400" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="5402" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5402" class="Bound">D₂</a><a id="5404" class="Symbol">)</a> <a id="5406" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5406" class="Bound">γ</a> <a id="5408" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5408" class="Bound">w</a> <a id="5410" class="Symbol">=</a> <a id="5412" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5408" class="Bound">w</a> <a id="5414" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">⊑</a> <a id="5416" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4020" class="InductiveConstructor">⊥</a> <a id="5418" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#419" class="Datatype Operator">⊎</a> <a id="5420" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="5423" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5423" class="Bound">v</a> <a id="5425" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="5427" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4000" class="Datatype">Value</a> <a id="5433" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a><a id="5434" class="Symbol">(</a> <a id="5436" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5397" class="Bound">D₁</a> <a id="5439" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5406" class="Bound">γ</a> <a id="5441" class="Symbol">(</a><a id="5442" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5423" class="Bound">v</a> <a id="5444" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="5446" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5408" class="Bound">w</a><a id="5447" class="Symbol">)</a> <a id="5449" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a> <a id="5451" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5402" class="Bound">D₂</a> <a id="5454" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5406" class="Bound">γ</a> <a id="5456" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5423" class="Bound">v</a> <a id="5458" class="Symbol">)</a>{% endraw %}</pre>

Next we consider the inversion lemma for application, which is also
the forward direction of the semantic equation for application.  We
describe the proof below.

<pre class="Agda">{% raw %}<a id="ℰ·→●ℰ"></a><a id="5648" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="5654" class="Symbol">:</a> <a id="5656" class="Symbol">∀{</a><a id="5658" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5658" class="Bound">Γ</a><a id="5659" class="Symbol">}{</a><a id="5661" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5661" class="Bound">γ</a> <a id="5663" class="Symbol">:</a> <a id="5665" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="5669" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5658" class="Bound">Γ</a><a id="5670" class="Symbol">}{</a><a id="5672" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5672" class="Bound">L</a> <a id="5674" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5674" class="Bound">M</a> <a id="5676" class="Symbol">:</a> <a id="5678" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5658" class="Bound">Γ</a> <a id="5680" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="5682" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="5683" class="Symbol">}{</a><a id="5685" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5685" class="Bound">v</a> <a id="5687" class="Symbol">:</a> <a id="5689" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4000" class="Datatype">Value</a><a id="5694" class="Symbol">}</a>
        <a id="5704" class="Symbol">→</a> <a id="5706" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="5708" class="Symbol">(</a><a id="5709" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5672" class="Bound">L</a> <a id="5711" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="5713" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5674" class="Bound">M</a><a id="5714" class="Symbol">)</a> <a id="5716" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5661" class="Bound">γ</a> <a id="5718" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5685" class="Bound">v</a>
          <a id="5730" class="Comment">----------------</a>
        <a id="5755" class="Symbol">→</a> <a id="5757" class="Symbol">(</a><a id="5758" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="5760" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5672" class="Bound">L</a> <a id="5762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="5764" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="5766" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5674" class="Bound">M</a><a id="5767" class="Symbol">)</a> <a id="5769" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5661" class="Bound">γ</a> <a id="5771" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5685" class="Bound">v</a>
<a id="5773" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="5779" class="Symbol">(</a><a id="5780" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9653" class="InductiveConstructor">↦-elim</a><a id="5786" class="Symbol">{</a><a id="5787" class="Argument">v</a> <a id="5789" class="Symbol">=</a> <a id="5791" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5791" class="Bound">v′</a><a id="5793" class="Symbol">}</a> <a id="5795" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5795" class="Bound">d₁</a> <a id="5798" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5798" class="Bound">d₂</a><a id="5800" class="Symbol">)</a> <a id="5802" class="Symbol">=</a> <a id="5804" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="5809" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="5811" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5791" class="Bound">v′</a> <a id="5814" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="5816" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="5818" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5795" class="Bound">d₁</a> <a id="5821" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="5823" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5798" class="Bound">d₂</a> <a id="5826" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="5828" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="5830" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="5836" class="Symbol">{</a><a id="5837" class="Argument">v</a> <a id="5839" class="Symbol">=</a> <a id="5841" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4020" class="InductiveConstructor">⊥</a><a id="5842" class="Symbol">}</a> <a id="5844" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9915" class="InductiveConstructor">⊥-intro</a> <a id="5852" class="Symbol">=</a> <a id="5854" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="5859" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4406" class="InductiveConstructor">Bot⊑</a>
<a id="5864" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="5870" class="Symbol">{</a><a id="5871" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5871" class="Bound">Γ</a><a id="5872" class="Symbol">}{</a><a id="5874" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5874" class="Bound">γ</a><a id="5875" class="Symbol">}{</a><a id="5877" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5877" class="Bound">L</a><a id="5878" class="Symbol">}{</a><a id="5880" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5880" class="Bound">M</a><a id="5881" class="Symbol">}{</a><a id="5883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5883" class="Bound">v</a><a id="5884" class="Symbol">}</a> <a id="5886" class="Symbol">(</a><a id="5887" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a><a id="5894" class="Symbol">{</a><a id="5895" class="Argument">v</a> <a id="5897" class="Symbol">=</a> <a id="5899" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5899" class="Bound">v₁</a><a id="5901" class="Symbol">}{</a><a id="5903" class="Argument">w</a> <a id="5905" class="Symbol">=</a> <a id="5907" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5907" class="Bound">v₂</a><a id="5909" class="Symbol">}</a> <a id="5911" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5911" class="Bound">d₁</a> <a id="5914" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5914" class="Bound">d₂</a><a id="5916" class="Symbol">)</a> 
    <a id="5923" class="Keyword">with</a> <a id="5928" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="5934" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5911" class="Bound">d₁</a> <a id="5937" class="Symbol">|</a> <a id="5939" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="5945" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5914" class="Bound">d₂</a>
<a id="5948" class="Symbol">...</a> <a id="5952" class="Symbol">|</a> <a id="5954" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="5959" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5959" class="Bound">lt1</a> <a id="5963" class="Symbol">|</a> <a id="5965" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="5970" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5970" class="Bound">lt2</a> <a id="5974" class="Symbol">=</a> <a id="5976" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="5981" class="Symbol">(</a><a id="5982" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4430" class="InductiveConstructor">ConjL⊑</a> <a id="5989" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5959" class="Bound">lt1</a> <a id="5993" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5970" class="Bound">lt2</a><a id="5996" class="Symbol">)</a>    
<a id="6002" class="Symbol">...</a> <a id="6006" class="Symbol">|</a> <a id="6008" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="6013" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6013" class="Bound">lt1</a> <a id="6017" class="Symbol">|</a> <a id="6019" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6024" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6026" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6026" class="Bound">v₁′</a> <a id="6030" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6032" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6034" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6034" class="Bound">L↓v12</a> <a id="6040" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6042" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6042" class="Bound">M↓v3</a> <a id="6047" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6049" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6051" class="Symbol">=</a>
      <a id="6059" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6064" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6066" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6026" class="Bound">v₁′</a> <a id="6070" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6072" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6074" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="6078" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6034" class="Bound">L↓v12</a> <a id="6084" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6110" class="Function">lt</a> <a id="6087" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6089" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6042" class="Bound">M↓v3</a> <a id="6094" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6096" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
      <a id="6104" class="Keyword">where</a> <a id="6110" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6110" class="Function">lt</a> <a id="6113" class="Symbol">:</a> <a id="6115" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6026" class="Bound">v₁′</a> <a id="6119" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="6121" class="Symbol">(</a><a id="6122" class="Bound">v₁</a> <a id="6125" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="6127" class="Bound">v₂</a><a id="6129" class="Symbol">)</a> <a id="6131" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">⊑</a> <a id="6133" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6026" class="Bound">v₁′</a> <a id="6137" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="6139" class="Bound">v₂</a>
            <a id="6154" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6110" class="Function">lt</a> <a id="6157" class="Symbol">=</a> <a id="6159" class="Symbol">(</a><a id="6160" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4742" class="InductiveConstructor">Fun⊑</a> <a id="6165" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a> <a id="6171" class="Symbol">(</a><a id="6172" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4430" class="InductiveConstructor">ConjL⊑</a> <a id="6179" class="Symbol">(</a><a id="6180" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4668" class="InductiveConstructor">Trans⊑</a> <a id="6187" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6013" class="Bound">lt1</a> <a id="6191" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4406" class="InductiveConstructor">Bot⊑</a><a id="6195" class="Symbol">)</a> <a id="6197" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a><a id="6202" class="Symbol">))</a>
<a id="6205" class="Symbol">...</a> <a id="6209" class="Symbol">|</a> <a id="6211" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6216" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6218" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6218" class="Bound">v₁′</a> <a id="6222" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6224" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6226" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6226" class="Bound">L↓v12</a> <a id="6232" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6234" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6234" class="Bound">M↓v3</a> <a id="6239" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6241" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6243" class="Symbol">|</a> <a id="6245" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="6250" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6250" class="Bound">lt2</a> <a id="6254" class="Symbol">=</a>
      <a id="6262" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6267" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6269" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6218" class="Bound">v₁′</a> <a id="6273" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6275" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6277" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="6281" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6226" class="Bound">L↓v12</a> <a id="6287" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6313" class="Function">lt</a> <a id="6290" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6292" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6234" class="Bound">M↓v3</a> <a id="6297" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6299" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
      <a id="6307" class="Keyword">where</a> <a id="6313" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6313" class="Function">lt</a> <a id="6316" class="Symbol">:</a> <a id="6318" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6218" class="Bound">v₁′</a> <a id="6322" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="6324" class="Symbol">(</a><a id="6325" class="Bound">v₁</a> <a id="6328" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="6330" class="Bound">v₂</a><a id="6332" class="Symbol">)</a> <a id="6334" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">⊑</a> <a id="6336" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6218" class="Bound">v₁′</a> <a id="6340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="6342" class="Bound">v₁</a>
            <a id="6357" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6313" class="Function">lt</a> <a id="6360" class="Symbol">=</a> <a id="6362" class="Symbol">(</a><a id="6363" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4742" class="InductiveConstructor">Fun⊑</a> <a id="6368" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a> <a id="6374" class="Symbol">(</a><a id="6375" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4430" class="InductiveConstructor">ConjL⊑</a> <a id="6382" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a> <a id="6388" class="Symbol">(</a><a id="6389" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4668" class="InductiveConstructor">Trans⊑</a> <a id="6396" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6250" class="Bound">lt2</a> <a id="6400" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4406" class="InductiveConstructor">Bot⊑</a><a id="6404" class="Symbol">)))</a>
<a id="6408" class="Symbol">...</a> <a id="6412" class="Symbol">|</a> <a id="6414" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6419" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6421" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6421" class="Bound">v₁′</a> <a id="6425" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6427" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6429" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6429" class="Bound">L↓v12</a> <a id="6435" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6437" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6437" class="Bound">M↓v3</a> <a id="6442" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6444" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6446" class="Symbol">|</a> <a id="6448" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6453" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6455" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6455" class="Bound">v₁′′</a> <a id="6460" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6462" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6464" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6464" class="Bound">L↓v12′</a> <a id="6471" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6473" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6473" class="Bound">M↓v3′</a> <a id="6479" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6481" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6483" class="Symbol">=</a>
      <a id="6491" class="Keyword">let</a> <a id="6495" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6495" class="Bound">L↓⊔</a> <a id="6499" class="Symbol">=</a> <a id="6501" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a> <a id="6509" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6429" class="Bound">L↓v12</a> <a id="6515" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6464" class="Bound">L↓v12′</a> <a id="6522" class="Keyword">in</a>
      <a id="6531" class="Keyword">let</a> <a id="6535" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6535" class="Bound">M↓⊔</a> <a id="6539" class="Symbol">=</a> <a id="6541" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a> <a id="6549" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6437" class="Bound">M↓v3</a> <a id="6554" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6473" class="Bound">M↓v3′</a> <a id="6560" class="Keyword">in</a>
      <a id="6569" class="Keyword">let</a> <a id="6573" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6573" class="Bound">x</a> <a id="6575" class="Symbol">=</a> <a id="6577" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6582" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6584" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6421" class="Bound">v₁′</a> <a id="6588" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="6590" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6455" class="Bound">v₁′′</a> <a id="6595" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6597" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6599" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="6603" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6495" class="Bound">L↓⊔</a> <a id="6607" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#6196" class="Function">Dist⊔↦⊔</a> <a id="6615" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6617" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6535" class="Bound">M↓⊔</a> <a id="6621" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6623" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6625" class="Keyword">in</a>
      <a id="6634" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6573" class="Bound">x</a>
<a id="6636" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="6642" class="Symbol">{</a><a id="6643" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6643" class="Bound">Γ</a><a id="6644" class="Symbol">}{</a><a id="6646" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6646" class="Bound">γ</a><a id="6647" class="Symbol">}{</a><a id="6649" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6649" class="Bound">L</a><a id="6650" class="Symbol">}{</a><a id="6652" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6652" class="Bound">M</a><a id="6653" class="Symbol">}{</a><a id="6655" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6655" class="Bound">v</a><a id="6656" class="Symbol">}</a> <a id="6658" class="Symbol">(</a><a id="6659" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="6663" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6663" class="Bound">d</a> <a id="6665" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6665" class="Bound">lt</a><a id="6667" class="Symbol">)</a>
    <a id="6673" class="Keyword">with</a> <a id="6678" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="6684" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6663" class="Bound">d</a>
<a id="6686" class="Symbol">...</a> <a id="6690" class="Symbol">|</a> <a id="6692" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="6697" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6697" class="Bound">lt2</a> <a id="6701" class="Symbol">=</a> <a id="6703" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="6708" class="Symbol">(</a><a id="6709" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4668" class="InductiveConstructor">Trans⊑</a> <a id="6716" class="Bound">lt</a> <a id="6719" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6697" class="Bound">lt2</a><a id="6722" class="Symbol">)</a>
<a id="6724" class="Symbol">...</a> <a id="6728" class="Symbol">|</a> <a id="6730" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6735" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6737" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6737" class="Bound">v₁</a> <a id="6740" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6742" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6744" class="Bound">L↓v12</a> <a id="6750" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6752" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6752" class="Bound">M↓v3</a> <a id="6757" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6759" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6761" class="Symbol">=</a>
      <a id="6769" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="6774" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6776" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6737" class="Bound">v₁</a> <a id="6779" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6781" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="6783" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="6787" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6744" class="Bound">L↓v12</a> <a id="6793" class="Symbol">(</a><a id="6794" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4742" class="InductiveConstructor">Fun⊑</a> <a id="6799" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a> <a id="6805" class="Bound">lt</a><a id="6807" class="Symbol">)</a> <a id="6809" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="6811" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#6752" class="Bound">M↓v3</a> <a id="6816" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="6818" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>{% endraw %}</pre>

We proceed by induction on the semantics.

* In case `↦-elim` we have `γ ⊢ L ↓ (v′ ↦ v)` and `γ ⊢ M ↓ v′`,
  which is all we need to show `(ℰ L ● ℰ M) γ v`.

* In case `⊥-intro` we have `v = ⊥`. We conclude that `v ⊑ ⊥`.

* In case `⊔-intro` we have `ℰ (L · M) γ v₁` and `ℰ (L · M) γ v₂`
  and need to show `(ℰ L ● ℰ M) γ (v₁ ⊔ v₂)`. By the induction
  hypothesis, we have `(ℰ L ● ℰ M) γ v₁` and `(ℰ L ● ℰ M) γ v₂`.
  We have four subcases to consider.

    * Suppose `v₁ ⊑ ⊥` and `v₂ ⊑ ⊥`. Then `v₁ ⊔ v₂ ⊑ ⊥`.
    * Suppose `v₁ ⊑ ⊥`, `γ ⊢ L ↓ v₁′ ↦ v₂`, and `γ ⊢ M ↓ v₁′`.
      We have `γ ⊢ L ↓ v₁′ ↦ (v₁ ⊔ v₂)` by rule `sub`
      because `v₁′ ↦ (v₁ ⊔ v₂) ⊑ v₁′ ↦ v₂`.
    * Suppose `γ ⊢ L ↓ v₁′ ↦ v₁`, `γ ⊢ M ↓ v₁′`, and `v₂ ⊑ ⊥`.
      We have `γ ⊢ L ↓ v₁′ ↦ (v₁ ⊔ v₂)` by rule `sub`
      because `v₁′ ↦ (v₁ ⊔ v₂) ⊑ v₁′ ↦ v₁`.
    * Suppose `γ ⊢ L ↓ v₁′′ ↦ v₁, γ ⊢ M ↓ v₁′′`,
      `γ ⊢ L ↓ v₁′ ↦ v₂`, and `γ ⊢ M ↓ v₁′`.
      This case is the most interesting.
      By two uses of the rule `⊔-intro` we have
      `γ ⊢ L ↓ (v₁′ ↦ v₂) ⊔ (v₁′′ ↦ v₁)` and
      `γ ⊢ M ↓ (v₁′ ⊔ v₁′′)`. But this does not yet match
      what we need for `ℰ L ● ℰ M` because the result of
      `L` must be an `↦` whose input entry is `v₁′ ⊔ v₁′′`.
      So we use the `sub` rule to obtain 
      `γ ⊢ L ↓ (v₁′ ⊔ v₁′′) ↦ (v₁ ⊔ v₂)`,
      using the `Dist⊔→⊔` lemma (thanks to the `Dist⊑` rule) to
      show that
   
            (v₁′ ⊔ v₁′′) ↦ (v₁ ⊔ v₂) ⊑ (v₁′ ↦ v₂) ⊔ (v₁′′ ↦ v₁)
   
      So we have proved what is needed for this case.

* In case `sub` we have `Γ ⊢ L · M ↓ v₁` and `v ⊑ v₁`.
  By the induction hypothesis, we have `(ℰ L ● ℰ M) γ v₁`.
  We have two subcases to consider.

    * Suppose `v₁ ⊑ ⊥`. We conclude that `v ⊑ ⊥`.
    * Suppose `Γ ⊢ L ↓ v′ → v₁` and `Γ ⊢ M ↓ v′`.
      We conclude with `Γ ⊢ L ↓ v′ → v` by rule `sub`, because
      `v′ → v ⊑ v′ → v₁`. 


The forward direction is proved by cases on the premise `(ℰ L ● ℰ M) γ v`.
In case `v ⊑ ⊥`, we obtain `Γ ⊢ L · M ↓ ⊥` by rule `⊥-intro`.
Otherwise, we conclude immediately by rule `↦-elim`.

<pre class="Agda">{% raw %}<a id="●ℰ→ℰ·"></a><a id="8906" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8906" class="Function">●ℰ→ℰ·</a> <a id="8912" class="Symbol">:</a> <a id="8914" class="Symbol">∀{</a><a id="8916" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8916" class="Bound">Γ</a><a id="8917" class="Symbol">}{</a><a id="8919" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8919" class="Bound">γ</a> <a id="8921" class="Symbol">:</a> <a id="8923" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="8927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8916" class="Bound">Γ</a><a id="8928" class="Symbol">}{</a><a id="8930" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8930" class="Bound">L</a> <a id="8932" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8932" class="Bound">M</a> <a id="8934" class="Symbol">:</a> <a id="8936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8916" class="Bound">Γ</a> <a id="8938" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="8940" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="8941" class="Symbol">}{</a><a id="8943" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8943" class="Bound">v</a><a id="8944" class="Symbol">}</a>
      <a id="8952" class="Symbol">→</a> <a id="8954" class="Symbol">(</a><a id="8955" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="8957" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8930" class="Bound">L</a> <a id="8959" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="8961" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="8963" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8932" class="Bound">M</a><a id="8964" class="Symbol">)</a> <a id="8966" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8919" class="Bound">γ</a> <a id="8968" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8943" class="Bound">v</a>
        <a id="8978" class="Comment">----------------</a>
      <a id="9001" class="Symbol">→</a> <a id="9003" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="9005" class="Symbol">(</a><a id="9006" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8930" class="Bound">L</a> <a id="9008" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="9010" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8932" class="Bound">M</a><a id="9011" class="Symbol">)</a> <a id="9013" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8919" class="Bound">γ</a> <a id="9015" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8943" class="Bound">v</a>
<a id="9017" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8906" class="Function">●ℰ→ℰ·</a> <a id="9023" class="Symbol">{</a><a id="9024" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9024" class="Bound">γ</a><a id="9025" class="Symbol">}{</a><a id="9027" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9027" class="Bound">v</a><a id="9028" class="Symbol">}</a> <a id="9030" class="Symbol">(</a><a id="9031" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="9036" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9036" class="Bound">lt</a><a id="9038" class="Symbol">)</a> <a id="9040" class="Symbol">=</a> <a id="9042" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="9046" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9915" class="InductiveConstructor">⊥-intro</a> <a id="9054" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9036" class="Bound">lt</a>
<a id="9057" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8906" class="Function">●ℰ→ℰ·</a> <a id="9063" class="Symbol">{</a><a id="9064" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9064" class="Bound">γ</a><a id="9065" class="Symbol">}{</a><a id="9067" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9067" class="Bound">v</a><a id="9068" class="Symbol">}</a> <a id="9070" class="Symbol">(</a><a id="9071" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="9076" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="9078" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9078" class="Bound">v₁</a> <a id="9081" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="9083" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="9085" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9085" class="Bound">d1</a> <a id="9088" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="9090" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9090" class="Bound">d2</a> <a id="9093" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="9095" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a><a id="9096" class="Symbol">)</a> <a id="9098" class="Symbol">=</a> <a id="9100" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9653" class="InductiveConstructor">↦-elim</a> <a id="9107" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9085" class="Bound">d1</a> <a id="9110" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9090" class="Bound">d2</a>{% endraw %}</pre>

So we have proved that the semantics is compositional with respect to
function application, as witnessed by the `●` function.

<pre class="Agda">{% raw %}<a id="app-equiv"></a><a id="9265" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9265" class="Function">app-equiv</a> <a id="9275" class="Symbol">:</a> <a id="9277" class="Symbol">∀{</a><a id="9279" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9279" class="Bound">Γ</a><a id="9280" class="Symbol">}{</a><a id="9282" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9282" class="Bound">L</a> <a id="9284" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9284" class="Bound">M</a> <a id="9286" class="Symbol">:</a> <a id="9288" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9279" class="Bound">Γ</a> <a id="9290" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="9292" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="9293" class="Symbol">}</a>
          <a id="9305" class="Symbol">→</a> <a id="9307" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="9309" class="Symbol">(</a><a id="9310" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9282" class="Bound">L</a> <a id="9312" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="9314" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9284" class="Bound">M</a><a id="9315" class="Symbol">)</a> <a id="9317" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="9319" class="Symbol">(</a><a id="9320" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="9322" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9282" class="Bound">L</a><a id="9323" class="Symbol">)</a> <a id="9325" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="9327" class="Symbol">(</a><a id="9328" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="9330" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9284" class="Bound">M</a><a id="9331" class="Symbol">)</a>
<a id="9333" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9265" class="Function">app-equiv</a> <a id="9343" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9343" class="Bound">γ</a> <a id="9345" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9345" class="Bound">v</a> <a id="9347" class="Symbol">=</a> <a id="9349" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="9351" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5648" class="Function">ℰ·→●ℰ</a> <a id="9357" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="9359" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#8906" class="Function">●ℰ→ℰ·</a> <a id="9365" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>{% endraw %}</pre>

We also need an inversion lemma for variables.
If `Γ ⊢ x ↓ v`, then `v ⊑ nth x γ`. The proof is a straightforward
induction on the semantics.

<pre class="Agda">{% raw %}<a id="var-inv"></a><a id="9536" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9544" class="Symbol">:</a> <a id="9546" class="Symbol">∀</a> <a id="9548" class="Symbol">{</a><a id="9549" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9549" class="Bound">Γ</a> <a id="9551" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9551" class="Bound">v</a> <a id="9553" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9553" class="Bound">x</a><a id="9554" class="Symbol">}</a> <a id="9556" class="Symbol">{</a><a id="9557" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9557" class="Bound">γ</a> <a id="9559" class="Symbol">:</a> <a id="9561" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="9565" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9549" class="Bound">Γ</a><a id="9566" class="Symbol">}</a>
  <a id="9570" class="Symbol">→</a> <a id="9572" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="9574" class="Symbol">(</a><a id="9575" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4186" class="InductiveConstructor Operator">`</a> <a id="9577" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9553" class="Bound">x</a><a id="9578" class="Symbol">)</a> <a id="9580" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9557" class="Bound">γ</a> <a id="9582" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9551" class="Bound">v</a>
    <a id="9588" class="Comment">-------------------</a>
  <a id="9610" class="Symbol">→</a> <a id="9612" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9551" class="Bound">v</a> <a id="9614" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">⊑</a> <a id="9616" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9557" class="Bound">γ</a> <a id="9618" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9553" class="Bound">x</a>
<a id="9620" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9628" class="Symbol">(</a><a id="9629" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9574" class="InductiveConstructor">var</a><a id="9632" class="Symbol">)</a> <a id="9634" class="Symbol">=</a> <a id="9636" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#5541" class="Function">Refl⊑</a>
<a id="9642" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9650" class="Symbol">(</a><a id="9651" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9990" class="InductiveConstructor">⊔-intro</a> <a id="9659" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9659" class="Bound">d₁</a> <a id="9662" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9662" class="Bound">d₂</a><a id="9664" class="Symbol">)</a> <a id="9666" class="Symbol">=</a> <a id="9668" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4430" class="InductiveConstructor">ConjL⊑</a> <a id="9675" class="Symbol">(</a><a id="9676" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9684" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9659" class="Bound">d₁</a><a id="9686" class="Symbol">)</a> <a id="9688" class="Symbol">(</a><a id="9689" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9697" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9662" class="Bound">d₂</a><a id="9699" class="Symbol">)</a>
<a id="9701" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9709" class="Symbol">(</a><a id="9710" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="9714" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9714" class="Bound">d</a> <a id="9716" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9716" class="Bound">lt</a><a id="9718" class="Symbol">)</a> <a id="9720" class="Symbol">=</a> <a id="9722" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4668" class="InductiveConstructor">Trans⊑</a> <a id="9729" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9716" class="Bound">lt</a> <a id="9732" class="Symbol">(</a><a id="9733" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9741" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9714" class="Bound">d</a><a id="9742" class="Symbol">)</a>
<a id="9744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9752" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9915" class="InductiveConstructor">⊥-intro</a> <a id="9760" class="Symbol">=</a> <a id="9762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4406" class="InductiveConstructor">Bot⊑</a>{% endraw %}</pre>

To round-out the semantic equations, we establish the following one
for variables.

<pre class="Agda">{% raw %}<a id="var-equiv"></a><a id="9876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9876" class="Function">var-equiv</a> <a id="9886" class="Symbol">:</a> <a id="9888" class="Symbol">∀{</a><a id="9890" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9890" class="Bound">Γ</a><a id="9891" class="Symbol">}{</a><a id="9893" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9893" class="Bound">γ</a> <a id="9895" class="Symbol">:</a> <a id="9897" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="9901" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9890" class="Bound">Γ</a><a id="9902" class="Symbol">}{</a><a id="9904" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9904" class="Bound">x</a> <a id="9906" class="Symbol">:</a> <a id="9908" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9890" class="Bound">Γ</a> <a id="9910" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3365" class="Datatype Operator">∋</a> <a id="9912" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="9913" class="Symbol">}</a>
          <a id="9925" class="Symbol">→</a> <a id="9927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="9929" class="Symbol">(</a><a id="9930" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4186" class="InductiveConstructor Operator">`</a> <a id="9932" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9904" class="Bound">x</a><a id="9933" class="Symbol">)</a> <a id="9935" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="9937" class="Symbol">(λ</a> <a id="9940" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9940" class="Bound">γ</a> <a id="9942" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9942" class="Bound">v</a> <a id="9944" class="Symbol">→</a> <a id="9946" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9942" class="Bound">v</a> <a id="9948" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4371" class="Datatype Operator">⊑</a> <a id="9950" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#8098" class="Function">nth</a> <a id="9954" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9904" class="Bound">x</a> <a id="9956" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9940" class="Bound">γ</a><a id="9957" class="Symbol">)</a>
<a id="9959" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9876" class="Function">var-equiv</a> <a id="9969" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9969" class="Bound">γ</a> <a id="9971" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9971" class="Bound">v</a> <a id="9973" class="Symbol">=</a> <a id="9975" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="9977" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9536" class="Function">var-inv</a> <a id="9985" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="9987" class="Symbol">(λ</a> <a id="9990" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9990" class="Bound">lt</a> <a id="9993" class="Symbol">→</a> <a id="9995" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#10126" class="InductiveConstructor">sub</a> <a id="9999" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#9574" class="InductiveConstructor">var</a> <a id="10003" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9990" class="Bound">lt</a><a id="10005" class="Symbol">)</a> <a id="10007" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>{% endraw %}</pre>


## Congruence

The main work of this chapter is complete: we have established
semantic equations that show how the denotational semantics is
compositional. In this section and the next we make use of these
equations to prove some corollaries: that denotational equality is a
_congruence_ and to prove the _compositionality property_, which states
that surrounding two denotationally-equal terms in the same context
produces two programs that are denotationally equal.

We begin by showing that denotational equality is a congruence with
respect to lambda abstraction: that `ℰ N ≃ ℰ N′` implies `ℰ (ƛ N) ≃ ℰ
(ƛ N′)`. We shall use the `lam-equiv` equation to reduce this question to
whether `ℱ` is a congruence.

<pre class="Agda">{% raw %}<a id="ℱ-cong"></a><a id="10746" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10746" class="Function">ℱ-cong</a> <a id="10753" class="Symbol">:</a> <a id="10755" class="Symbol">∀{</a><a id="10757" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10757" class="Bound">Γ</a><a id="10758" class="Symbol">}{</a><a id="10760" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10760" class="Bound">D</a> <a id="10762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10762" class="Bound">D′</a> <a id="10765" class="Symbol">:</a> <a id="10767" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="10778" class="Symbol">(</a><a id="10779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10757" class="Bound">Γ</a> <a id="10781" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="10783" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="10784" class="Symbol">)}</a>
       <a id="10794" class="Symbol">→</a> <a id="10796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10760" class="Bound">D</a> <a id="10798" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="10800" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10762" class="Bound">D′</a>
         <a id="10812" class="Comment">-----------</a>
       <a id="10831" class="Symbol">→</a> <a id="10833" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="10835" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10760" class="Bound">D</a> <a id="10837" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="10839" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="10841" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10762" class="Bound">D′</a>
<a id="10844" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10746" class="Function">ℱ-cong</a><a id="10850" class="Symbol">{</a><a id="10851" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10851" class="Bound">Γ</a><a id="10852" class="Symbol">}</a> <a id="10854" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10854" class="Bound">D≃D′</a> <a id="10859" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10859" class="Bound">γ</a> <a id="10861" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10861" class="Bound">v</a> <a id="10863" class="Symbol">=</a>
   <a id="10868" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="10870" class="Symbol">(λ</a> <a id="10873" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10873" class="Bound">x</a> <a id="10875" class="Symbol">→</a> <a id="10877" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a><a id="10879" class="Symbol">{</a><a id="10880" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10859" class="Bound">γ</a><a id="10881" class="Symbol">}{</a><a id="10883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10861" class="Bound">v</a><a id="10884" class="Symbol">}</a> <a id="10886" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10873" class="Bound">x</a> <a id="10888" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10854" class="Bound">D≃D′</a><a id="10892" class="Symbol">)</a> <a id="10894" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="10896" class="Symbol">(λ</a> <a id="10899" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10899" class="Bound">x</a> <a id="10901" class="Symbol">→</a> <a id="10903" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a><a id="10905" class="Symbol">{</a><a id="10906" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10859" class="Bound">γ</a><a id="10907" class="Symbol">}{</a><a id="10909" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10861" class="Bound">v</a><a id="10910" class="Symbol">}</a> <a id="10912" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10899" class="Bound">x</a> <a id="10914" class="Symbol">(</a><a id="10915" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18484" class="Function">≃-sym</a> <a id="10921" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10854" class="Bound">D≃D′</a><a id="10925" class="Symbol">))</a> <a id="10928" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
   <a id="10933" class="Keyword">where</a> 
   <a id="10943" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a> <a id="10946" class="Symbol">:</a> <a id="10948" class="Symbol">∀{</a><a id="10950" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10950" class="Bound">γ</a> <a id="10952" class="Symbol">:</a> <a id="10954" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="10958" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10851" class="Bound">Γ</a><a id="10959" class="Symbol">}{</a><a id="10961" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10961" class="Bound">v</a><a id="10962" class="Symbol">}{</a><a id="10964" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10964" class="Bound">D</a> <a id="10966" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10966" class="Bound">D′</a> <a id="10969" class="Symbol">:</a> <a id="10971" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="10982" class="Symbol">(</a><a id="10983" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10851" class="Bound">Γ</a> <a id="10985" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="10987" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="10988" class="Symbol">)}</a>
      <a id="10997" class="Symbol">→</a> <a id="10999" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="11001" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10964" class="Bound">D</a> <a id="11003" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10950" class="Bound">γ</a> <a id="11005" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10961" class="Bound">v</a>  <a id="11008" class="Symbol">→</a>  <a id="11011" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10964" class="Bound">D</a> <a id="11013" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="11015" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10966" class="Bound">D′</a> <a id="11018" class="Symbol">→</a> <a id="11020" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="11022" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10966" class="Bound">D′</a> <a id="11025" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10950" class="Bound">γ</a> <a id="11027" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10961" class="Bound">v</a>
   <a id="11032" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a> <a id="11035" class="Symbol">{</a><a id="11036" class="Argument">v</a> <a id="11038" class="Symbol">=</a> <a id="11040" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4020" class="InductiveConstructor">⊥</a><a id="11041" class="Symbol">}</a> <a id="11043" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11043" class="Bound">fd</a> <a id="11046" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11046" class="Bound">dd′</a> <a id="11050" class="Symbol">=</a> <a id="11052" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Unit.html#106" class="InductiveConstructor">tt</a>
   <a id="11058" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a> <a id="11061" class="Symbol">{</a><a id="11062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11062" class="Bound">γ</a><a id="11063" class="Symbol">}{</a><a id="11065" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11065" class="Bound">v</a> <a id="11067" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="11069" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11069" class="Bound">w</a><a id="11070" class="Symbol">}</a> <a id="11072" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11072" class="Bound">fd</a> <a id="11075" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11075" class="Bound">dd′</a> <a id="11079" class="Symbol">=</a> <a id="11081" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a> <a id="11087" class="Symbol">(</a><a id="11088" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11075" class="Bound">dd′</a> <a id="11092" class="Symbol">(</a><a id="11093" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11062" class="Bound">γ</a> <a id="11095" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7407" class="Function Operator">`,</a> <a id="11098" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11065" class="Bound">v</a><a id="11099" class="Symbol">)</a> <a id="11101" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11069" class="Bound">w</a><a id="11102" class="Symbol">)</a> <a id="11104" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11072" class="Bound">fd</a>
   <a id="11110" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a> <a id="11113" class="Symbol">{</a><a id="11114" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11114" class="Bound">γ</a><a id="11115" class="Symbol">}{</a><a id="11117" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11117" class="Bound">u</a> <a id="11119" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4062" class="InductiveConstructor Operator">⊔</a> <a id="11121" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11121" class="Bound">w</a><a id="11122" class="Symbol">}</a> <a id="11124" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11124" class="Bound">fd</a> <a id="11127" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11127" class="Bound">dd′</a> <a id="11131" class="Symbol">=</a> <a id="11133" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="11135" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a><a id="11137" class="Symbol">{</a><a id="11138" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11114" class="Bound">γ</a><a id="11139" class="Symbol">}{</a><a id="11141" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11117" class="Bound">u</a><a id="11142" class="Symbol">}</a> <a id="11144" class="Symbol">(</a><a id="11145" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a> <a id="11151" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11124" class="Bound">fd</a><a id="11153" class="Symbol">)</a> <a id="11155" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11127" class="Bound">dd′</a> <a id="11159" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="11161" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10943" class="Function">ℱ≃</a><a id="11163" class="Symbol">{</a><a id="11164" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11114" class="Bound">γ</a><a id="11165" class="Symbol">}{</a><a id="11167" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11121" class="Bound">w</a><a id="11168" class="Symbol">}</a> <a id="11170" class="Symbol">(</a><a id="11171" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a> <a id="11177" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11124" class="Bound">fd</a><a id="11179" class="Symbol">)</a> <a id="11181" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11127" class="Bound">dd′</a> <a id="11185" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>{% endraw %}</pre>

The proof of `ℱ-cong` uses the lemma `ℱ≃` to handle both directions of
the if-and-only-if. That lemma is proved by a straightforward
induction on the value `v`.

We now prove that lambda abstraction is a congruence by direct
equational reasoning.

<pre class="Agda">{% raw %}<a id="lam-cong"></a><a id="11460" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11460" class="Function">lam-cong</a> <a id="11469" class="Symbol">:</a> <a id="11471" class="Symbol">∀{</a><a id="11473" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11473" class="Bound">Γ</a><a id="11474" class="Symbol">}{</a><a id="11476" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11476" class="Bound">N</a> <a id="11478" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11478" class="Bound">N′</a> <a id="11481" class="Symbol">:</a> <a id="11483" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11473" class="Bound">Γ</a> <a id="11485" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="11487" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="11489" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="11491" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="11492" class="Symbol">}</a>
         <a id="11503" class="Symbol">→</a> <a id="11505" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11507" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11476" class="Bound">N</a> <a id="11509" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="11511" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11513" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11478" class="Bound">N′</a>
           <a id="11527" class="Comment">-----------------</a>
         <a id="11554" class="Symbol">→</a> <a id="11556" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11558" class="Symbol">(</a><a id="11559" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="11561" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11476" class="Bound">N</a><a id="11562" class="Symbol">)</a> <a id="11564" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="11566" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11568" class="Symbol">(</a><a id="11569" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="11571" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11478" class="Bound">N′</a><a id="11573" class="Symbol">)</a>
<a id="11575" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11460" class="Function">lam-cong</a> <a id="11584" class="Symbol">{</a><a id="11585" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11585" class="Bound">Γ</a><a id="11586" class="Symbol">}{</a><a id="11588" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11588" class="Bound">N</a><a id="11589" class="Symbol">}{</a><a id="11591" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11591" class="Bound">N′</a><a id="11593" class="Symbol">}</a> <a id="11595" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11595" class="Bound">N≃N′</a> <a id="11600" class="Symbol">=</a>
  <a id="11604" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19164" class="Function Operator">start</a>
  <a id="11612" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11614" class="Symbol">(</a><a id="11615" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="11617" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11588" class="Bound">N</a><a id="11618" class="Symbol">)</a>
  <a id="11622" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">≃⟨</a> <a id="11625" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4124" class="Function">lam-equiv</a> <a id="11635" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">⟩</a>
  <a id="11639" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="11641" class="Symbol">(</a><a id="11642" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11644" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11588" class="Bound">N</a><a id="11645" class="Symbol">)</a>
  <a id="11649" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">≃⟨</a> <a id="11652" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#10746" class="Function">ℱ-cong</a> <a id="11659" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11595" class="Bound">N≃N′</a> <a id="11664" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">⟩</a>
  <a id="11668" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#1684" class="Function">ℱ</a> <a id="11670" class="Symbol">(</a><a id="11671" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11673" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11591" class="Bound">N′</a><a id="11675" class="Symbol">)</a>
  <a id="11679" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">≃⟨</a> <a id="11682" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18484" class="Function">≃-sym</a> <a id="11688" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#4124" class="Function">lam-equiv</a> <a id="11698" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">⟩</a>
  <a id="11702" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="11704" class="Symbol">(</a><a id="11705" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="11707" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11591" class="Bound">N′</a><a id="11709" class="Symbol">)</a>
  <a id="11713" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19502" class="Function Operator">☐</a>{% endraw %}</pre>

Next we prove that denotational equality is a congruence for
application: that `ℰ L ≃ ℰ L′` and `ℰ M ≃ ℰ M′` imply
`ℰ (L · M) ≃ ℰ (L′ · M′)`. The `app-equiv` equation
reduces this to the question of whether the `●` operator
is a congruence.

<pre class="Agda">{% raw %}<a id="●-cong"></a><a id="11982" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11982" class="Function">●-cong</a> <a id="11989" class="Symbol">:</a> <a id="11991" class="Symbol">∀{</a><a id="11993" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11993" class="Bound">Γ</a><a id="11994" class="Symbol">}{</a><a id="11996" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11996" class="Bound">D₁</a> <a id="11999" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11999" class="Bound">D₁′</a> <a id="12003" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12003" class="Bound">D₂</a> <a id="12006" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12006" class="Bound">D₂′</a> <a id="12010" class="Symbol">:</a> <a id="12012" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="12023" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11993" class="Bound">Γ</a><a id="12024" class="Symbol">}</a>
   <a id="12029" class="Symbol">→</a> <a id="12031" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11996" class="Bound">D₁</a> <a id="12034" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12036" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11999" class="Bound">D₁′</a> <a id="12040" class="Symbol">→</a> <a id="12042" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12003" class="Bound">D₂</a> <a id="12045" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12047" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12006" class="Bound">D₂′</a>
   <a id="12054" class="Symbol">→</a> <a id="12056" class="Symbol">(</a><a id="12057" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11996" class="Bound">D₁</a> <a id="12060" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="12062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12003" class="Bound">D₂</a><a id="12064" class="Symbol">)</a> <a id="12066" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12068" class="Symbol">(</a><a id="12069" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11999" class="Bound">D₁′</a> <a id="12073" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="12075" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12006" class="Bound">D₂′</a><a id="12078" class="Symbol">)</a>
<a id="12080" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11982" class="Function">●-cong</a> <a id="12087" class="Symbol">{</a><a id="12088" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12088" class="Bound">Γ</a><a id="12089" class="Symbol">}</a> <a id="12091" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12091" class="Bound">d1</a> <a id="12094" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12094" class="Bound">d2</a> <a id="12097" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12097" class="Bound">γ</a> <a id="12099" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12099" class="Bound">v</a> <a id="12101" class="Symbol">=</a> <a id="12103" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="12105" class="Symbol">(λ</a> <a id="12108" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12108" class="Bound">x</a> <a id="12110" class="Symbol">→</a> <a id="12112" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12200" class="Function">●≃</a> <a id="12115" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12108" class="Bound">x</a> <a id="12117" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12091" class="Bound">d1</a> <a id="12120" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12094" class="Bound">d2</a><a id="12122" class="Symbol">)</a> <a id="12124" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                         <a id="12151" class="Symbol">(λ</a> <a id="12154" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12154" class="Bound">x</a> <a id="12156" class="Symbol">→</a> <a id="12158" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12200" class="Function">●≃</a> <a id="12161" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12154" class="Bound">x</a> <a id="12163" class="Symbol">(</a><a id="12164" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18484" class="Function">≃-sym</a> <a id="12170" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12091" class="Bound">d1</a><a id="12172" class="Symbol">)</a> <a id="12174" class="Symbol">(</a><a id="12175" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18484" class="Function">≃-sym</a> <a id="12181" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12094" class="Bound">d2</a><a id="12183" class="Symbol">))</a> <a id="12186" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
   <a id="12191" class="Keyword">where</a>
   <a id="12200" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12200" class="Function">●≃</a> <a id="12203" class="Symbol">:</a> <a id="12205" class="Symbol">∀{</a><a id="12207" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12207" class="Bound">γ</a> <a id="12209" class="Symbol">:</a> <a id="12211" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#7234" class="Function">Env</a> <a id="12215" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12088" class="Bound">Γ</a><a id="12216" class="Symbol">}{</a><a id="12218" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12218" class="Bound">v</a><a id="12219" class="Symbol">}{</a><a id="12221" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12221" class="Bound">D₁</a> <a id="12224" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12224" class="Bound">D₁′</a> <a id="12228" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12228" class="Bound">D₂</a> <a id="12231" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12231" class="Bound">D₂′</a> <a id="12235" class="Symbol">:</a> <a id="12237" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17769" class="Function">Denotation</a> <a id="12248" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12088" class="Bound">Γ</a><a id="12249" class="Symbol">}</a>
      <a id="12257" class="Symbol">→</a> <a id="12259" class="Symbol">(</a><a id="12260" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12221" class="Bound">D₁</a> <a id="12263" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="12265" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12228" class="Bound">D₂</a><a id="12267" class="Symbol">)</a> <a id="12269" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12207" class="Bound">γ</a> <a id="12271" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12218" class="Bound">v</a>  <a id="12274" class="Symbol">→</a>  <a id="12277" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12221" class="Bound">D₁</a> <a id="12280" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12282" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12224" class="Bound">D₁′</a>  <a id="12287" class="Symbol">→</a>  <a id="12290" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12228" class="Bound">D₂</a> <a id="12293" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12295" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12231" class="Bound">D₂′</a>
      <a id="12305" class="Symbol">→</a> <a id="12307" class="Symbol">(</a><a id="12308" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12224" class="Bound">D₁′</a> <a id="12312" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="12314" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12231" class="Bound">D₂′</a><a id="12317" class="Symbol">)</a> <a id="12319" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12207" class="Bound">γ</a> <a id="12321" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12218" class="Bound">v</a>
   <a id="12326" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12200" class="Function">●≃</a> <a id="12329" class="Symbol">(</a><a id="12330" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="12335" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12335" class="Bound">v⊑⊥</a><a id="12338" class="Symbol">)</a> <a id="12340" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12340" class="Bound">eq₁</a> <a id="12344" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12344" class="Bound">eq₂</a> <a id="12348" class="Symbol">=</a> <a id="12350" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#475" class="InductiveConstructor">inj₁</a> <a id="12355" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12335" class="Bound">v⊑⊥</a>
   <a id="12362" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12200" class="Function">●≃</a> <a id="12365" class="Symbol">{</a><a id="12366" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12366" class="Bound">γ</a><a id="12367" class="Symbol">}</a> <a id="12369" class="Symbol">{</a><a id="12370" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12370" class="Bound">w</a><a id="12371" class="Symbol">}</a> <a id="12373" class="Symbol">(</a><a id="12374" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="12379" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="12381" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12381" class="Bound">v</a> <a id="12383" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="12385" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="12387" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12387" class="Bound">Dv↦w</a> <a id="12392" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="12394" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12394" class="Bound">Dv</a> <a id="12397" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="12399" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a><a id="12400" class="Symbol">)</a> <a id="12402" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12402" class="Bound">eq₁</a> <a id="12406" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12406" class="Bound">eq₂</a> <a id="12410" class="Symbol">=</a>
      <a id="12418" href="https://agda.github.io/agda-stdlib/v0.17/Data.Sum.Base.html#500" class="InductiveConstructor">inj₂</a> <a id="12423" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="12425" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12381" class="Bound">v</a> <a id="12427" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="12429" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="12431" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a> <a id="12437" class="Symbol">(</a><a id="12438" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12402" class="Bound">eq₁</a> <a id="12442" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12366" class="Bound">γ</a> <a id="12444" class="Symbol">(</a><a id="12445" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12381" class="Bound">v</a> <a id="12447" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#4032" class="InductiveConstructor Operator">↦</a> <a id="12449" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12370" class="Bound">w</a><a id="12450" class="Symbol">))</a> <a id="12453" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12387" class="Bound">Dv↦w</a> <a id="12458" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="12460" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a> <a id="12466" class="Symbol">(</a><a id="12467" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12406" class="Bound">eq₂</a> <a id="12471" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12366" class="Bound">γ</a> <a id="12473" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12381" class="Bound">v</a><a id="12474" class="Symbol">)</a> <a id="12476" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12394" class="Bound">Dv</a> <a id="12479" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="12481" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>{% endraw %}</pre>

Again, both directions of the if-and-only-if are proved via a lemma.
This time the lemma is proved by cases on `(D₁ ● D₂) γ v`.

With the congruence of `●`, we can prove that application is a
congruence by direct equational reasoning.

<pre class="Agda">{% raw %}<a id="app-cong"></a><a id="12744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12744" class="Function">app-cong</a> <a id="12753" class="Symbol">:</a> <a id="12755" class="Symbol">∀{</a><a id="12757" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12757" class="Bound">Γ</a><a id="12758" class="Symbol">}{</a><a id="12760" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12760" class="Bound">L</a> <a id="12762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12762" class="Bound">L′</a> <a id="12765" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12765" class="Bound">M</a> <a id="12767" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12767" class="Bound">M′</a> <a id="12770" class="Symbol">:</a> <a id="12772" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12757" class="Bound">Γ</a> <a id="12774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="12776" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="12777" class="Symbol">}</a>
         <a id="12788" class="Symbol">→</a> <a id="12790" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12792" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12760" class="Bound">L</a> <a id="12794" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12798" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12762" class="Bound">L′</a>
         <a id="12810" class="Symbol">→</a> <a id="12812" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12814" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12765" class="Bound">M</a> <a id="12816" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12818" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12820" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12767" class="Bound">M′</a>
           <a id="12834" class="Comment">-------------------------</a>
         <a id="12869" class="Symbol">→</a> <a id="12871" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12873" class="Symbol">(</a><a id="12874" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12760" class="Bound">L</a> <a id="12876" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="12878" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12765" class="Bound">M</a><a id="12879" class="Symbol">)</a> <a id="12881" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="12883" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12885" class="Symbol">(</a><a id="12886" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12762" class="Bound">L′</a> <a id="12889" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="12891" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12767" class="Bound">M′</a><a id="12893" class="Symbol">)</a>
<a id="12895" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12744" class="Function">app-cong</a> <a id="12904" class="Symbol">{</a><a id="12905" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12905" class="Bound">Γ</a><a id="12906" class="Symbol">}{</a><a id="12908" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12908" class="Bound">L</a><a id="12909" class="Symbol">}{</a><a id="12911" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12911" class="Bound">L′</a><a id="12913" class="Symbol">}{</a><a id="12915" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12915" class="Bound">M</a><a id="12916" class="Symbol">}{</a><a id="12918" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12918" class="Bound">M′</a><a id="12920" class="Symbol">}</a> <a id="12922" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12922" class="Bound">L≅L′</a> <a id="12927" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12927" class="Bound">M≅M′</a> <a id="12932" class="Symbol">=</a>
  <a id="12936" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19164" class="Function Operator">start</a>
  <a id="12944" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12946" class="Symbol">(</a><a id="12947" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12908" class="Bound">L</a> <a id="12949" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="12951" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12915" class="Bound">M</a><a id="12952" class="Symbol">)</a>
  <a id="12956" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">≃⟨</a> <a id="12959" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9265" class="Function">app-equiv</a> <a id="12969" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">⟩</a>
  <a id="12973" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12975" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12908" class="Bound">L</a> <a id="12977" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="12979" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="12981" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12915" class="Bound">M</a>
  <a id="12985" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">≃⟨</a> <a id="12988" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11982" class="Function">●-cong</a> <a id="12995" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12922" class="Bound">L≅L′</a> <a id="13000" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12927" class="Bound">M≅M′</a> <a id="13005" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">⟩</a>
  <a id="13009" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="13011" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12911" class="Bound">L′</a> <a id="13014" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#5340" class="Function Operator">●</a> <a id="13016" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="13018" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12918" class="Bound">M′</a>
  <a id="13023" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">≃⟨</a> <a id="13026" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18484" class="Function">≃-sym</a> <a id="13032" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#9265" class="Function">app-equiv</a> <a id="13042" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19362" class="Function Operator">⟩</a>  
  <a id="13048" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="13050" class="Symbol">(</a><a id="13051" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12911" class="Bound">L′</a> <a id="13054" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="13056" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12918" class="Bound">M′</a><a id="13058" class="Symbol">)</a>
  <a id="13062" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#19502" class="Function Operator">☐</a>{% endraw %}</pre>


## Compositionality

The _compositionality property_ states that surrounding two terms that
are denotationally equal in the same context produces two programs
that are denotationally equal. To make this precise, we define what we
mean by "context" and "surround".

A _context_ is a program with one hole in it. The following data
definition `Ctx` makes this idea explicit. We index the `Ctx` data
type with two contexts for variables: one for the the hole and one for
terms that result from filling the hole.

<pre class="Agda">{% raw %}<a id="13600" class="Keyword">data</a> <a id="Ctx"></a><a id="13605" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13609" class="Symbol">:</a> <a id="13611" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2980" class="Datatype">Context</a> <a id="13619" class="Symbol">→</a> <a id="13621" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2980" class="Datatype">Context</a> <a id="13629" class="Symbol">→</a> <a id="13631" class="PrimitiveType">Set</a> <a id="13635" class="Keyword">where</a>
  <a id="Ctx.CHole"></a><a id="13643" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13643" class="InductiveConstructor">CHole</a> <a id="13649" class="Symbol">:</a> <a id="13651" class="Symbol">∀{</a><a id="13653" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13653" class="Bound">Γ</a><a id="13654" class="Symbol">}</a> <a id="13656" class="Symbol">→</a> <a id="13658" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13662" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13653" class="Bound">Γ</a> <a id="13664" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13653" class="Bound">Γ</a>
  <a id="Ctx.CLam"></a><a id="13668" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13668" class="InductiveConstructor">CLam</a> <a id="13673" class="Symbol">:</a>  <a id="13676" class="Symbol">∀{</a><a id="13678" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13678" class="Bound">Γ</a> <a id="13680" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13680" class="Bound">Δ</a><a id="13681" class="Symbol">}</a> <a id="13683" class="Symbol">→</a> <a id="13685" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13689" class="Symbol">(</a><a id="13690" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13678" class="Bound">Γ</a> <a id="13692" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="13694" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="13695" class="Symbol">)</a> <a id="13697" class="Symbol">(</a><a id="13698" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13680" class="Bound">Δ</a> <a id="13700" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="13702" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="13703" class="Symbol">)</a> <a id="13705" class="Symbol">→</a> <a id="13707" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13711" class="Symbol">(</a><a id="13712" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13678" class="Bound">Γ</a> <a id="13714" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#3018" class="InductiveConstructor Operator">,</a> <a id="13716" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="13717" class="Symbol">)</a> <a id="13719" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13680" class="Bound">Δ</a>
  <a id="Ctx.CAppL"></a><a id="13723" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13723" class="InductiveConstructor">CAppL</a> <a id="13729" class="Symbol">:</a> <a id="13731" class="Symbol">∀{</a><a id="13733" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13733" class="Bound">Γ</a> <a id="13735" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13735" class="Bound">Δ</a><a id="13736" class="Symbol">}</a> <a id="13738" class="Symbol">→</a> <a id="13740" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13733" class="Bound">Γ</a> <a id="13746" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13735" class="Bound">Δ</a> <a id="13748" class="Symbol">→</a> <a id="13750" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13735" class="Bound">Δ</a> <a id="13752" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="13754" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="13756" class="Symbol">→</a> <a id="13758" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13733" class="Bound">Γ</a> <a id="13764" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13735" class="Bound">Δ</a>
  <a id="Ctx.CAppR"></a><a id="13768" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13768" class="InductiveConstructor">CAppR</a> <a id="13774" class="Symbol">:</a> <a id="13776" class="Symbol">∀{</a><a id="13778" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13778" class="Bound">Γ</a> <a id="13780" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13780" class="Bound">Δ</a><a id="13781" class="Symbol">}</a> <a id="13783" class="Symbol">→</a> <a id="13785" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13780" class="Bound">Δ</a> <a id="13787" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="13789" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="13791" class="Symbol">→</a> <a id="13793" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13797" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13778" class="Bound">Γ</a> <a id="13799" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13780" class="Bound">Δ</a> <a id="13801" class="Symbol">→</a> <a id="13803" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="13807" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13778" class="Bound">Γ</a> <a id="13809" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13780" class="Bound">Δ</a>{% endraw %}</pre>

* The constructor `CHole` represents the hole, and in this case the
  variable context for the hole is the same as the variable context
  for the term that results from filling the hole.

* The constructor `CLam` takes a `Ctx` and produces a larger one that
  adds a lambda abstraction at the top. The variable context of the
  hole stays the same, whereas we remove one variable from the context
  of the resulting term because it is bound by this lambda
  abstraction.

* There are two constructions for application, `CAppL` and
  `CAppR`. The `CAppL` is for when the hole is inside the left-hand
  term (the operator) and the later is when the hole is inside the
  right-hand term (the operand).
  
The action of surrounding a term with a context is defined by the
following `plug` function. It is defined by recursion on the context.

<pre class="Agda">{% raw %}<a id="plug"></a><a id="14675" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14680" class="Symbol">:</a> <a id="14682" class="Symbol">∀{</a><a id="14684" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14684" class="Bound">Γ</a><a id="14685" class="Symbol">}{</a><a id="14687" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14687" class="Bound">Δ</a><a id="14688" class="Symbol">}</a> <a id="14690" class="Symbol">→</a> <a id="14692" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="14696" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14684" class="Bound">Γ</a> <a id="14698" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14687" class="Bound">Δ</a> <a id="14700" class="Symbol">→</a> <a id="14702" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14684" class="Bound">Γ</a> <a id="14704" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="14706" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a> <a id="14708" class="Symbol">→</a> <a id="14710" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14687" class="Bound">Δ</a> <a id="14712" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="14714" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a>
<a id="14716" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14721" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13643" class="InductiveConstructor">CHole</a> <a id="14727" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14727" class="Bound">M</a> <a id="14729" class="Symbol">=</a> <a id="14731" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14727" class="Bound">M</a>
<a id="14733" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14738" class="Symbol">(</a><a id="14739" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13668" class="InductiveConstructor">CLam</a> <a id="14744" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14744" class="Bound">C</a><a id="14745" class="Symbol">)</a> <a id="14747" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14747" class="Bound">N</a> <a id="14749" class="Symbol">=</a> <a id="14751" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4238" class="InductiveConstructor Operator">ƛ</a> <a id="14753" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14758" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14744" class="Bound">C</a> <a id="14760" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14747" class="Bound">N</a>
<a id="14762" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14767" class="Symbol">(</a><a id="14768" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13723" class="InductiveConstructor">CAppL</a> <a id="14774" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14774" class="Bound">C</a> <a id="14776" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14776" class="Bound">N</a><a id="14777" class="Symbol">)</a> <a id="14779" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14779" class="Bound">L</a> <a id="14781" class="Symbol">=</a> <a id="14783" class="Symbol">(</a><a id="14784" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14789" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14774" class="Bound">C</a> <a id="14791" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14779" class="Bound">L</a><a id="14792" class="Symbol">)</a> <a id="14794" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="14796" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14776" class="Bound">N</a>
<a id="14798" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14803" class="Symbol">(</a><a id="14804" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13768" class="InductiveConstructor">CAppR</a> <a id="14810" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14810" class="Bound">L</a> <a id="14812" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14812" class="Bound">C</a><a id="14813" class="Symbol">)</a> <a id="14815" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14815" class="Bound">M</a> <a id="14817" class="Symbol">=</a> <a id="14819" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14810" class="Bound">L</a> <a id="14821" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4298" class="InductiveConstructor Operator">·</a> <a id="14823" class="Symbol">(</a><a id="14824" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="14829" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14812" class="Bound">C</a> <a id="14831" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14815" class="Bound">M</a><a id="14832" class="Symbol">)</a>{% endraw %}</pre>

We are ready to state and prove the compositionality principle.  Given
two terms `M` and `N` that are denotationally equal, plugging them both
into an arbitrary context `C` produces two programs that are
denotationally equal.

<pre class="Agda">{% raw %}<a id="compositionality"></a><a id="15086" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15103" class="Symbol">:</a> <a id="15105" class="Symbol">∀{</a><a id="15107" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15107" class="Bound">Γ</a> <a id="15109" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15109" class="Bound">Δ</a><a id="15110" class="Symbol">}{</a><a id="15112" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15112" class="Bound">C</a> <a id="15114" class="Symbol">:</a> <a id="15116" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13605" class="Datatype">Ctx</a> <a id="15120" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15107" class="Bound">Γ</a> <a id="15122" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15109" class="Bound">Δ</a><a id="15123" class="Symbol">}</a> <a id="15125" class="Symbol">{</a><a id="15126" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15126" class="Bound">M</a> <a id="15128" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15128" class="Bound">N</a> <a id="15130" class="Symbol">:</a> <a id="15132" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15107" class="Bound">Γ</a> <a id="15134" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#4150" class="Datatype Operator">⊢</a> <a id="15136" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Untyped.md %}{% raw %}#2694" class="InductiveConstructor">★</a><a id="15137" class="Symbol">}</a>
              <a id="15153" class="Symbol">→</a> <a id="15155" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="15157" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15126" class="Bound">M</a> <a id="15159" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="15161" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="15163" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15128" class="Bound">N</a>
                <a id="15181" class="Comment">---------------------------</a>
              <a id="15223" class="Symbol">→</a> <a id="15225" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="15227" class="Symbol">(</a><a id="15228" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="15233" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15112" class="Bound">C</a> <a id="15235" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15126" class="Bound">M</a><a id="15236" class="Symbol">)</a> <a id="15238" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#18196" class="Function Operator">≃</a> <a id="15240" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Denotational.md %}{% raw %}#17998" class="Function">ℰ</a> <a id="15242" class="Symbol">(</a><a id="15243" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#14675" class="Function">plug</a> <a id="15248" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15112" class="Bound">C</a> <a id="15250" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15128" class="Bound">N</a><a id="15251" class="Symbol">)</a>
<a id="15253" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15270" class="Symbol">{</a><a id="15271" class="Argument">C</a> <a id="15273" class="Symbol">=</a> <a id="15275" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13643" class="InductiveConstructor">CHole</a><a id="15280" class="Symbol">}</a> <a id="15282" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15282" class="Bound">M≃N</a> <a id="15286" class="Symbol">=</a>
  <a id="15290" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15282" class="Bound">M≃N</a>
<a id="15294" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15311" class="Symbol">{</a><a id="15312" class="Argument">C</a> <a id="15314" class="Symbol">=</a> <a id="15316" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13668" class="InductiveConstructor">CLam</a> <a id="15321" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15321" class="Bound">C′</a><a id="15323" class="Symbol">}</a> <a id="15325" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15325" class="Bound">M≃N</a> <a id="15329" class="Symbol">=</a>
  <a id="15333" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#11460" class="Function">lam-cong</a> <a id="15342" class="Symbol">(</a><a id="15343" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15360" class="Symbol">{</a><a id="15361" class="Argument">C</a> <a id="15363" class="Symbol">=</a> <a id="15365" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15321" class="Bound">C′</a><a id="15367" class="Symbol">}</a> <a id="15369" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15325" class="Bound">M≃N</a><a id="15372" class="Symbol">)</a>
<a id="15374" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15391" class="Symbol">{</a><a id="15392" class="Argument">C</a> <a id="15394" class="Symbol">=</a> <a id="15396" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13723" class="InductiveConstructor">CAppL</a> <a id="15402" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15402" class="Bound">C′</a> <a id="15405" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15405" class="Bound">L</a><a id="15406" class="Symbol">}</a> <a id="15408" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15408" class="Bound">M≃N</a> <a id="15412" class="Symbol">=</a>
  <a id="15416" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12744" class="Function">app-cong</a> <a id="15425" class="Symbol">(</a><a id="15426" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15443" class="Symbol">{</a><a id="15444" class="Argument">C</a> <a id="15446" class="Symbol">=</a> <a id="15448" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15402" class="Bound">C′</a><a id="15450" class="Symbol">}</a> <a id="15452" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15408" class="Bound">M≃N</a><a id="15455" class="Symbol">)</a> <a id="15457" class="Symbol">λ</a> <a id="15459" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15459" class="Bound">γ</a> <a id="15461" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15461" class="Bound">v</a> <a id="15463" class="Symbol">→</a> <a id="15465" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="15467" class="Symbol">(λ</a> <a id="15470" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15470" class="Bound">x</a> <a id="15472" class="Symbol">→</a> <a id="15474" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15470" class="Bound">x</a><a id="15475" class="Symbol">)</a> <a id="15477" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="15479" class="Symbol">(λ</a> <a id="15482" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15482" class="Bound">x</a> <a id="15484" class="Symbol">→</a> <a id="15486" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15482" class="Bound">x</a><a id="15487" class="Symbol">)</a> <a id="15489" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="15491" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15508" class="Symbol">{</a><a id="15509" class="Argument">C</a> <a id="15511" class="Symbol">=</a> <a id="15513" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#13768" class="InductiveConstructor">CAppR</a> <a id="15519" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15519" class="Bound">L</a> <a id="15521" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15521" class="Bound">C′</a><a id="15523" class="Symbol">}</a> <a id="15525" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15525" class="Bound">M≃N</a> <a id="15529" class="Symbol">=</a>
  <a id="15533" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#12744" class="Function">app-cong</a> <a id="15542" class="Symbol">(λ</a> <a id="15545" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15545" class="Bound">γ</a> <a id="15547" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15547" class="Bound">v</a> <a id="15549" class="Symbol">→</a> <a id="15551" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="15553" class="Symbol">(λ</a> <a id="15556" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15556" class="Bound">x</a> <a id="15558" class="Symbol">→</a> <a id="15560" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15556" class="Bound">x</a><a id="15561" class="Symbol">)</a> <a id="15563" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="15565" class="Symbol">(λ</a> <a id="15568" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15568" class="Bound">x</a> <a id="15570" class="Symbol">→</a> <a id="15572" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15568" class="Bound">x</a><a id="15573" class="Symbol">)</a> <a id="15575" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a><a id="15576" class="Symbol">)</a> <a id="15578" class="Symbol">(</a><a id="15579" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15086" class="Function">compositionality</a> <a id="15596" class="Symbol">{</a><a id="15597" class="Argument">C</a> <a id="15599" class="Symbol">=</a> <a id="15601" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15521" class="Bound">C′</a><a id="15603" class="Symbol">}</a> <a id="15605" href="{% endraw %}{{ site.baseurl }}{% link out/plfa/Compositional.md %}{% raw %}#15525" class="Bound">M≃N</a><a id="15608" class="Symbol">)</a>{% endraw %}</pre>

The proof is a straightforward induction on the context `C`, using the
congruence properties `lam-cong` and `app-cong` that we established
above.

## Unicode

This chapter uses the following unicode:

    ℱ  U+2131  SCRIPT CAPITAL F (\McF)
    ●  U+2131  BLACK CIRCLE (\cib)
    
