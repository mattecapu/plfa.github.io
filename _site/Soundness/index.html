<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Soundness: of reduction with respect to denotational semantics | Programming Language Foundations in Agda
</title><!-- Begin Jekyll SEO tag v2.5.0 -->
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Soundness: of reduction with respect to denotational semantics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Programming Language Foundations in Agda" />
<meta property="og:description" content="Programming Language Foundations in Agda" />
<link rel="canonical" href="https://plfa.github.io/Soundness/" />
<meta property="og:url" content="https://plfa.github.io/Soundness/" />
<meta property="og:site_name" content="Programming Language Foundations in Agda" />
<script type="application/ld+json">
{"description":"Programming Language Foundations in Agda","@type":"WebPage","url":"https://plfa.github.io/Soundness/","headline":"Soundness: of reduction with respect to denotational semantics","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"></head>
<body><header class="site-header" role="banner">

    <div class="wrapper">

        <a class="site-title" href="/">Programming Language Foundations in Agda
</a>

        <nav class="site-nav">
            <span class="menu-icon">
                <svg viewBox="0 0 18 15" width="18px" height="15px">
                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </span>

            <div class="trigger">
                <a class="page-link" href="/">Table of Contents</a>
                <a class="page-link" href="/GettingStarted/">Getting Started</a>
            </div>
        </nav>

    </div>

</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
      <h1 class="post-title">Soundness: of reduction with respect to denotational semantics</h1>
  </header>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


  <div class="post-content">
    <pre class="Agda"><a id="192" class="Keyword">module</a> <a id="199" href="/Soundness/" class="Module">plfa.Soundness</a> <a id="214" class="Keyword">where</a></pre>

<h2 id="introduction">Introduction</h2>

<p>In this chapter we prove that the reduction semantics is sound with
respect to the denotational semantics, i.e., for any term L</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>L —↠ ƛ N  implies  ℰ L ≃ ℰ (ƛ N)
</code></pre></div></div>

<p>The proof is by induction on the reduction sequence, so the main lemma
concerns a single reduction step. We prove that if any term <code class="highlighter-rouge">M</code> steps
to a term <code class="highlighter-rouge">N</code>, then <code class="highlighter-rouge">M</code> and <code class="highlighter-rouge">N</code> are denotationally equal. We shall
prove each direction of this if-and-only-if separately. One direction
will look just like a type preservation proof. The other direction is
like proving type preservation for reduction going in reverse.  Recall
that type preservation is sometimes called subject
reduction. Preservation in reverse is a well-known property and is
called <em>subject expansion</em>. It is also well-known that subject
expansion is false for most typed lambda calculi!</p>

<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="1094" class="Keyword">open</a> <a id="1099" class="Keyword">import</a> <a id="1106" href="/Untyped/" class="Module">plfa.Untyped</a>
  <a id="1121" class="Keyword">using</a> <a id="1127" class="Symbol">(</a><a id="1128" href="/Untyped/#2980" class="Datatype">Context</a><a id="1135" class="Symbol">;</a> <a id="1137" href="/Untyped/#3018" class="InductiveConstructor Operator">_,_</a><a id="1140" class="Symbol">;</a> <a id="1142" href="/Untyped/#3365" class="Datatype Operator">_∋_</a><a id="1145" class="Symbol">;</a> <a id="1147" href="/Untyped/#4150" class="Datatype Operator">_⊢_</a><a id="1150" class="Symbol">;</a> <a id="1152" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="1153" class="Symbol">;</a> <a id="1155" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="1156" class="Symbol">;</a> <a id="1158" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a><a id="1160" class="Symbol">;</a> <a id="1162" href="/Untyped/#4186" class="InductiveConstructor Operator">`_</a><a id="1164" class="Symbol">;</a> <a id="1166" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ_</a><a id="1168" class="Symbol">;</a> <a id="1170" href="/Untyped/#4298" class="InductiveConstructor Operator">_·_</a><a id="1173" class="Symbol">;</a>
         <a id="1184" href="/Untyped/#6931" class="Function">subst</a><a id="1189" class="Symbol">;</a> <a id="1191" href="/Untyped/#7475" class="Function Operator">_[_]</a><a id="1195" class="Symbol">;</a> <a id="1197" href="/Untyped/#7359" class="Function">subst-zero</a><a id="1207" class="Symbol">;</a> <a id="1209" href="/Untyped/#5845" class="Function">ext</a><a id="1212" class="Symbol">;</a> <a id="1214" href="/Untyped/#6171" class="Function">rename</a><a id="1220" class="Symbol">;</a> <a id="1222" href="/Untyped/#6623" class="Function">exts</a><a id="1226" class="Symbol">)</a>
<a id="1228" class="Keyword">open</a> <a id="1233" class="Keyword">import</a> <a id="1240" href="/LambdaReduction/" class="Module">plfa.LambdaReduction</a>
  <a id="1263" class="Keyword">using</a> <a id="1269" class="Symbol">(</a><a id="1270" href="/LambdaReduction/#386" class="Datatype Operator">_—→_</a><a id="1274" class="Symbol">;</a> <a id="1276" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a><a id="1278" class="Symbol">;</a> <a id="1280" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a><a id="1282" class="Symbol">;</a> <a id="1284" href="/LambdaReduction/#616" class="InductiveConstructor">β</a><a id="1285" class="Symbol">;</a> <a id="1287" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a><a id="1288" class="Symbol">;</a> <a id="1290" href="/LambdaReduction/#894" class="Datatype Operator">_—↠_</a><a id="1294" class="Symbol">;</a> <a id="1296" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">_—→⟨_⟩_</a><a id="1303" class="Symbol">;</a> <a id="1305" href="/LambdaReduction/#944" class="InductiveConstructor Operator">_[]</a><a id="1308" class="Symbol">)</a>
<a id="1310" class="Keyword">open</a> <a id="1315" class="Keyword">import</a> <a id="1322" href="/Substitution/" class="Module">plfa.Substitution</a> <a id="1340" class="Keyword">using</a> <a id="1346" class="Symbol">(</a><a id="1347" href="/Substitution/#2277" class="Function">Rename</a><a id="1353" class="Symbol">;</a> <a id="1355" href="/Substitution/#2506" class="Function">Subst</a><a id="1360" class="Symbol">;</a> <a id="1362" href="/Substitution/#3179" class="Function">ids</a><a id="1365" class="Symbol">)</a>  
<a id="1369" class="Keyword">open</a> <a id="1374" class="Keyword">import</a> <a id="1381" href="/Denotational/" class="Module">plfa.Denotational</a>
  <a id="1401" class="Keyword">using</a> <a id="1407" class="Symbol">(</a><a id="1408" href="/Denotational/#4000" class="Datatype">Value</a><a id="1413" class="Symbol">;</a> <a id="1415" href="/Denotational/#4020" class="InductiveConstructor">⊥</a><a id="1416" class="Symbol">;</a> <a id="1418" href="/Denotational/#7234" class="Function">Env</a><a id="1421" class="Symbol">;</a> <a id="1423" href="/Denotational/#9520" class="Datatype Operator">_⊢_↓_</a><a id="1428" class="Symbol">;</a> <a id="1430" href="/Denotational/#7407" class="Function Operator">_`,_</a><a id="1434" class="Symbol">;</a> <a id="1436" href="/Denotational/#4371" class="Datatype Operator">_⊑_</a><a id="1439" class="Symbol">;</a> <a id="1441" href="/Denotational/#8260" class="Function Operator">_`⊑_</a><a id="1445" class="Symbol">;</a> <a id="1447" href="/Denotational/#8479" class="Function">`⊥</a><a id="1449" class="Symbol">;</a> <a id="1451" href="/Denotational/#8508" class="Function Operator">_`⊔_</a><a id="1455" class="Symbol">;</a> <a id="1457" href="/Denotational/#7660" class="Function">init</a><a id="1461" class="Symbol">;</a> <a id="1463" href="/Denotational/#7715" class="Function">last</a><a id="1467" class="Symbol">;</a> <a id="1469" href="/Denotational/#7764" class="Function">init-last</a><a id="1478" class="Symbol">;</a>
         <a id="1489" href="/Denotational/#5541" class="Function">Refl⊑</a><a id="1494" class="Symbol">;</a> <a id="1496" href="/Denotational/#4668" class="InductiveConstructor">Trans⊑</a><a id="1502" class="Symbol">;</a> <a id="1504" href="/Denotational/#8778" class="Function">`Refl⊑</a><a id="1510" class="Symbol">;</a> <a id="1512" href="/Denotational/#25313" class="Function">Env⊑</a><a id="1516" class="Symbol">;</a> <a id="1518" href="/Denotational/#8846" class="Function">EnvConjR1⊑</a><a id="1528" class="Symbol">;</a> <a id="1530" href="/Denotational/#8943" class="Function">EnvConjR2⊑</a><a id="1540" class="Symbol">;</a> <a id="1542" href="/Denotational/#25757" class="Function">up-env</a><a id="1548" class="Symbol">;</a>
         <a id="1559" href="/Denotational/#9574" class="InductiveConstructor">var</a><a id="1562" class="Symbol">;</a> <a id="1564" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a><a id="1570" class="Symbol">;</a> <a id="1572" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a><a id="1579" class="Symbol">;</a> <a id="1581" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a><a id="1588" class="Symbol">;</a> <a id="1590" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a><a id="1597" class="Symbol">;</a> <a id="1599" href="/Denotational/#10126" class="InductiveConstructor">sub</a><a id="1602" class="Symbol">;</a>
         <a id="1613" href="/Denotational/#23704" class="Function">rename-pres</a><a id="1624" class="Symbol">;</a> <a id="1626" href="/Denotational/#17998" class="Function">ℰ</a><a id="1627" class="Symbol">;</a> <a id="1629" href="/Denotational/#18196" class="Function Operator">_≃_</a><a id="1632" class="Symbol">;</a> <a id="1634" href="/Denotational/#18617" class="Function">≃-trans</a><a id="1641" class="Symbol">)</a>
<a id="1643" class="Keyword">open</a> <a id="1648" class="Keyword">import</a> <a id="1655" href="/Compositional/" class="Module">plfa.Compositional</a> <a id="1674" class="Keyword">using</a> <a id="1680" class="Symbol">(</a><a id="1681" href="/Compositional/#3363" class="Function">lambda-inversion</a><a id="1697" class="Symbol">;</a> <a id="1699" href="/Compositional/#9536" class="Function">var-inv</a><a id="1706" class="Symbol">)</a>

<a id="1709" class="Keyword">open</a> <a id="1714" class="Keyword">import</a> <a id="1721" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a>
  <a id="1761" class="Keyword">using</a> <a id="1767" class="Symbol">(</a><a id="1768" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a><a id="1771" class="Symbol">;</a> <a id="1773" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">_≢_</a><a id="1776" class="Symbol">;</a> <a id="1778" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="1782" class="Symbol">;</a> <a id="1784" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a><a id="1787" class="Symbol">;</a> <a id="1789" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html#1170" class="Function">cong</a><a id="1793" class="Symbol">;</a> <a id="1795" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html#1408" class="Function">cong₂</a><a id="1800" class="Symbol">;</a> <a id="1802" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.html#1274" class="Function">cong-app</a><a id="1810" class="Symbol">)</a>
<a id="1812" class="Keyword">open</a> <a id="1817" class="Keyword">import</a> <a id="1824" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html" class="Module">Data.Product</a> <a id="1837" class="Keyword">using</a> <a id="1843" class="Symbol">(</a><a id="1844" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">_×_</a><a id="1847" class="Symbol">;</a> <a id="1849" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#69" class="Record">Σ</a><a id="1850" class="Symbol">;</a> <a id="1852" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ-syntax</a><a id="1860" class="Symbol">;</a> <a id="1862" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#881" class="Function">∃</a><a id="1863" class="Symbol">;</a> <a id="1865" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#942" class="Function">∃-syntax</a><a id="1873" class="Symbol">;</a> <a id="1875" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#155" class="Field">proj₁</a><a id="1880" class="Symbol">;</a> <a id="1882" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#167" class="Field">proj₂</a><a id="1887" class="Symbol">)</a>
  <a id="1891" class="Keyword">renaming</a> <a id="1900" class="Symbol">(</a><a id="1901" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">_,_</a> <a id="1905" class="Symbol">to</a> <a id="1908" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨_,_⟩</a><a id="1913" class="Symbol">)</a>
<a id="1915" class="Keyword">open</a> <a id="1920" class="Keyword">import</a> <a id="1927" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Primitive.html" class="Module">Agda.Primitive</a> <a id="1942" class="Keyword">using</a> <a id="1948" class="Symbol">(</a><a id="1949" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Primitive.html#611" class="Primitive">lzero</a><a id="1954" class="Symbol">)</a>
<a id="1956" class="Keyword">open</a> <a id="1961" class="Keyword">import</a> <a id="1968" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1985" class="Keyword">using</a> <a id="1991" class="Symbol">(</a><a id="1992" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#464" class="Function Operator">¬_</a><a id="1994" class="Symbol">)</a>
<a id="1996" class="Keyword">open</a> <a id="2001" class="Keyword">import</a> <a id="2008" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.Negation.html" class="Module">Relation.Nullary.Negation</a> <a id="2034" class="Keyword">using</a> <a id="2040" class="Symbol">(</a><a id="2041" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.Negation.html#560" class="Function">contradiction</a><a id="2054" class="Symbol">)</a>
<a id="2056" class="Keyword">open</a> <a id="2061" class="Keyword">import</a> <a id="2068" href="https://agda.github.io/agda-stdlib/v0.17/Data.Empty.html" class="Module">Data.Empty</a> <a id="2079" class="Keyword">using</a> <a id="2085" class="Symbol">(</a><a id="2086" href="https://agda.github.io/agda-stdlib/v0.17/Data.Empty.html#360" class="Function">⊥-elim</a><a id="2092" class="Symbol">)</a>
<a id="2094" class="Keyword">open</a> <a id="2099" class="Keyword">import</a> <a id="2106" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="2123" class="Keyword">using</a> <a id="2129" class="Symbol">(</a><a id="2130" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#534" class="Datatype">Dec</a><a id="2133" class="Symbol">;</a> <a id="2135" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a><a id="2138" class="Symbol">;</a> <a id="2140" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a><a id="2142" class="Symbol">)</a>
<a id="2144" class="Keyword">open</a> <a id="2149" class="Keyword">import</a> <a id="2156" href="https://agda.github.io/agda-stdlib/v0.17/Function.html" class="Module">Function</a> <a id="2165" class="Keyword">using</a> <a id="2171" class="Symbol">(</a><a id="2172" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">_∘_</a><a id="2175" class="Symbol">)</a>
<a id="2177" class="Comment">-- open import plfa.Isomorphism using (extensionality)  -- causes a bug!</a></pre>

<h2 id="forward-reduction-preserves-denotations">Forward reduction preserves denotations</h2>

<p>The proof of preservation in this section mixes techniques from
previous chapters. Like the proof of preservation for the STLC, we are
preserving a relation defined separately from the syntax, in contrast
to the inherently typed terms. On the other hand, we are using de
Bruijn indices for variables.</p>

<p>The outline of the proof remains the same in that we must prove lemmas
concerning all of the auxiliary functions used in the reduction
relation: substitution, renaming, and extension.</p>

<h3 id="simultaneous-substitution-preserves-denotations">Simultaneous substitution preserves denotations</h3>

<p>Our next goal is to prove that simultaneous substitution preserves
meaning.  That is, if <code class="highlighter-rouge">M</code> results in <code class="highlighter-rouge">v</code> in environment <code class="highlighter-rouge">γ</code>, then applying a
substitution <code class="highlighter-rouge">σ</code> to <code class="highlighter-rouge">M</code> gives us a program that also results in <code class="highlighter-rouge">v</code>, but in
an environment <code class="highlighter-rouge">δ</code> in which, for every variable <code class="highlighter-rouge">x</code>, <code class="highlighter-rouge">σ x</code> results in the
same value as the one for <code class="highlighter-rouge">x</code> in the original environment <code class="highlighter-rouge">γ</code>.
We write <code class="highlighter-rouge">δ ⊢ σ ↓ γ</code> for this condition.</p>

<pre class="Agda"><a id="3259" class="Keyword">infix</a> <a id="3265" class="Number">3</a> <a id="3267" href="/Soundness/#3274" class="Function Operator">_`⊢_↓_</a>
<a id="_`⊢_↓_"></a><a id="3274" href="/Soundness/#3274" class="Function Operator">_`⊢_↓_</a> <a id="3281" class="Symbol">:</a> <a id="3283" class="Symbol">∀{</a><a id="3285" href="/Soundness/#3285" class="Bound">Δ</a> <a id="3287" href="/Soundness/#3287" class="Bound">Γ</a><a id="3288" class="Symbol">}</a> <a id="3290" class="Symbol">→</a> <a id="3292" href="/Denotational/#7234" class="Function">Env</a> <a id="3296" href="/Soundness/#3285" class="Bound">Δ</a> <a id="3298" class="Symbol">→</a> <a id="3300" href="/Substitution/#2506" class="Function">Subst</a> <a id="3306" href="/Soundness/#3287" class="Bound">Γ</a> <a id="3308" href="/Soundness/#3285" class="Bound">Δ</a> <a id="3310" class="Symbol">→</a> <a id="3312" href="/Denotational/#7234" class="Function">Env</a> <a id="3316" href="/Soundness/#3287" class="Bound">Γ</a> <a id="3318" class="Symbol">→</a> <a id="3320" class="PrimitiveType">Set</a>
<a id="3324" href="/Soundness/#3274" class="Function Operator">_`⊢_↓_</a> <a id="3331" class="Symbol">{</a><a id="3332" href="/Soundness/#3332" class="Bound">Δ</a><a id="3333" class="Symbol">}{</a><a id="3335" href="/Soundness/#3335" class="Bound">Γ</a><a id="3336" class="Symbol">}</a> <a id="3338" href="/Soundness/#3338" class="Bound">δ</a> <a id="3340" href="/Soundness/#3340" class="Bound">σ</a> <a id="3342" href="/Soundness/#3342" class="Bound">γ</a> <a id="3344" class="Symbol">=</a> <a id="3346" class="Symbol">(∀</a> <a id="3349" class="Symbol">(</a><a id="3350" href="/Soundness/#3350" class="Bound">x</a> <a id="3352" class="Symbol">:</a> <a id="3354" href="/Soundness/#3335" class="Bound">Γ</a> <a id="3356" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="3358" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="3359" class="Symbol">)</a> <a id="3361" class="Symbol">→</a> <a id="3363" href="/Soundness/#3338" class="Bound">δ</a> <a id="3365" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="3367" href="/Soundness/#3340" class="Bound">σ</a> <a id="3369" href="/Soundness/#3350" class="Bound">x</a> <a id="3371" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="3373" href="/Soundness/#3342" class="Bound">γ</a> <a id="3375" href="/Soundness/#3350" class="Bound">x</a><a id="3376" class="Symbol">)</a></pre>

<p>As usual, to prepare for lambda abstraction, we prove an extension
lemma. It says that applying the <code class="highlighter-rouge">exts</code> function to a substitution
produces a new substitution that maps variables to terms that when
evaluated in <code class="highlighter-rouge">δ , v</code> produce the values in <code class="highlighter-rouge">γ , v</code>.</p>

<pre class="Agda"><a id="subst-ext"></a><a id="3657" href="/Soundness/#3657" class="Function">subst-ext</a> <a id="3667" class="Symbol">:</a> <a id="3669" class="Symbol">∀</a> <a id="3671" class="Symbol">{</a><a id="3672" href="/Soundness/#3672" class="Bound">Γ</a> <a id="3674" href="/Soundness/#3674" class="Bound">Δ</a> <a id="3676" href="/Soundness/#3676" class="Bound">v</a><a id="3677" class="Symbol">}</a> <a id="3679" class="Symbol">{</a><a id="3680" href="/Soundness/#3680" class="Bound">γ</a> <a id="3682" class="Symbol">:</a> <a id="3684" href="/Denotational/#7234" class="Function">Env</a> <a id="3688" href="/Soundness/#3672" class="Bound">Γ</a><a id="3689" class="Symbol">}</a> <a id="3691" class="Symbol">{</a><a id="3692" href="/Soundness/#3692" class="Bound">δ</a> <a id="3694" class="Symbol">:</a> <a id="3696" href="/Denotational/#7234" class="Function">Env</a> <a id="3700" href="/Soundness/#3674" class="Bound">Δ</a><a id="3701" class="Symbol">}</a>
  <a id="3705" class="Symbol">→</a> <a id="3707" class="Symbol">(</a><a id="3708" href="/Soundness/#3708" class="Bound">σ</a> <a id="3710" class="Symbol">:</a> <a id="3712" href="/Substitution/#2506" class="Function">Subst</a> <a id="3718" href="/Soundness/#3672" class="Bound">Γ</a> <a id="3720" href="/Soundness/#3674" class="Bound">Δ</a><a id="3721" class="Symbol">)</a>
  <a id="3725" class="Symbol">→</a> <a id="3727" href="/Soundness/#3692" class="Bound">δ</a> <a id="3729" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="3732" href="/Soundness/#3708" class="Bound">σ</a> <a id="3734" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="3736" href="/Soundness/#3680" class="Bound">γ</a>
   <a id="3741" class="Comment">--------------------------</a>
  <a id="3770" class="Symbol">→</a> <a id="3772" href="/Soundness/#3692" class="Bound">δ</a> <a id="3774" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="3777" href="/Soundness/#3676" class="Bound">v</a> <a id="3779" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="3782" href="/Untyped/#6623" class="Function">exts</a> <a id="3787" href="/Soundness/#3708" class="Bound">σ</a> <a id="3789" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="3791" href="/Soundness/#3680" class="Bound">γ</a> <a id="3793" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="3796" href="/Soundness/#3676" class="Bound">v</a>
<a id="3798" href="/Soundness/#3657" class="Function">subst-ext</a> <a id="3808" href="/Soundness/#3808" class="Bound">σ</a> <a id="3810" href="/Soundness/#3810" class="Bound">d</a> <a id="3812" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="3814" class="Symbol">=</a> <a id="3816" href="/Denotational/#9574" class="InductiveConstructor">var</a>
<a id="3820" href="/Soundness/#3657" class="Function">subst-ext</a> <a id="3830" href="/Soundness/#3830" class="Bound">σ</a> <a id="3832" href="/Soundness/#3832" class="Bound">d</a> <a id="3834" class="Symbol">(</a><a id="3835" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="3837" href="/Soundness/#3837" class="Bound">x′</a><a id="3839" class="Symbol">)</a> <a id="3841" class="Symbol">=</a> <a id="3843" href="/Denotational/#23704" class="Function">rename-pres</a> <a id="3855" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="3858" class="Symbol">(λ</a> <a id="3861" href="/Soundness/#3861" class="Bound">_</a> <a id="3863" class="Symbol">→</a> <a id="3865" href="/Denotational/#5541" class="Function">Refl⊑</a><a id="3870" class="Symbol">)</a> <a id="3872" class="Symbol">(</a><a id="3873" href="/Soundness/#3832" class="Bound">d</a> <a id="3875" href="/Soundness/#3837" class="Bound">x′</a><a id="3877" class="Symbol">)</a></pre>

<p>The proof is by cases on the de Bruijn index <code class="highlighter-rouge">x</code>.</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then we need to show that <code class="highlighter-rouge">δ , v ⊢ # 0 ↓ v</code>,
which we have by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x′</code>,then we need to show that 
<code class="highlighter-rouge">δ , v ⊢ rename S_ (σ x′) ↓ nth x′ γ</code>,
which we obtain by the <code class="highlighter-rouge">rename-pres</code> lemma.</p>
  </li>
</ul>

<p>With the extension lemma in hand, the proof that simultaneous
substitution preserves meaning is straightforward.  Let’s dive in!</p>

<pre class="Agda"><a id="subst-pres"></a><a id="4311" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4322" class="Symbol">:</a> <a id="4324" class="Symbol">∀</a> <a id="4326" class="Symbol">{</a><a id="4327" href="/Soundness/#4327" class="Bound">Γ</a> <a id="4329" href="/Soundness/#4329" class="Bound">Δ</a> <a id="4331" href="/Soundness/#4331" class="Bound">v</a><a id="4332" class="Symbol">}</a> <a id="4334" class="Symbol">{</a><a id="4335" href="/Soundness/#4335" class="Bound">γ</a> <a id="4337" class="Symbol">:</a> <a id="4339" href="/Denotational/#7234" class="Function">Env</a> <a id="4343" href="/Soundness/#4327" class="Bound">Γ</a><a id="4344" class="Symbol">}</a> <a id="4346" class="Symbol">{</a><a id="4347" href="/Soundness/#4347" class="Bound">δ</a> <a id="4349" class="Symbol">:</a> <a id="4351" href="/Denotational/#7234" class="Function">Env</a> <a id="4355" href="/Soundness/#4329" class="Bound">Δ</a><a id="4356" class="Symbol">}</a> <a id="4358" class="Symbol">{</a><a id="4359" href="/Soundness/#4359" class="Bound">M</a> <a id="4361" class="Symbol">:</a> <a id="4363" href="/Soundness/#4327" class="Bound">Γ</a> <a id="4365" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="4367" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="4368" class="Symbol">}</a>
  <a id="4372" class="Symbol">→</a> <a id="4374" class="Symbol">(</a><a id="4375" href="/Soundness/#4375" class="Bound">σ</a> <a id="4377" class="Symbol">:</a> <a id="4379" href="/Substitution/#2506" class="Function">Subst</a> <a id="4385" href="/Soundness/#4327" class="Bound">Γ</a> <a id="4387" href="/Soundness/#4329" class="Bound">Δ</a><a id="4388" class="Symbol">)</a>
  <a id="4392" class="Symbol">→</a> <a id="4394" href="/Soundness/#4347" class="Bound">δ</a> <a id="4396" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="4399" href="/Soundness/#4375" class="Bound">σ</a> <a id="4401" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="4403" href="/Soundness/#4335" class="Bound">γ</a>
  <a id="4407" class="Symbol">→</a> <a id="4409" href="/Soundness/#4335" class="Bound">γ</a> <a id="4411" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="4413" href="/Soundness/#4359" class="Bound">M</a> <a id="4415" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="4417" href="/Soundness/#4331" class="Bound">v</a>
    <a id="4423" class="Comment">------------------</a>
  <a id="4444" class="Symbol">→</a> <a id="4446" href="/Soundness/#4347" class="Bound">δ</a> <a id="4448" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="4450" href="/Untyped/#6931" class="Function">subst</a> <a id="4456" href="/Soundness/#4375" class="Bound">σ</a> <a id="4458" href="/Soundness/#4359" class="Bound">M</a> <a id="4460" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="4462" href="/Soundness/#4331" class="Bound">v</a>
<a id="4464" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4475" href="/Soundness/#4475" class="Bound">σ</a> <a id="4477" href="/Soundness/#4477" class="Bound">s</a> <a id="4479" class="Symbol">(</a><a id="4480" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="4484" class="Symbol">{</a><a id="4485" class="Argument">x</a> <a id="4487" class="Symbol">=</a> <a id="4489" href="/Soundness/#4489" class="Bound">x</a><a id="4490" class="Symbol">})</a> <a id="4493" class="Symbol">=</a> <a id="4495" class="Symbol">(</a><a id="4496" href="/Soundness/#4477" class="Bound">s</a> <a id="4498" href="/Soundness/#4489" class="Bound">x</a><a id="4499" class="Symbol">)</a>
<a id="4501" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4512" href="/Soundness/#4512" class="Bound">σ</a> <a id="4514" href="/Soundness/#4514" class="Bound">s</a> <a id="4516" class="Symbol">(</a><a id="4517" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="4524" href="/Soundness/#4524" class="Bound">d₁</a> <a id="4527" href="/Soundness/#4527" class="Bound">d₂</a><a id="4529" class="Symbol">)</a> <a id="4531" class="Symbol">=</a>
  <a id="4535" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="4542" class="Symbol">(</a><a id="4543" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4554" href="/Soundness/#4512" class="Bound">σ</a> <a id="4556" href="/Soundness/#4514" class="Bound">s</a> <a id="4558" href="/Soundness/#4524" class="Bound">d₁</a><a id="4560" class="Symbol">)</a> <a id="4562" class="Symbol">(</a><a id="4563" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4574" href="/Soundness/#4512" class="Bound">σ</a> <a id="4576" href="/Soundness/#4514" class="Bound">s</a> <a id="4578" href="/Soundness/#4527" class="Bound">d₂</a><a id="4580" class="Symbol">)</a> 
<a id="4583" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4594" href="/Soundness/#4594" class="Bound">σ</a> <a id="4596" href="/Soundness/#4596" class="Bound">s</a> <a id="4598" class="Symbol">(</a><a id="4599" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="4607" href="/Soundness/#4607" class="Bound">d</a><a id="4608" class="Symbol">)</a> <a id="4610" class="Symbol">=</a>
  <a id="4614" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="4622" class="Symbol">(</a><a id="4623" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4634" class="Symbol">(λ</a> <a id="4637" class="Symbol">{</a><a id="4638" href="/Soundness/#4638" class="Bound">A</a><a id="4639" class="Symbol">}</a> <a id="4641" class="Symbol">→</a> <a id="4643" href="/Untyped/#6623" class="Function">exts</a> <a id="4648" href="/Soundness/#4594" class="Bound">σ</a><a id="4649" class="Symbol">)</a> <a id="4651" class="Symbol">(</a><a id="4652" href="/Soundness/#3657" class="Function">subst-ext</a> <a id="4662" href="/Soundness/#4594" class="Bound">σ</a> <a id="4664" href="/Soundness/#4596" class="Bound">s</a><a id="4665" class="Symbol">)</a> <a id="4667" href="/Soundness/#4607" class="Bound">d</a><a id="4668" class="Symbol">)</a>
<a id="4670" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4681" href="/Soundness/#4681" class="Bound">σ</a> <a id="4683" href="/Soundness/#4683" class="Bound">s</a> <a id="4685" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="4693" class="Symbol">=</a> <a id="4695" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a>
<a id="4703" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4714" href="/Soundness/#4714" class="Bound">σ</a> <a id="4716" href="/Soundness/#4716" class="Bound">s</a> <a id="4718" class="Symbol">(</a><a id="4719" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="4727" href="/Soundness/#4727" class="Bound">d₁</a> <a id="4730" href="/Soundness/#4730" class="Bound">d₂</a><a id="4732" class="Symbol">)</a> <a id="4734" class="Symbol">=</a>
  <a id="4738" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="4746" class="Symbol">(</a><a id="4747" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4758" href="/Soundness/#4714" class="Bound">σ</a> <a id="4760" href="/Soundness/#4716" class="Bound">s</a> <a id="4762" href="/Soundness/#4727" class="Bound">d₁</a><a id="4764" class="Symbol">)</a> <a id="4766" class="Symbol">(</a><a id="4767" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4778" href="/Soundness/#4714" class="Bound">σ</a> <a id="4780" href="/Soundness/#4716" class="Bound">s</a> <a id="4782" href="/Soundness/#4730" class="Bound">d₂</a><a id="4784" class="Symbol">)</a>
<a id="4786" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4797" href="/Soundness/#4797" class="Bound">σ</a> <a id="4799" href="/Soundness/#4799" class="Bound">s</a> <a id="4801" class="Symbol">(</a><a id="4802" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="4806" href="/Soundness/#4806" class="Bound">d</a> <a id="4808" href="/Soundness/#4808" class="Bound">lt</a><a id="4810" class="Symbol">)</a> <a id="4812" class="Symbol">=</a> <a id="4814" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="4818" class="Symbol">(</a><a id="4819" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="4830" href="/Soundness/#4797" class="Bound">σ</a> <a id="4832" href="/Soundness/#4799" class="Bound">s</a> <a id="4834" href="/Soundness/#4806" class="Bound">d</a><a id="4835" class="Symbol">)</a> <a id="4837" href="/Soundness/#4808" class="Bound">lt</a></pre>

<p>The proof is by induction on the semantics of <code class="highlighter-rouge">M</code>.  The two interesting
cases are for variables and lambda abstractions.</p>

<ul>
  <li>
    <p>For a variable <code class="highlighter-rouge">x</code>, we have that <code class="highlighter-rouge">v ⊑ nth x γ</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ σ x ↓ v</code>.  From the premise applied to <code class="highlighter-rouge">x</code>, we have that
<code class="highlighter-rouge">δ ⊢ σ x ↓ nth x γ</code>, so we conclude by the <code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>For a lambda abstraction, we must extend the substitution
for the induction hypothesis. We apply the <code class="highlighter-rouge">subst-ext</code> lemma
to show that the extended substitution maps variables to
terms that result in the appropriate values.</p>
  </li>
</ul>

<h3 id="single-substitution-preserves-denotations">Single substitution preserves denotations</h3>

<p>For β reduction, <code class="highlighter-rouge">(ƛ N) · M —→ N [ M ]</code>, we need to show that the
semantics is preserved when substituting <code class="highlighter-rouge">M</code> for de Bruijn index 0 in
term <code class="highlighter-rouge">N</code>. By inversion on the rules <code class="highlighter-rouge">↦-elim</code> and <code class="highlighter-rouge">↦-intro</code>,
we have that <code class="highlighter-rouge">γ , v ⊢ M ↓ w</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code>.
So we need to show that <code class="highlighter-rouge">γ ⊢ M [ N ] ↓ w</code>, or equivalently,
that <code class="highlighter-rouge">γ ⊢ subst (subst-zero N) M ↓ w</code>.</p>

<pre class="Agda"><a id="substitution"></a><a id="5803" href="/Soundness/#5803" class="Function">substitution</a> <a id="5816" class="Symbol">:</a> <a id="5818" class="Symbol">∀</a> <a id="5820" class="Symbol">{</a><a id="5821" href="/Soundness/#5821" class="Bound">Γ</a><a id="5822" class="Symbol">}</a> <a id="5824" class="Symbol">{</a><a id="5825" href="/Soundness/#5825" class="Bound">γ</a> <a id="5827" class="Symbol">:</a> <a id="5829" href="/Denotational/#7234" class="Function">Env</a> <a id="5833" href="/Soundness/#5821" class="Bound">Γ</a><a id="5834" class="Symbol">}</a> <a id="5836" class="Symbol">{</a><a id="5837" href="/Soundness/#5837" class="Bound">N</a> <a id="5839" href="/Soundness/#5839" class="Bound">M</a> <a id="5841" href="/Soundness/#5841" class="Bound">v</a> <a id="5843" href="/Soundness/#5843" class="Bound">w</a><a id="5844" class="Symbol">}</a>
   <a id="5849" class="Symbol">→</a> <a id="5851" href="/Soundness/#5825" class="Bound">γ</a> <a id="5853" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="5856" href="/Soundness/#5841" class="Bound">v</a> <a id="5858" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="5860" href="/Soundness/#5837" class="Bound">N</a> <a id="5862" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="5864" href="/Soundness/#5843" class="Bound">w</a>
   <a id="5869" class="Symbol">→</a> <a id="5871" href="/Soundness/#5825" class="Bound">γ</a> <a id="5873" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="5875" href="/Soundness/#5839" class="Bound">M</a> <a id="5877" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="5879" href="/Soundness/#5841" class="Bound">v</a>
     <a id="5886" class="Comment">---------------</a>
   <a id="5905" class="Symbol">→</a> <a id="5907" href="/Soundness/#5825" class="Bound">γ</a> <a id="5909" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="5911" href="/Soundness/#5837" class="Bound">N</a> <a id="5913" href="/Untyped/#7475" class="Function Operator">[</a> <a id="5915" href="/Soundness/#5839" class="Bound">M</a> <a id="5917" href="/Untyped/#7475" class="Function Operator">]</a> <a id="5919" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="5921" href="/Soundness/#5843" class="Bound">w</a>   
<a id="5926" href="/Soundness/#5803" class="Function">substitution</a><a id="5938" class="Symbol">{</a><a id="5939" href="/Soundness/#5939" class="Bound">Γ</a><a id="5940" class="Symbol">}{</a><a id="5942" href="/Soundness/#5942" class="Bound">γ</a><a id="5943" class="Symbol">}{</a><a id="5945" href="/Soundness/#5945" class="Bound">N</a><a id="5946" class="Symbol">}{</a><a id="5948" href="/Soundness/#5948" class="Bound">M</a><a id="5949" class="Symbol">}{</a><a id="5951" href="/Soundness/#5951" class="Bound">v</a><a id="5952" class="Symbol">}{</a><a id="5954" href="/Soundness/#5954" class="Bound">w</a><a id="5955" class="Symbol">}</a> <a id="5957" href="/Soundness/#5957" class="Bound">dn</a> <a id="5960" href="/Soundness/#5960" class="Bound">dm</a> <a id="5963" class="Symbol">=</a>
  <a id="5967" href="/Soundness/#4311" class="Function">subst-pres</a> <a id="5978" class="Symbol">(</a><a id="5979" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="5990" href="/Soundness/#5948" class="Bound">M</a><a id="5991" class="Symbol">)</a> <a id="5993" href="/Soundness/#6015" class="Function">sub-z-ok</a> <a id="6002" href="/Soundness/#5957" class="Bound">dn</a>
  <a id="6007" class="Keyword">where</a>
  <a id="6015" href="/Soundness/#6015" class="Function">sub-z-ok</a> <a id="6024" class="Symbol">:</a> <a id="6026" href="/Soundness/#5942" class="Bound">γ</a> <a id="6028" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="6031" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="6042" href="/Soundness/#5948" class="Bound">M</a> <a id="6044" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="6046" class="Symbol">(</a><a id="6047" href="/Soundness/#5942" class="Bound">γ</a> <a id="6049" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="6052" href="/Soundness/#5951" class="Bound">v</a><a id="6053" class="Symbol">)</a>
  <a id="6057" href="/Soundness/#6015" class="Function">sub-z-ok</a> <a id="6066" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="6068" class="Symbol">=</a> <a id="6070" href="/Soundness/#5960" class="Bound">dm</a>
  <a id="6075" href="/Soundness/#6015" class="Function">sub-z-ok</a> <a id="6084" class="Symbol">(</a><a id="6085" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="6087" href="/Soundness/#6087" class="Bound">x</a><a id="6088" class="Symbol">)</a> <a id="6090" class="Symbol">=</a> <a id="6092" href="/Denotational/#9574" class="InductiveConstructor">var</a></pre>

<p>This result is a corollary of the lemma for simultaneous substitution.
To use the lemma, we just need to show that <code class="highlighter-rouge">subst-zero M</code> maps
variables to terms that produces the same values as those in <code class="highlighter-rouge">γ , v</code>.
Let <code class="highlighter-rouge">y</code> be an arbitrary variable (de Bruijn index).</p>

<ul>
  <li>
    <p>If it is <code class="highlighter-rouge">Z</code>, then <code class="highlighter-rouge">(subst-zero M) y = M</code> and <code class="highlighter-rouge">nth y (γ , v) = v</code>.
By the premise we conclude that <code class="highlighter-rouge">γ ⊢ M ↓ v</code>.</p>
  </li>
  <li>
    <p>If it is <code class="highlighter-rouge">S x</code>, then <code class="highlighter-rouge">(subst-zero M) (S x) = x</code> and
<code class="highlighter-rouge">nth (S x) (γ , v) = nth x γ</code>.  So we conclude that
<code class="highlighter-rouge">γ ⊢ x ↓ nth x γ</code> by rule <code class="highlighter-rouge">var</code>.</p>
  </li>
</ul>

<h3 id="reduction-preserves-denotations">Reduction preserves denotations</h3>

<p>With the substitution lemma in hand, it is straightforward to prove
that reduction preserves denotations.</p>

<pre class="Agda"><a id="preserve"></a><a id="6785" href="/Soundness/#6785" class="Function">preserve</a> <a id="6794" class="Symbol">:</a> <a id="6796" class="Symbol">∀</a> <a id="6798" class="Symbol">{</a><a id="6799" href="/Soundness/#6799" class="Bound">Γ</a><a id="6800" class="Symbol">}</a> <a id="6802" class="Symbol">{</a><a id="6803" href="/Soundness/#6803" class="Bound">γ</a> <a id="6805" class="Symbol">:</a> <a id="6807" href="/Denotational/#7234" class="Function">Env</a> <a id="6811" href="/Soundness/#6799" class="Bound">Γ</a><a id="6812" class="Symbol">}</a> <a id="6814" class="Symbol">{</a><a id="6815" href="/Soundness/#6815" class="Bound">M</a> <a id="6817" href="/Soundness/#6817" class="Bound">N</a> <a id="6819" href="/Soundness/#6819" class="Bound">v</a><a id="6820" class="Symbol">}</a>
  <a id="6824" class="Symbol">→</a> <a id="6826" href="/Soundness/#6803" class="Bound">γ</a> <a id="6828" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="6830" href="/Soundness/#6815" class="Bound">M</a> <a id="6832" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="6834" href="/Soundness/#6819" class="Bound">v</a>
  <a id="6838" class="Symbol">→</a> <a id="6840" href="/Soundness/#6815" class="Bound">M</a> <a id="6842" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="6845" href="/Soundness/#6817" class="Bound">N</a>
    <a id="6851" class="Comment">----------</a>
  <a id="6864" class="Symbol">→</a> <a id="6866" href="/Soundness/#6803" class="Bound">γ</a> <a id="6868" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="6870" href="/Soundness/#6817" class="Bound">N</a> <a id="6872" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="6874" href="/Soundness/#6819" class="Bound">v</a>
<a id="6876" href="/Soundness/#6785" class="Function">preserve</a> <a id="6885" class="Symbol">(</a><a id="6886" href="/Denotational/#9574" class="InductiveConstructor">var</a><a id="6889" class="Symbol">)</a> <a id="6891" class="Symbol">()</a>
<a id="6894" href="/Soundness/#6785" class="Function">preserve</a> <a id="6903" class="Symbol">(</a><a id="6904" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="6911" href="/Soundness/#6911" class="Bound">d₁</a> <a id="6914" href="/Soundness/#6914" class="Bound">d₂</a><a id="6916" class="Symbol">)</a> <a id="6918" class="Symbol">(</a><a id="6919" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="6922" href="/Soundness/#6922" class="Bound">r</a><a id="6923" class="Symbol">)</a> <a id="6925" class="Symbol">=</a> <a id="6927" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="6934" class="Symbol">(</a><a id="6935" href="/Soundness/#6785" class="Function">preserve</a> <a id="6944" href="/Soundness/#6911" class="Bound">d₁</a> <a id="6947" href="/Soundness/#6922" class="Bound">r</a><a id="6948" class="Symbol">)</a> <a id="6950" href="/Soundness/#6914" class="Bound">d₂</a> 
<a id="6954" href="/Soundness/#6785" class="Function">preserve</a> <a id="6963" class="Symbol">(</a><a id="6964" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="6971" href="/Soundness/#6971" class="Bound">d₁</a> <a id="6974" href="/Soundness/#6974" class="Bound">d₂</a><a id="6976" class="Symbol">)</a> <a id="6978" class="Symbol">(</a><a id="6979" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="6982" href="/Soundness/#6982" class="Bound">r</a><a id="6983" class="Symbol">)</a> <a id="6985" class="Symbol">=</a> <a id="6987" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="6994" href="/Soundness/#6971" class="Bound">d₁</a> <a id="6997" class="Symbol">(</a><a id="6998" href="/Soundness/#6785" class="Function">preserve</a> <a id="7007" href="/Soundness/#6974" class="Bound">d₂</a> <a id="7010" href="/Soundness/#6982" class="Bound">r</a><a id="7011" class="Symbol">)</a> 
<a id="7014" href="/Soundness/#6785" class="Function">preserve</a> <a id="7023" class="Symbol">(</a><a id="7024" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="7031" href="/Soundness/#7031" class="Bound">d₁</a> <a id="7034" href="/Soundness/#7034" class="Bound">d₂</a><a id="7036" class="Symbol">)</a> <a id="7038" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="7040" class="Symbol">=</a> <a id="7042" href="/Soundness/#5803" class="Function">substitution</a> <a id="7055" class="Symbol">(</a><a id="7056" href="/Compositional/#3363" class="Function">lambda-inversion</a> <a id="7073" href="/Soundness/#7031" class="Bound">d₁</a><a id="7075" class="Symbol">)</a> <a id="7077" href="/Soundness/#7034" class="Bound">d₂</a>
<a id="7080" href="/Soundness/#6785" class="Function">preserve</a> <a id="7089" class="Symbol">(</a><a id="7090" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="7098" href="/Soundness/#7098" class="Bound">d</a><a id="7099" class="Symbol">)</a> <a id="7101" class="Symbol">(</a><a id="7102" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="7104" href="/Soundness/#7104" class="Bound">r</a><a id="7105" class="Symbol">)</a> <a id="7107" class="Symbol">=</a> <a id="7109" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="7117" class="Symbol">(</a><a id="7118" href="/Soundness/#6785" class="Function">preserve</a> <a id="7127" href="/Soundness/#7098" class="Bound">d</a> <a id="7129" href="/Soundness/#7104" class="Bound">r</a><a id="7130" class="Symbol">)</a>
<a id="7132" href="/Soundness/#6785" class="Function">preserve</a> <a id="7141" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="7149" href="/Soundness/#7149" class="Bound">r</a> <a id="7151" class="Symbol">=</a> <a id="7153" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a>
<a id="7161" href="/Soundness/#6785" class="Function">preserve</a> <a id="7170" class="Symbol">(</a><a id="7171" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="7179" href="/Soundness/#7179" class="Bound">d</a> <a id="7181" href="/Soundness/#7181" class="Bound">d₁</a><a id="7183" class="Symbol">)</a> <a id="7185" href="/Soundness/#7185" class="Bound">r</a> <a id="7187" class="Symbol">=</a> <a id="7189" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="7197" class="Symbol">(</a><a id="7198" href="/Soundness/#6785" class="Function">preserve</a> <a id="7207" href="/Soundness/#7179" class="Bound">d</a> <a id="7209" href="/Soundness/#7185" class="Bound">r</a><a id="7210" class="Symbol">)</a> <a id="7212" class="Symbol">(</a><a id="7213" href="/Soundness/#6785" class="Function">preserve</a> <a id="7222" href="/Soundness/#7181" class="Bound">d₁</a> <a id="7225" href="/Soundness/#7185" class="Bound">r</a><a id="7226" class="Symbol">)</a>
<a id="7228" href="/Soundness/#6785" class="Function">preserve</a> <a id="7237" class="Symbol">(</a><a id="7238" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="7242" href="/Soundness/#7242" class="Bound">d</a> <a id="7244" href="/Soundness/#7244" class="Bound">lt</a><a id="7246" class="Symbol">)</a> <a id="7248" href="/Soundness/#7248" class="Bound">r</a> <a id="7250" class="Symbol">=</a> <a id="7252" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="7256" class="Symbol">(</a><a id="7257" href="/Soundness/#6785" class="Function">preserve</a> <a id="7266" href="/Soundness/#7242" class="Bound">d</a> <a id="7268" href="/Soundness/#7248" class="Bound">r</a><a id="7269" class="Symbol">)</a> <a id="7271" href="/Soundness/#7244" class="Bound">lt</a></pre>

<p>We proceed by induction on the semantics of <code class="highlighter-rouge">M</code> with case analysis on
the reduction.</p>

<ul>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is a variable, then there is no such reduction.</p>
  </li>
  <li>
    <p>If <code class="highlighter-rouge">M</code> is an application, then the reduction is either a congruence
(ξ₁ or ξ₂) or β. For each congruence, we use the induction
hypothesis. For β reduction we use the substitution lemma and the
<code class="highlighter-rouge">sub</code> rule.</p>
  </li>
  <li>
    <p>The rest of the cases are straightforward.</p>
  </li>
</ul>

<h2 id="reduction-reflects-denotations">Reduction reflects denotations</h2>

<p>This section proves that reduction reflects the denotation of a
term. That is, if <code class="highlighter-rouge">N</code> results in <code class="highlighter-rouge">v</code>, and if <code class="highlighter-rouge">M</code> reduces to <code class="highlighter-rouge">N</code>, then
<code class="highlighter-rouge">M</code> also results in <code class="highlighter-rouge">v</code>. While there are some broad similarities
between this proof and the above proof of semantic preservation, we
shall require a few more technical lemmas to obtain this result.</p>

<p>The main challenge is dealing with the substitution in β reduction:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(ƛ N) · M —→ N [ M ]
</code></pre></div></div>

<p>We have that <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code> and need to show that
<code class="highlighter-rouge">γ ⊢ (ƛ N) · M ↓ v</code>. Now consider the derivation of <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ v</code>.
The term <code class="highlighter-rouge">M</code> may occur 0, 1, or many times inside <code class="highlighter-rouge">N [ M ]</code>. At each of
those occurences, <code class="highlighter-rouge">M</code> may result in a different value. But to build a
derivation for <code class="highlighter-rouge">(ƛ N) · M</code>, we need a single value for <code class="highlighter-rouge">M</code>.  If <code class="highlighter-rouge">M</code>
occured more than 1 time, then we can join all of the different values
using <code class="highlighter-rouge">⊔</code>. If <code class="highlighter-rouge">M</code> occured 0 times, then we do not need any information
about <code class="highlighter-rouge">M</code> and can therefore use <code class="highlighter-rouge">⊥</code> for the value of <code class="highlighter-rouge">M</code>.</p>

<h3 id="renaming-reflects-meaning">Renaming reflects meaning</h3>

<p>Previously we showed that renaming variables preserves meaning.  Now
we prove the opposite, that it reflects meaning. That is,
if <code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code>, where <code class="highlighter-rouge">(δ ∘ ρ) </code>⊑ γ`.</p>

<p>First, we need a variant of a lemma given earlier.</p>
<pre class="Agda"><a id="nth-ext"></a><a id="8977" href="/Soundness/#8977" class="Function">nth-ext</a> <a id="8985" class="Symbol">:</a> <a id="8987" class="Symbol">∀</a> <a id="8989" class="Symbol">{</a><a id="8990" href="/Soundness/#8990" class="Bound">Γ</a> <a id="8992" href="/Soundness/#8992" class="Bound">Δ</a> <a id="8994" href="/Soundness/#8994" class="Bound">v</a><a id="8995" class="Symbol">}</a> <a id="8997" class="Symbol">{</a><a id="8998" href="/Soundness/#8998" class="Bound">γ</a> <a id="9000" class="Symbol">:</a> <a id="9002" href="/Denotational/#7234" class="Function">Env</a> <a id="9006" href="/Soundness/#8990" class="Bound">Γ</a><a id="9007" class="Symbol">}</a> <a id="9009" class="Symbol">{</a><a id="9010" href="/Soundness/#9010" class="Bound">δ</a> <a id="9012" class="Symbol">:</a> <a id="9014" href="/Denotational/#7234" class="Function">Env</a> <a id="9018" href="/Soundness/#8992" class="Bound">Δ</a><a id="9019" class="Symbol">}</a>
  <a id="9023" class="Symbol">→</a> <a id="9025" class="Symbol">(</a><a id="9026" href="/Soundness/#9026" class="Bound">ρ</a> <a id="9028" class="Symbol">:</a> <a id="9030" href="/Substitution/#2277" class="Function">Rename</a> <a id="9037" href="/Soundness/#8990" class="Bound">Γ</a> <a id="9039" href="/Soundness/#8992" class="Bound">Δ</a><a id="9040" class="Symbol">)</a>
  <a id="9044" class="Symbol">→</a> <a id="9046" class="Symbol">(</a><a id="9047" href="/Soundness/#9010" class="Bound">δ</a> <a id="9049" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">∘</a> <a id="9051" href="/Soundness/#9026" class="Bound">ρ</a><a id="9052" class="Symbol">)</a> <a id="9054" href="/Denotational/#8260" class="Function Operator">`⊑</a> <a id="9057" href="/Soundness/#8998" class="Bound">γ</a>
    <a id="9063" class="Comment">------------------------------</a>
  <a id="9096" class="Symbol">→</a> <a id="9098" class="Symbol">((</a><a id="9100" href="/Soundness/#9010" class="Bound">δ</a> <a id="9102" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="9105" href="/Soundness/#8994" class="Bound">v</a><a id="9106" class="Symbol">)</a> <a id="9108" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">∘</a> <a id="9110" href="/Untyped/#5845" class="Function">ext</a> <a id="9114" href="/Soundness/#9026" class="Bound">ρ</a><a id="9115" class="Symbol">)</a> <a id="9117" href="/Denotational/#8260" class="Function Operator">`⊑</a> <a id="9120" class="Symbol">(</a><a id="9121" href="/Soundness/#8998" class="Bound">γ</a> <a id="9123" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="9126" href="/Soundness/#8994" class="Bound">v</a><a id="9127" class="Symbol">)</a>
<a id="9129" href="/Soundness/#8977" class="Function">nth-ext</a> <a id="9137" href="/Soundness/#9137" class="Bound">ρ</a> <a id="9139" href="/Soundness/#9139" class="Bound">lt</a> <a id="9142" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="9144" class="Symbol">=</a> <a id="9146" href="/Denotational/#5541" class="Function">Refl⊑</a>
<a id="9152" href="/Soundness/#8977" class="Function">nth-ext</a> <a id="9160" href="/Soundness/#9160" class="Bound">ρ</a> <a id="9162" href="/Soundness/#9162" class="Bound">lt</a> <a id="9165" class="Symbol">(</a><a id="9166" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="9168" href="/Soundness/#9168" class="Bound">x</a><a id="9169" class="Symbol">)</a> <a id="9171" class="Symbol">=</a> <a id="9173" href="/Soundness/#9162" class="Bound">lt</a> <a id="9176" href="/Soundness/#9168" class="Bound">x</a></pre>

<p>The proof is then as follows.</p>
<pre class="Agda"><a id="rename-reflect"></a><a id="9233" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9248" class="Symbol">:</a> <a id="9250" class="Symbol">∀</a> <a id="9252" class="Symbol">{</a><a id="9253" href="/Soundness/#9253" class="Bound">Γ</a> <a id="9255" href="/Soundness/#9255" class="Bound">Δ</a> <a id="9257" href="/Soundness/#9257" class="Bound">v</a><a id="9258" class="Symbol">}</a> <a id="9260" class="Symbol">{</a><a id="9261" href="/Soundness/#9261" class="Bound">γ</a> <a id="9263" class="Symbol">:</a> <a id="9265" href="/Denotational/#7234" class="Function">Env</a> <a id="9269" href="/Soundness/#9253" class="Bound">Γ</a><a id="9270" class="Symbol">}</a> <a id="9272" class="Symbol">{</a><a id="9273" href="/Soundness/#9273" class="Bound">δ</a> <a id="9275" class="Symbol">:</a> <a id="9277" href="/Denotational/#7234" class="Function">Env</a> <a id="9281" href="/Soundness/#9255" class="Bound">Δ</a><a id="9282" class="Symbol">}</a> <a id="9284" class="Symbol">{</a> <a id="9286" href="/Soundness/#9286" class="Bound">M</a> <a id="9288" class="Symbol">:</a> <a id="9290" href="/Soundness/#9253" class="Bound">Γ</a> <a id="9292" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="9294" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="9295" class="Symbol">}</a>
  <a id="9299" class="Symbol">→</a> <a id="9301" class="Symbol">{</a><a id="9302" href="/Soundness/#9302" class="Bound">ρ</a> <a id="9304" class="Symbol">:</a> <a id="9306" href="/Substitution/#2277" class="Function">Rename</a> <a id="9313" href="/Soundness/#9253" class="Bound">Γ</a> <a id="9315" href="/Soundness/#9255" class="Bound">Δ</a><a id="9316" class="Symbol">}</a>
  <a id="9320" class="Symbol">→</a> <a id="9322" class="Symbol">(</a><a id="9323" href="/Soundness/#9273" class="Bound">δ</a> <a id="9325" href="https://agda.github.io/agda-stdlib/v0.17/Function.html#769" class="Function Operator">∘</a> <a id="9327" href="/Soundness/#9302" class="Bound">ρ</a><a id="9328" class="Symbol">)</a> <a id="9330" href="/Denotational/#8260" class="Function Operator">`⊑</a> <a id="9333" href="/Soundness/#9261" class="Bound">γ</a>
  <a id="9337" class="Symbol">→</a> <a id="9339" href="/Soundness/#9273" class="Bound">δ</a> <a id="9341" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="9343" href="/Untyped/#6171" class="Function">rename</a> <a id="9350" href="/Soundness/#9302" class="Bound">ρ</a> <a id="9352" href="/Soundness/#9286" class="Bound">M</a> <a id="9354" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="9356" href="/Soundness/#9257" class="Bound">v</a>
    <a id="9362" class="Comment">------------------------------------</a>
  <a id="9401" class="Symbol">→</a> <a id="9403" href="/Soundness/#9261" class="Bound">γ</a> <a id="9405" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="9407" href="/Soundness/#9286" class="Bound">M</a> <a id="9409" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="9411" href="/Soundness/#9257" class="Bound">v</a>
<a id="9413" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9428" class="Symbol">{</a><a id="9429" class="Argument">M</a> <a id="9431" class="Symbol">=</a> <a id="9433" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="9435" href="/Soundness/#9435" class="Bound">x</a><a id="9436" class="Symbol">}</a> <a id="9438" href="/Soundness/#9438" class="Bound">all-n</a> <a id="9444" href="/Soundness/#9444" class="Bound">d</a> <a id="9446" class="Keyword">with</a> <a id="9451" href="/Compositional/#9536" class="Function">var-inv</a> <a id="9459" href="/Soundness/#9444" class="Bound">d</a>
<a id="9461" class="Symbol">...</a> <a id="9465" class="Symbol">|</a> <a id="9467" href="/Soundness/#9467" class="Bound">lt</a> <a id="9470" class="Symbol">=</a>  <a id="9473" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="9477" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="9481" class="Symbol">(</a><a id="9482" href="/Denotational/#4668" class="InductiveConstructor">Trans⊑</a> <a id="9489" href="/Soundness/#9467" class="Bound">lt</a> <a id="9492" class="Symbol">(</a><a id="9493" class="Bound">all-n</a> <a id="9499" class="Bound">x</a><a id="9500" class="Symbol">))</a>
<a id="9503" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9518" class="Symbol">{</a><a id="9519" class="Argument">M</a> <a id="9521" class="Symbol">=</a> <a id="9523" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9525" href="/Soundness/#9525" class="Bound">N</a><a id="9526" class="Symbol">}{</a><a id="9528" class="Argument">ρ</a> <a id="9530" class="Symbol">=</a> <a id="9532" href="/Soundness/#9532" class="Bound">ρ</a><a id="9533" class="Symbol">}</a> <a id="9535" href="/Soundness/#9535" class="Bound">all-n</a> <a id="9541" class="Symbol">(</a><a id="9542" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="9550" href="/Soundness/#9550" class="Bound">d</a><a id="9551" class="Symbol">)</a> <a id="9553" class="Symbol">=</a>
   <a id="9558" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="9566" class="Symbol">(</a><a id="9567" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9582" class="Symbol">(</a><a id="9583" href="/Soundness/#8977" class="Function">nth-ext</a> <a id="9591" href="/Soundness/#9532" class="Bound">ρ</a> <a id="9593" href="/Soundness/#9535" class="Bound">all-n</a><a id="9598" class="Symbol">)</a> <a id="9600" href="/Soundness/#9550" class="Bound">d</a><a id="9601" class="Symbol">)</a>
<a id="9603" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9618" class="Symbol">{</a><a id="9619" class="Argument">M</a> <a id="9621" class="Symbol">=</a> <a id="9623" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9625" href="/Soundness/#9625" class="Bound">N</a><a id="9626" class="Symbol">}</a> <a id="9628" href="/Soundness/#9628" class="Bound">all-n</a> <a id="9634" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="9642" class="Symbol">=</a> <a id="9644" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a>
<a id="9652" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9667" class="Symbol">{</a><a id="9668" class="Argument">M</a> <a id="9670" class="Symbol">=</a> <a id="9672" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9674" href="/Soundness/#9674" class="Bound">N</a><a id="9675" class="Symbol">}</a> <a id="9677" href="/Soundness/#9677" class="Bound">all-n</a> <a id="9683" class="Symbol">(</a><a id="9684" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="9692" href="/Soundness/#9692" class="Bound">d₁</a> <a id="9695" href="/Soundness/#9695" class="Bound">d₂</a><a id="9697" class="Symbol">)</a> <a id="9699" class="Symbol">=</a>
   <a id="9704" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="9712" class="Symbol">(</a><a id="9713" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9728" href="/Soundness/#9677" class="Bound">all-n</a> <a id="9734" href="/Soundness/#9692" class="Bound">d₁</a><a id="9736" class="Symbol">)</a> <a id="9738" class="Symbol">(</a><a id="9739" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9754" href="/Soundness/#9677" class="Bound">all-n</a> <a id="9760" href="/Soundness/#9695" class="Bound">d₂</a><a id="9762" class="Symbol">)</a>
<a id="9764" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9779" class="Symbol">{</a><a id="9780" class="Argument">M</a> <a id="9782" class="Symbol">=</a> <a id="9784" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="9786" href="/Soundness/#9786" class="Bound">N</a><a id="9787" class="Symbol">}</a> <a id="9789" href="/Soundness/#9789" class="Bound">all-n</a> <a id="9795" class="Symbol">(</a><a id="9796" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="9800" href="/Soundness/#9800" class="Bound">d₁</a> <a id="9803" href="/Soundness/#9803" class="Bound">lt</a><a id="9805" class="Symbol">)</a> <a id="9807" class="Symbol">=</a>
   <a id="9812" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="9816" class="Symbol">(</a><a id="9817" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9832" href="/Soundness/#9789" class="Bound">all-n</a> <a id="9838" href="/Soundness/#9800" class="Bound">d₁</a><a id="9840" class="Symbol">)</a> <a id="9842" href="/Soundness/#9803" class="Bound">lt</a>
<a id="9845" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9860" class="Symbol">{</a><a id="9861" class="Argument">M</a> <a id="9863" class="Symbol">=</a> <a id="9865" href="/Soundness/#9865" class="Bound">L</a> <a id="9867" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9869" href="/Soundness/#9869" class="Bound">M</a><a id="9870" class="Symbol">}</a> <a id="9872" href="/Soundness/#9872" class="Bound">all-n</a> <a id="9878" class="Symbol">(</a><a id="9879" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="9886" href="/Soundness/#9886" class="Bound">d₁</a> <a id="9889" href="/Soundness/#9889" class="Bound">d₂</a><a id="9891" class="Symbol">)</a> <a id="9893" class="Symbol">=</a>
   <a id="9898" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="9905" class="Symbol">(</a><a id="9906" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9921" href="/Soundness/#9872" class="Bound">all-n</a> <a id="9927" href="/Soundness/#9886" class="Bound">d₁</a><a id="9929" class="Symbol">)</a> <a id="9931" class="Symbol">(</a><a id="9932" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9947" href="/Soundness/#9872" class="Bound">all-n</a> <a id="9953" href="/Soundness/#9889" class="Bound">d₂</a><a id="9955" class="Symbol">)</a> 
<a id="9958" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="9973" class="Symbol">{</a><a id="9974" class="Argument">M</a> <a id="9976" class="Symbol">=</a> <a id="9978" href="/Soundness/#9978" class="Bound">L</a> <a id="9980" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="9982" href="/Soundness/#9982" class="Bound">M</a><a id="9983" class="Symbol">}</a> <a id="9985" href="/Soundness/#9985" class="Bound">all-n</a> <a id="9991" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="9999" class="Symbol">=</a> <a id="10001" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a>
<a id="10009" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="10024" class="Symbol">{</a><a id="10025" class="Argument">M</a> <a id="10027" class="Symbol">=</a> <a id="10029" href="/Soundness/#10029" class="Bound">L</a> <a id="10031" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="10033" href="/Soundness/#10033" class="Bound">M</a><a id="10034" class="Symbol">}</a> <a id="10036" href="/Soundness/#10036" class="Bound">all-n</a> <a id="10042" class="Symbol">(</a><a id="10043" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="10051" href="/Soundness/#10051" class="Bound">d₁</a> <a id="10054" href="/Soundness/#10054" class="Bound">d₂</a><a id="10056" class="Symbol">)</a> <a id="10058" class="Symbol">=</a>
   <a id="10063" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="10071" class="Symbol">(</a><a id="10072" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="10087" href="/Soundness/#10036" class="Bound">all-n</a> <a id="10093" href="/Soundness/#10051" class="Bound">d₁</a><a id="10095" class="Symbol">)</a> <a id="10097" class="Symbol">(</a><a id="10098" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="10113" href="/Soundness/#10036" class="Bound">all-n</a> <a id="10119" href="/Soundness/#10054" class="Bound">d₂</a><a id="10121" class="Symbol">)</a>
<a id="10123" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="10138" class="Symbol">{</a><a id="10139" class="Argument">M</a> <a id="10141" class="Symbol">=</a> <a id="10143" href="/Soundness/#10143" class="Bound">L</a> <a id="10145" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="10147" href="/Soundness/#10147" class="Bound">M</a><a id="10148" class="Symbol">}</a> <a id="10150" href="/Soundness/#10150" class="Bound">all-n</a> <a id="10156" class="Symbol">(</a><a id="10157" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="10161" href="/Soundness/#10161" class="Bound">d₁</a> <a id="10164" href="/Soundness/#10164" class="Bound">lt</a><a id="10166" class="Symbol">)</a> <a id="10168" class="Symbol">=</a>
   <a id="10173" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="10177" class="Symbol">(</a><a id="10178" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="10193" href="/Soundness/#10150" class="Bound">all-n</a> <a id="10199" href="/Soundness/#10161" class="Bound">d₁</a><a id="10201" class="Symbol">)</a> <a id="10203" href="/Soundness/#10164" class="Bound">lt</a></pre>

<p>We cannot prove this lemma by induction on the derivation of
<code class="highlighter-rouge">δ ⊢ rename ρ M ↓ v</code>, so instead we proceed by induction on <code class="highlighter-rouge">M</code>.</p>

<ul>
  <li>
    <p>If it is a variable, we apply the inversion lemma to obtain
that <code class="highlighter-rouge">v ⊑ nth (ρ x) δ</code>. Instantiating the premise to <code class="highlighter-rouge">x</code> we have
<code class="highlighter-rouge">nth (ρ x) δ = nth x γ</code>, so we conclude by the <code class="highlighter-rouge">var</code> rule.</p>
  </li>
  <li>
    <p>If it is a lambda abstraction <code class="highlighter-rouge">ƛ N</code>, we have
rename <code class="highlighter-rouge">ρ (ƛ N) = ƛ (rename (ext ρ) N)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ ƛ (rename (ext ρ) N) ↓ v</code>.</p>

    <ul>
      <li>
        <p>Rule <code class="highlighter-rouge">↦-intro</code>: To satisfy the premise of the induction
hypothesis, we prove that the renaming can be extended to be a
mapping from <code class="highlighter-rouge">γ , v₁ to δ , v₁</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊥-intro</code>: We simply apply <code class="highlighter-rouge">⊥-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">⊔-intro</code>: We apply the induction hypotheses and <code class="highlighter-rouge">⊔-intro</code>.</p>
      </li>
      <li>
        <p>Rule <code class="highlighter-rouge">sub</code>: We apply the induction hypothesis and <code class="highlighter-rouge">sub</code>.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>If it is an application <code class="highlighter-rouge">L · M</code>, we have
<code class="highlighter-rouge">rename ρ (L · M) = (rename ρ L) · (rename ρ M)</code>.
We proceed by cases on <code class="highlighter-rouge">δ ⊢ (rename ρ L) · (rename ρ M) ↓ v</code>
and all the cases are straightforward.</p>
  </li>
</ul>

<p>In the upcoming uses of <code class="highlighter-rouge">rename-reflect</code>, the renaming will always be
the increment function. So we prove a corollary for that special case.</p>

<pre class="Agda"><a id="rename-inc-reflect"></a><a id="11384" href="/Soundness/#11384" class="Function">rename-inc-reflect</a> <a id="11403" class="Symbol">:</a> <a id="11405" class="Symbol">∀</a> <a id="11407" class="Symbol">{</a><a id="11408" href="/Soundness/#11408" class="Bound">Γ</a> <a id="11410" href="/Soundness/#11410" class="Bound">v′</a> <a id="11413" href="/Soundness/#11413" class="Bound">v</a><a id="11414" class="Symbol">}</a> <a id="11416" class="Symbol">{</a><a id="11417" href="/Soundness/#11417" class="Bound">γ</a> <a id="11419" class="Symbol">:</a> <a id="11421" href="/Denotational/#7234" class="Function">Env</a> <a id="11425" href="/Soundness/#11408" class="Bound">Γ</a><a id="11426" class="Symbol">}</a> <a id="11428" class="Symbol">{</a> <a id="11430" href="/Soundness/#11430" class="Bound">M</a> <a id="11432" class="Symbol">:</a> <a id="11434" href="/Soundness/#11408" class="Bound">Γ</a> <a id="11436" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="11438" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="11439" class="Symbol">}</a>
  <a id="11443" class="Symbol">→</a> <a id="11445" class="Symbol">(</a><a id="11446" href="/Soundness/#11417" class="Bound">γ</a> <a id="11448" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="11451" href="/Soundness/#11410" class="Bound">v′</a><a id="11453" class="Symbol">)</a> <a id="11455" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="11457" href="/Untyped/#6171" class="Function">rename</a> <a id="11464" href="/Untyped/#3446" class="InductiveConstructor Operator">S_</a> <a id="11467" href="/Soundness/#11430" class="Bound">M</a> <a id="11469" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="11471" href="/Soundness/#11413" class="Bound">v</a>
    <a id="11477" class="Comment">----------------------------</a>
  <a id="11508" class="Symbol">→</a> <a id="11510" href="/Soundness/#11417" class="Bound">γ</a> <a id="11512" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="11514" href="/Soundness/#11430" class="Bound">M</a> <a id="11516" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="11518" href="/Soundness/#11413" class="Bound">v</a>
<a id="11520" href="/Soundness/#11384" class="Function">rename-inc-reflect</a> <a id="11539" href="/Soundness/#11539" class="Bound">d</a> <a id="11541" class="Symbol">=</a> <a id="11543" href="/Soundness/#9233" class="Function">rename-reflect</a> <a id="11558" href="/Denotational/#8778" class="Function">`Refl⊑</a> <a id="11565" href="/Soundness/#11539" class="Bound">d</a></pre>

<h3 id="substitution-reflects-denotations-the-variable-case">Substitution reflects denotations, the variable case</h3>

<p>We are almost ready to begin proving that simultaneous substitution
reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ (subst σ M) ↓ v</code>, then
<code class="highlighter-rouge">γ ⊢ σ k ↓ nth k δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code> and some <code class="highlighter-rouge">δ</code>.
We shall start with the case in which <code class="highlighter-rouge">M</code> is a variable <code class="highlighter-rouge">x</code>.
So instead the premise is <code class="highlighter-rouge">γ ⊢ σ x ↓ v</code> and we need to show that
<code class="highlighter-rouge">δ ⊢ x ↓ v</code> for some <code class="highlighter-rouge">δ</code>. The <code class="highlighter-rouge">δ</code> that we choose shall be the
environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other variable to <code class="highlighter-rouge">⊥</code>.</p>

<p>The nth element of the `⊥ environment is always ⊥.
[PLW: Probably can omit]</p>
<pre class="Agda"><a id="nth-`⊥"></a><a id="12174" href="/Soundness/#12174" class="Function">nth-`⊥</a> <a id="12181" class="Symbol">:</a> <a id="12183" class="Symbol">∀{</a><a id="12185" href="/Soundness/#12185" class="Bound">Γ</a><a id="12186" class="Symbol">}</a> <a id="12188" class="Symbol">{</a><a id="12189" href="/Soundness/#12189" class="Bound">x</a> <a id="12191" class="Symbol">:</a> <a id="12193" href="/Soundness/#12185" class="Bound">Γ</a> <a id="12195" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12197" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12198" class="Symbol">}</a> <a id="12200" class="Symbol">→</a> <a id="12202" href="/Denotational/#8479" class="Function">`⊥</a> <a id="12205" href="/Soundness/#12189" class="Bound">x</a> <a id="12207" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12209" href="/Denotational/#4020" class="InductiveConstructor">⊥</a>
<a id="12211" href="/Soundness/#12174" class="Function">nth-`⊥</a> <a id="12218" class="Symbol">{</a><a id="12219" class="Argument">x</a> <a id="12221" class="Symbol">=</a> <a id="12223" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="12224" class="Symbol">}</a> <a id="12226" class="Symbol">=</a> <a id="12228" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12233" href="/Soundness/#12174" class="Function">nth-`⊥</a> <a id="12240" class="Symbol">{</a><a id="12241" href="/Soundness/#12241" class="Bound">Γ</a> <a id="12243" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="12245" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12246" class="Symbol">}</a> <a id="12248" class="Symbol">{</a><a id="12249" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12251" href="/Soundness/#12251" class="Bound">x</a><a id="12252" class="Symbol">}</a> <a id="12254" class="Symbol">=</a> <a id="12256" href="/Soundness/#12174" class="Function">nth-`⊥</a> <a id="12263" class="Symbol">{</a><a id="12264" href="/Soundness/#12241" class="Bound">Γ</a><a id="12265" class="Symbol">}</a> <a id="12267" class="Symbol">{</a><a id="12268" href="/Soundness/#12251" class="Bound">x</a><a id="12269" class="Symbol">}</a></pre>

<p>Next we define the environment that maps <code class="highlighter-rouge">x</code> to <code class="highlighter-rouge">v</code> and every other
variable to <code class="highlighter-rouge">⊥</code>, that is <code class="highlighter-rouge">const-env x v</code>.</p>

<pre class="Agda"><a id="12407" class="Comment">{-
inv-S : ∀ {Γ A B} {x y : Γ ∋ A}
  → _≡_ {_} {Γ , B ∋ A} (S x) (S y)
  → S x ≡ S y
    -------------------------------
  → x ≡ y
inv-S refl = refl
-}</a>

<a id="_var≟_"></a><a id="12560" href="/Soundness/#12560" class="Function Operator">_var≟_</a> <a id="12567" class="Symbol">:</a> <a id="12569" class="Symbol">∀</a> <a id="12571" class="Symbol">{</a><a id="12572" href="/Soundness/#12572" class="Bound">Γ</a><a id="12573" class="Symbol">}</a> <a id="12575" class="Symbol">→</a> <a id="12577" class="Symbol">(</a><a id="12578" href="/Soundness/#12578" class="Bound">x</a> <a id="12580" href="/Soundness/#12580" class="Bound">y</a> <a id="12582" class="Symbol">:</a> <a id="12584" href="/Soundness/#12572" class="Bound">Γ</a> <a id="12586" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12588" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12589" class="Symbol">)</a> <a id="12591" class="Symbol">→</a> <a id="12593" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#534" class="Datatype">Dec</a> <a id="12597" class="Symbol">(</a><a id="12598" href="/Soundness/#12578" class="Bound">x</a> <a id="12600" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12602" href="/Soundness/#12580" class="Bound">y</a><a id="12603" class="Symbol">)</a>
<a id="12605" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12607" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="12612" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12615" class="Symbol">=</a>  <a id="12618" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12622" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12627" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12629" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="12634" class="Symbol">(</a><a id="12635" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12637" class="Symbol">_)</a>  <a id="12641" class="Symbol">=</a>  <a id="12644" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12647" class="Symbol">λ()</a>
<a id="12651" class="Symbol">(</a><a id="12652" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12654" class="Symbol">_)</a> <a id="12657" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="12662" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="12665" class="Symbol">=</a>  <a id="12668" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12671" class="Symbol">λ()</a>
<a id="12675" class="Symbol">(</a><a id="12676" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12678" href="/Soundness/#12678" class="Bound">x</a><a id="12679" class="Symbol">)</a> <a id="12681" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="12686" class="Symbol">(</a><a id="12687" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12689" href="/Soundness/#12689" class="Bound">y</a><a id="12690" class="Symbol">)</a> <a id="12692" class="Keyword">with</a>  <a id="12698" href="/Soundness/#12678" class="Bound">x</a> <a id="12700" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="12705" href="/Soundness/#12689" class="Bound">y</a>
<a id="12707" class="Symbol">...</a>                 <a id="12727" class="Symbol">|</a>  <a id="12730" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12734" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12739" class="Symbol">=</a>  <a id="12742" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12746" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12751" class="Symbol">...</a>                 <a id="12771" class="Symbol">|</a>  <a id="12774" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12777" href="/Soundness/#12777" class="Bound">neq</a>   <a id="12783" class="Symbol">=</a>  <a id="12786" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="12789" class="Symbol">λ{</a><a id="12791" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="12796" class="Symbol">→</a> <a id="12798" href="/Soundness/#12777" class="Bound">neq</a> <a id="12802" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="12806" class="Symbol">}</a>

<a id="var≟-refl"></a><a id="12809" href="/Soundness/#12809" class="Function">var≟-refl</a> <a id="12819" class="Symbol">:</a> <a id="12821" class="Symbol">∀</a> <a id="12823" class="Symbol">{</a><a id="12824" href="/Soundness/#12824" class="Bound">Γ</a><a id="12825" class="Symbol">}</a> <a id="12827" class="Symbol">(</a><a id="12828" href="/Soundness/#12828" class="Bound">x</a> <a id="12830" class="Symbol">:</a> <a id="12832" href="/Soundness/#12824" class="Bound">Γ</a> <a id="12834" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12836" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12837" class="Symbol">)</a> <a id="12839" class="Symbol">→</a> <a id="12841" class="Symbol">(</a><a id="12842" href="/Soundness/#12828" class="Bound">x</a> <a id="12844" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="12849" href="/Soundness/#12828" class="Bound">x</a><a id="12850" class="Symbol">)</a> <a id="12852" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="12854" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="12858" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12863" href="/Soundness/#12809" class="Function">var≟-refl</a> <a id="12873" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="12875" class="Symbol">=</a> <a id="12877" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="12882" href="/Soundness/#12809" class="Function">var≟-refl</a> <a id="12892" class="Symbol">(</a><a id="12893" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="12895" href="/Soundness/#12895" class="Bound">x</a><a id="12896" class="Symbol">)</a> <a id="12898" class="Keyword">rewrite</a> <a id="12906" href="/Soundness/#12809" class="Function">var≟-refl</a> <a id="12916" href="/Soundness/#12895" class="Bound">x</a> <a id="12918" class="Symbol">=</a> <a id="12920" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>

<a id="const-env"></a><a id="12926" href="/Soundness/#12926" class="Function">const-env</a> <a id="12936" class="Symbol">:</a> <a id="12938" class="Symbol">∀{</a><a id="12940" href="/Soundness/#12940" class="Bound">Γ</a><a id="12941" class="Symbol">}</a> <a id="12943" class="Symbol">→</a> <a id="12945" class="Symbol">(</a><a id="12946" href="/Soundness/#12946" class="Bound">x</a> <a id="12948" class="Symbol">:</a> <a id="12950" href="/Soundness/#12940" class="Bound">Γ</a> <a id="12952" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="12954" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="12955" class="Symbol">)</a> <a id="12957" class="Symbol">→</a> <a id="12959" href="/Denotational/#4000" class="Datatype">Value</a> <a id="12965" class="Symbol">→</a> <a id="12967" href="/Denotational/#7234" class="Function">Env</a> <a id="12971" href="/Soundness/#12940" class="Bound">Γ</a>
<a id="12973" href="/Soundness/#12926" class="Function">const-env</a> <a id="12983" href="/Soundness/#12983" class="Bound">x</a> <a id="12985" href="/Soundness/#12985" class="Bound">v</a> <a id="12987" href="/Soundness/#12987" class="Bound">y</a> <a id="12989" class="Keyword">with</a> <a id="12994" href="/Soundness/#12983" class="Bound">x</a> <a id="12996" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="13001" href="/Soundness/#12987" class="Bound">y</a>
<a id="13003" class="Symbol">...</a>             <a id="13019" class="Symbol">|</a> <a id="13021" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13025" class="Symbol">_</a>       <a id="13033" class="Symbol">=</a> <a id="13035" class="Bound">v</a>
<a id="13037" class="Symbol">...</a>             <a id="13053" class="Symbol">|</a> <a id="13055" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13058" class="Symbol">_</a>        <a id="13067" class="Symbol">=</a> <a id="13069" href="/Denotational/#4020" class="InductiveConstructor">⊥</a></pre>

<p>Of course, the nth element of <code class="highlighter-rouge">const-env n v</code> is the value <code class="highlighter-rouge">v</code>.</p>

<pre class="Agda"><a id="nth-const-env"></a><a id="13161" href="/Soundness/#13161" class="Function">nth-const-env</a> <a id="13175" class="Symbol">:</a> <a id="13177" class="Symbol">∀{</a><a id="13179" href="/Soundness/#13179" class="Bound">Γ</a><a id="13180" class="Symbol">}</a> <a id="13182" class="Symbol">{</a><a id="13183" href="/Soundness/#13183" class="Bound">x</a> <a id="13185" class="Symbol">:</a> <a id="13187" href="/Soundness/#13179" class="Bound">Γ</a> <a id="13189" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13191" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13192" class="Symbol">}</a> <a id="13194" class="Symbol">{</a><a id="13195" href="/Soundness/#13195" class="Bound">v</a><a id="13196" class="Symbol">}</a> <a id="13198" class="Symbol">→</a> <a id="13200" class="Symbol">(</a><a id="13201" href="/Soundness/#12926" class="Function">const-env</a> <a id="13211" href="/Soundness/#13183" class="Bound">x</a> <a id="13213" href="/Soundness/#13195" class="Bound">v</a><a id="13214" class="Symbol">)</a> <a id="13216" href="/Soundness/#13183" class="Bound">x</a> <a id="13218" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13220" href="/Soundness/#13195" class="Bound">v</a>
<a id="13222" href="/Soundness/#13161" class="Function">nth-const-env</a> <a id="13236" class="Symbol">{</a><a id="13237" class="Argument">x</a> <a id="13239" class="Symbol">=</a> <a id="13241" href="/Soundness/#13241" class="Bound">x</a><a id="13242" class="Symbol">}</a> <a id="13244" class="Keyword">rewrite</a> <a id="13252" href="/Soundness/#12809" class="Function">var≟-refl</a> <a id="13262" href="/Soundness/#13241" class="Bound">x</a> <a id="13264" class="Symbol">=</a> <a id="13266" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>The nth element of <code class="highlighter-rouge">const-env n′ v</code> is the value <code class="highlighter-rouge">⊥, so long as </code>n ≢ n′`.</p>

<pre class="Agda"><a id="diff-nth-const-env"></a><a id="13371" href="/Soundness/#13371" class="Function">diff-nth-const-env</a> <a id="13390" class="Symbol">:</a> <a id="13392" class="Symbol">∀{</a><a id="13394" href="/Soundness/#13394" class="Bound">Γ</a><a id="13395" class="Symbol">}</a> <a id="13397" class="Symbol">{</a><a id="13398" href="/Soundness/#13398" class="Bound">x</a> <a id="13400" href="/Soundness/#13400" class="Bound">y</a> <a id="13402" class="Symbol">:</a> <a id="13404" href="/Soundness/#13394" class="Bound">Γ</a> <a id="13406" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="13408" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="13409" class="Symbol">}</a> <a id="13411" class="Symbol">{</a><a id="13412" href="/Soundness/#13412" class="Bound">v</a><a id="13413" class="Symbol">}</a>
  <a id="13417" class="Symbol">→</a> <a id="13419" href="/Soundness/#13398" class="Bound">x</a> <a id="13421" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#660" class="Function Operator">≢</a> <a id="13423" href="/Soundness/#13400" class="Bound">y</a>
    <a id="13429" class="Comment">-------------------</a>
  <a id="13451" class="Symbol">→</a> <a id="13453" href="/Soundness/#12926" class="Function">const-env</a> <a id="13463" href="/Soundness/#13398" class="Bound">x</a> <a id="13465" href="/Soundness/#13412" class="Bound">v</a> <a id="13467" href="/Soundness/#13400" class="Bound">y</a> <a id="13469" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="13471" href="/Denotational/#4020" class="InductiveConstructor">⊥</a>
<a id="13473" href="/Soundness/#13371" class="Function">diff-nth-const-env</a> <a id="13492" class="Symbol">{</a><a id="13493" href="/Soundness/#13493" class="Bound">Γ</a><a id="13494" class="Symbol">}</a> <a id="13496" class="Symbol">{</a><a id="13497" href="/Soundness/#13497" class="Bound">x</a><a id="13498" class="Symbol">}</a> <a id="13500" class="Symbol">{</a><a id="13501" href="/Soundness/#13501" class="Bound">y</a><a id="13502" class="Symbol">}</a> <a id="13504" href="/Soundness/#13504" class="Bound">neq</a> <a id="13508" class="Keyword">with</a> <a id="13513" href="/Soundness/#13497" class="Bound">x</a> <a id="13515" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="13520" href="/Soundness/#13501" class="Bound">y</a>
<a id="13522" class="Symbol">...</a>  <a id="13527" class="Symbol">|</a> <a id="13529" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="13533" href="/Soundness/#13533" class="Bound">eq</a>  <a id="13537" class="Symbol">=</a>  <a id="13540" href="https://agda.github.io/agda-stdlib/v0.17/Data.Empty.html#360" class="Function">⊥-elim</a> <a id="13547" class="Symbol">(</a><a id="13548" class="Bound">neq</a> <a id="13552" href="/Soundness/#13533" class="Bound">eq</a><a id="13554" class="Symbol">)</a>
<a id="13556" class="Symbol">...</a>  <a id="13561" class="Symbol">|</a> <a id="13563" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="13566" class="Symbol">_</a>    <a id="13571" class="Symbol">=</a>  <a id="13574" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<p>So we choose <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code> and obtain <code class="highlighter-rouge">δ ⊢ x ↓ v</code>
with the <code class="highlighter-rouge">var</code> rule.</p>

<p>It remains to prove that <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> and <code class="highlighter-rouge">δ ⊢ M ↓ v</code> for any <code class="highlighter-rouge">k</code>, given that
we have chosen <code class="highlighter-rouge">const-env x v</code> for <code class="highlighter-rouge">δ</code>.  We shall have two cases to
consider, <code class="highlighter-rouge">x ≡ y</code> or <code class="highlighter-rouge">x ≢ y</code>.</p>

<p>Now to finish the two cases of the proof.</p>

<ul>
  <li>In the case where <code class="highlighter-rouge">x ≡ y</code>, we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ v</code>, but that’s just our premise.</li>
  <li>In the case where <code class="highlighter-rouge">x ≢ y,</code> we need to show
that <code class="highlighter-rouge">γ ⊢ σ y ↓ ⊥</code>, which we do via rule <code class="highlighter-rouge">⊥-intro</code>.</li>
</ul>

<p>Thus, we have completed the variable case of the proof that
simultaneous substitution reflects denotations.  Here is the proof
again, formally.</p>

<pre class="Agda"><a id="subst-reflect-var"></a><a id="14246" href="/Soundness/#14246" class="Function">subst-reflect-var</a> <a id="14264" class="Symbol">:</a> <a id="14266" class="Symbol">∀</a> <a id="14268" class="Symbol">{</a><a id="14269" href="/Soundness/#14269" class="Bound">Γ</a> <a id="14271" href="/Soundness/#14271" class="Bound">Δ</a><a id="14272" class="Symbol">}</a> <a id="14274" class="Symbol">{</a><a id="14275" href="/Soundness/#14275" class="Bound">γ</a> <a id="14277" class="Symbol">:</a> <a id="14279" href="/Denotational/#7234" class="Function">Env</a> <a id="14283" href="/Soundness/#14271" class="Bound">Δ</a><a id="14284" class="Symbol">}</a> <a id="14286" class="Symbol">{</a><a id="14287" href="/Soundness/#14287" class="Bound">x</a> <a id="14289" class="Symbol">:</a> <a id="14291" href="/Soundness/#14269" class="Bound">Γ</a> <a id="14293" href="/Untyped/#3365" class="Datatype Operator">∋</a> <a id="14295" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="14296" class="Symbol">}</a> <a id="14298" class="Symbol">{</a><a id="14299" href="/Soundness/#14299" class="Bound">v</a><a id="14300" class="Symbol">}</a> <a id="14302" class="Symbol">{</a><a id="14303" href="/Soundness/#14303" class="Bound">σ</a> <a id="14305" class="Symbol">:</a> <a id="14307" href="/Substitution/#2506" class="Function">Subst</a> <a id="14313" href="/Soundness/#14269" class="Bound">Γ</a> <a id="14315" href="/Soundness/#14271" class="Bound">Δ</a><a id="14316" class="Symbol">}</a>
  <a id="14320" class="Symbol">→</a> <a id="14322" href="/Soundness/#14275" class="Bound">γ</a> <a id="14324" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="14326" href="/Soundness/#14303" class="Bound">σ</a> <a id="14328" href="/Soundness/#14287" class="Bound">x</a> <a id="14330" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="14332" href="/Soundness/#14299" class="Bound">v</a>
    <a id="14338" class="Comment">-----------------------------------------</a>
  <a id="14382" class="Symbol">→</a> <a id="14384" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="14387" href="/Soundness/#14387" class="Bound">δ</a> <a id="14389" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="14391" href="/Denotational/#7234" class="Function">Env</a> <a id="14395" href="/Soundness/#14269" class="Bound">Γ</a> <a id="14397" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="14399" href="/Soundness/#14275" class="Bound">γ</a> <a id="14401" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="14404" href="/Soundness/#14303" class="Bound">σ</a> <a id="14406" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="14408" href="/Soundness/#14387" class="Bound">δ</a>  <a id="14411" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a>  <a id="14414" href="/Soundness/#14387" class="Bound">δ</a> <a id="14416" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="14418" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="14420" href="/Soundness/#14287" class="Bound">x</a> <a id="14422" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="14424" href="/Soundness/#14299" class="Bound">v</a>
<a id="14426" href="/Soundness/#14246" class="Function">subst-reflect-var</a> <a id="14444" class="Symbol">{</a><a id="14445" href="/Soundness/#14445" class="Bound">Γ</a><a id="14446" class="Symbol">}{</a><a id="14448" href="/Soundness/#14448" class="Bound">Δ</a><a id="14449" class="Symbol">}{</a><a id="14451" href="/Soundness/#14451" class="Bound">γ</a><a id="14452" class="Symbol">}{</a><a id="14454" href="/Soundness/#14454" class="Bound">x</a><a id="14455" class="Symbol">}{</a><a id="14457" href="/Soundness/#14457" class="Bound">v</a><a id="14458" class="Symbol">}{</a><a id="14460" href="/Soundness/#14460" class="Bound">σ</a><a id="14461" class="Symbol">}</a> <a id="14463" href="/Soundness/#14463" class="Bound">xv</a>
  <a id="14468" class="Keyword">rewrite</a> <a id="14476" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14480" class="Symbol">(</a><a id="14481" href="/Soundness/#13161" class="Function">nth-const-env</a> <a id="14495" class="Symbol">{</a><a id="14496" href="/Soundness/#14445" class="Bound">Γ</a><a id="14497" class="Symbol">}{</a><a id="14499" href="/Soundness/#14454" class="Bound">x</a><a id="14500" class="Symbol">}{</a><a id="14502" href="/Soundness/#14457" class="Bound">v</a><a id="14503" class="Symbol">})</a> <a id="14506" class="Symbol">=</a>
    <a id="14512" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14514" href="/Soundness/#12926" class="Function">const-env</a> <a id="14524" href="/Soundness/#14454" class="Bound">x</a> <a id="14526" href="/Soundness/#14457" class="Bound">v</a> <a id="14528" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14530" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="14532" href="/Soundness/#14565" class="Function">const-env-ok</a> <a id="14545" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="14547" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="14551" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="14553" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
  <a id="14557" class="Keyword">where</a>
  <a id="14565" href="/Soundness/#14565" class="Function">const-env-ok</a> <a id="14578" class="Symbol">:</a> <a id="14580" href="/Soundness/#14451" class="Bound">γ</a> <a id="14582" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="14585" href="/Soundness/#14460" class="Bound">σ</a> <a id="14587" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="14589" href="/Soundness/#12926" class="Function">const-env</a> <a id="14599" href="/Soundness/#14454" class="Bound">x</a> <a id="14601" href="/Soundness/#14457" class="Bound">v</a>
  <a id="14605" href="/Soundness/#14565" class="Function">const-env-ok</a> <a id="14618" href="/Soundness/#14618" class="Bound">y</a> <a id="14620" class="Keyword">with</a> <a id="14625" href="/Soundness/#14454" class="Bound">x</a> <a id="14627" href="/Soundness/#12560" class="Function Operator">var≟</a> <a id="14632" href="/Soundness/#14618" class="Bound">y</a>
  <a id="14636" class="Symbol">...</a> <a id="14640" class="Symbol">|</a> <a id="14642" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#570" class="InductiveConstructor">yes</a> <a id="14646" href="/Soundness/#14646" class="Bound">x≡y</a> <a id="14650" class="Keyword">rewrite</a> <a id="14658" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="14662" href="/Soundness/#14646" class="Bound">x≡y</a> <a id="14666" class="Symbol">|</a> <a id="14668" href="/Soundness/#13161" class="Function">nth-const-env</a> <a id="14682" class="Symbol">{</a><a id="14683" href="/Soundness/#14445" class="Bound">Γ</a><a id="14684" class="Symbol">}{</a><a id="14686" href="/Soundness/#14454" class="Bound">x</a><a id="14687" class="Symbol">}{</a><a id="14689" href="/Soundness/#14457" class="Bound">v</a><a id="14690" class="Symbol">}</a> <a id="14692" class="Symbol">=</a> <a id="14694" href="/Soundness/#14463" class="Bound">xv</a>
  <a id="14699" class="Symbol">...</a> <a id="14703" class="Symbol">|</a> <a id="14705" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Nullary.html#597" class="InductiveConstructor">no</a> <a id="14708" href="/Soundness/#14708" class="Bound">x≢y</a> <a id="14712" class="Keyword">rewrite</a> <a id="14720" href="/Soundness/#13371" class="Function">diff-nth-const-env</a> <a id="14739" class="Symbol">{</a><a id="14740" href="/Soundness/#14445" class="Bound">Γ</a><a id="14741" class="Symbol">}{</a><a id="14743" href="/Soundness/#14454" class="Bound">x</a><a id="14744" class="Symbol">}{</a><a id="14746" class="Bound">y</a><a id="14747" class="Symbol">}{</a><a id="14749" href="/Soundness/#14457" class="Bound">v</a><a id="14750" class="Symbol">}</a> <a id="14752" href="/Soundness/#14708" class="Bound">x≢y</a> <a id="14756" class="Symbol">=</a> <a id="14758" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a></pre>

<h3 id="substitutions-and-environment-construction">Substitutions and environment construction</h3>

<p>Every substitution produces terms that can evaluate to <code class="highlighter-rouge">⊥</code>.</p>

<pre class="Agda"><a id="subst-⊥"></a><a id="14901" href="/Soundness/#14901" class="Function">subst-⊥</a> <a id="14909" class="Symbol">:</a> <a id="14911" class="Symbol">∀{</a><a id="14913" href="/Soundness/#14913" class="Bound">Γ</a> <a id="14915" href="/Soundness/#14915" class="Bound">Δ</a><a id="14916" class="Symbol">}{</a><a id="14918" href="/Soundness/#14918" class="Bound">γ</a> <a id="14920" class="Symbol">:</a> <a id="14922" href="/Denotational/#7234" class="Function">Env</a> <a id="14926" href="/Soundness/#14915" class="Bound">Δ</a><a id="14927" class="Symbol">}{</a><a id="14929" href="/Soundness/#14929" class="Bound">σ</a> <a id="14931" class="Symbol">:</a> <a id="14933" href="/Substitution/#2506" class="Function">Subst</a> <a id="14939" href="/Soundness/#14913" class="Bound">Γ</a> <a id="14941" href="/Soundness/#14915" class="Bound">Δ</a><a id="14942" class="Symbol">}</a>
    <a id="14948" class="Comment">-----------------</a>
  <a id="14968" class="Symbol">→</a> <a id="14970" href="/Soundness/#14918" class="Bound">γ</a> <a id="14972" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="14975" href="/Soundness/#14929" class="Bound">σ</a> <a id="14977" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="14979" href="/Denotational/#8479" class="Function">`⊥</a>
<a id="14982" href="/Soundness/#14901" class="Function">subst-⊥</a> <a id="14990" href="/Soundness/#14990" class="Bound">x</a> <a id="14992" class="Symbol">=</a> <a id="14994" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a></pre>

<p>If a substitution produces terms that evaluate to the values in
both <code class="highlighter-rouge">γ₁</code> and <code class="highlighter-rouge">γ₂</code>, then those terms also evaluate to the values in 
<code class="highlighter-rouge">γ₁ ⊔ γ₂</code>.</p>

<pre class="Agda"><a id="subst-⊔"></a><a id="15172" href="/Soundness/#15172" class="Function">subst-⊔</a> <a id="15180" class="Symbol">:</a> <a id="15182" class="Symbol">∀{</a><a id="15184" href="/Soundness/#15184" class="Bound">Γ</a> <a id="15186" href="/Soundness/#15186" class="Bound">Δ</a><a id="15187" class="Symbol">}{</a><a id="15189" href="/Soundness/#15189" class="Bound">γ</a> <a id="15191" class="Symbol">:</a> <a id="15193" href="/Denotational/#7234" class="Function">Env</a> <a id="15197" href="/Soundness/#15186" class="Bound">Δ</a><a id="15198" class="Symbol">}{</a><a id="15200" href="/Soundness/#15200" class="Bound">γ₁</a> <a id="15203" href="/Soundness/#15203" class="Bound">γ₂</a> <a id="15206" class="Symbol">:</a> <a id="15208" href="/Denotational/#7234" class="Function">Env</a> <a id="15212" href="/Soundness/#15184" class="Bound">Γ</a><a id="15213" class="Symbol">}{</a><a id="15215" href="/Soundness/#15215" class="Bound">σ</a> <a id="15217" class="Symbol">:</a> <a id="15219" href="/Substitution/#2506" class="Function">Subst</a> <a id="15225" href="/Soundness/#15184" class="Bound">Γ</a> <a id="15227" href="/Soundness/#15186" class="Bound">Δ</a><a id="15228" class="Symbol">}</a>
           <a id="15241" class="Symbol">→</a> <a id="15243" href="/Soundness/#15189" class="Bound">γ</a> <a id="15245" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="15248" href="/Soundness/#15215" class="Bound">σ</a> <a id="15250" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="15252" href="/Soundness/#15200" class="Bound">γ₁</a>
           <a id="15266" class="Symbol">→</a> <a id="15268" href="/Soundness/#15189" class="Bound">γ</a> <a id="15270" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="15273" href="/Soundness/#15215" class="Bound">σ</a> <a id="15275" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="15277" href="/Soundness/#15203" class="Bound">γ₂</a>
             <a id="15293" class="Comment">-------------------------</a>
           <a id="15330" class="Symbol">→</a> <a id="15332" href="/Soundness/#15189" class="Bound">γ</a> <a id="15334" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="15337" href="/Soundness/#15215" class="Bound">σ</a> <a id="15339" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="15341" class="Symbol">(</a><a id="15342" href="/Soundness/#15200" class="Bound">γ₁</a> <a id="15345" href="/Denotational/#8508" class="Function Operator">`⊔</a> <a id="15348" href="/Soundness/#15203" class="Bound">γ₂</a><a id="15350" class="Symbol">)</a>
<a id="15352" href="/Soundness/#15172" class="Function">subst-⊔</a> <a id="15360" href="/Soundness/#15360" class="Bound">γ₁-ok</a> <a id="15366" href="/Soundness/#15366" class="Bound">γ₂-ok</a> <a id="15372" href="/Soundness/#15372" class="Bound">x</a> <a id="15374" class="Symbol">=</a> <a id="15376" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="15384" class="Symbol">(</a><a id="15385" href="/Soundness/#15360" class="Bound">γ₁-ok</a> <a id="15391" href="/Soundness/#15372" class="Bound">x</a><a id="15392" class="Symbol">)</a> <a id="15394" class="Symbol">(</a><a id="15395" href="/Soundness/#15366" class="Bound">γ₂-ok</a> <a id="15401" href="/Soundness/#15372" class="Bound">x</a><a id="15402" class="Symbol">)</a></pre>

<h3 id="the-lambda-constructor-is-injective">The Lambda constructor is injective</h3>

<pre class="Agda"><a id="lambda-inj"></a><a id="15470" href="/Soundness/#15470" class="Function">lambda-inj</a> <a id="15481" class="Symbol">:</a> <a id="15483" class="Symbol">∀</a> <a id="15485" class="Symbol">{</a><a id="15486" href="/Soundness/#15486" class="Bound">Γ</a><a id="15487" class="Symbol">}</a> <a id="15489" class="Symbol">{</a><a id="15490" href="/Soundness/#15490" class="Bound">M</a> <a id="15492" href="/Soundness/#15492" class="Bound">N</a> <a id="15494" class="Symbol">:</a> <a id="15496" href="/Soundness/#15486" class="Bound">Γ</a> <a id="15498" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="15500" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15502" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15504" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="15506" class="Symbol">}</a>
  <a id="15510" class="Symbol">→</a> <a id="15512" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">_≡_</a> <a id="15516" class="Symbol">{</a><a id="15517" class="Argument">A</a> <a id="15519" class="Symbol">=</a> <a id="15521" href="/Soundness/#15486" class="Bound">Γ</a> <a id="15523" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="15525" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="15526" class="Symbol">}</a> <a id="15528" class="Symbol">(</a><a id="15529" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15531" href="/Soundness/#15490" class="Bound">M</a><a id="15532" class="Symbol">)</a> <a id="15534" class="Symbol">(</a><a id="15535" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="15537" href="/Soundness/#15492" class="Bound">N</a><a id="15538" class="Symbol">)</a>
    <a id="15544" class="Comment">---------------------------</a>
  <a id="15574" class="Symbol">→</a> <a id="15576" href="/Soundness/#15490" class="Bound">M</a> <a id="15578" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="15580" href="/Soundness/#15492" class="Bound">N</a>
<a id="15582" href="/Soundness/#15470" class="Function">lambda-inj</a> <a id="15593" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="15598" class="Symbol">=</a> <a id="15600" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a></pre>

<h3 id="simultaneous-substitution-reflects-denotations">Simultaneous substitution reflects denotations</h3>

<p>In this section we prove a central lemma, that
substitution reflects denotations. That is, if <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>, then
<code class="highlighter-rouge">δ ⊢ M ↓ v</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ</code> for some <code class="highlighter-rouge">δ</code>. We shall proceed by induction on
the derivation of <code class="highlighter-rouge">γ ⊢ subst σ M ↓ v</code>. This requires a minor
restatement of the lemma, changing the premise to <code class="highlighter-rouge">γ ⊢ L ↓ v</code> and
<code class="highlighter-rouge">L ≡ subst σ M</code>.</p>

<pre class="Agda"><a id="split"></a><a id="16022" href="/Soundness/#16022" class="Function">split</a> <a id="16028" class="Symbol">:</a> <a id="16030" class="Symbol">∀</a> <a id="16032" class="Symbol">{</a><a id="16033" href="/Soundness/#16033" class="Bound">Γ</a><a id="16034" class="Symbol">}</a> <a id="16036" class="Symbol">{</a><a id="16037" href="/Soundness/#16037" class="Bound">M</a> <a id="16039" class="Symbol">:</a> <a id="16041" href="/Soundness/#16033" class="Bound">Γ</a> <a id="16043" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="16045" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="16047" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16049" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16050" class="Symbol">}</a> <a id="16052" class="Symbol">{</a><a id="16053" href="/Soundness/#16053" class="Bound">δ</a> <a id="16055" class="Symbol">:</a> <a id="16057" href="/Denotational/#7234" class="Function">Env</a> <a id="16061" class="Symbol">(</a><a id="16062" href="/Soundness/#16033" class="Bound">Γ</a> <a id="16064" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="16066" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16067" class="Symbol">)}</a> <a id="16070" class="Symbol">{</a><a id="16071" href="/Soundness/#16071" class="Bound">v</a><a id="16072" class="Symbol">}</a>
  <a id="16076" class="Symbol">→</a> <a id="16078" href="/Soundness/#16053" class="Bound">δ</a> <a id="16080" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="16082" href="/Soundness/#16037" class="Bound">M</a> <a id="16084" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="16086" href="/Soundness/#16071" class="Bound">v</a>
    <a id="16092" class="Comment">--------------------------</a>
  <a id="16121" class="Symbol">→</a> <a id="16123" class="Symbol">(</a><a id="16124" href="/Denotational/#7660" class="Function">init</a> <a id="16129" href="/Soundness/#16053" class="Bound">δ</a> <a id="16131" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="16134" href="/Denotational/#7715" class="Function">last</a> <a id="16139" href="/Soundness/#16053" class="Bound">δ</a><a id="16140" class="Symbol">)</a> <a id="16142" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="16144" href="/Soundness/#16037" class="Bound">M</a> <a id="16146" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="16148" href="/Soundness/#16071" class="Bound">v</a>
<a id="16150" href="/Soundness/#16022" class="Function">split</a> <a id="16156" class="Symbol">{</a><a id="16157" class="Argument">δ</a> <a id="16159" class="Symbol">=</a> <a id="16161" href="/Soundness/#16161" class="Bound">δ</a><a id="16162" class="Symbol">}</a> <a id="16164" href="/Soundness/#16164" class="Bound">δMv</a> <a id="16168" class="Keyword">rewrite</a> <a id="16176" href="/Denotational/#7764" class="Function">init-last</a> <a id="16186" href="/Soundness/#16161" class="Bound">δ</a> <a id="16188" class="Symbol">=</a> <a id="16190" href="/Soundness/#16164" class="Bound">δMv</a>

<a id="subst-reflect"></a><a id="16195" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16209" class="Symbol">:</a> <a id="16211" class="Symbol">∀</a> <a id="16213" class="Symbol">{</a><a id="16214" href="/Soundness/#16214" class="Bound">Γ</a> <a id="16216" href="/Soundness/#16216" class="Bound">Δ</a><a id="16217" class="Symbol">}</a> <a id="16219" class="Symbol">{</a><a id="16220" href="/Soundness/#16220" class="Bound">δ</a> <a id="16222" class="Symbol">:</a> <a id="16224" href="/Denotational/#7234" class="Function">Env</a> <a id="16228" href="/Soundness/#16216" class="Bound">Δ</a><a id="16229" class="Symbol">}</a> <a id="16231" class="Symbol">{</a><a id="16232" href="/Soundness/#16232" class="Bound">M</a> <a id="16234" class="Symbol">:</a> <a id="16236" href="/Soundness/#16214" class="Bound">Γ</a> <a id="16238" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16240" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16241" class="Symbol">}</a> <a id="16243" class="Symbol">{</a><a id="16244" href="/Soundness/#16244" class="Bound">v</a><a id="16245" class="Symbol">}</a> <a id="16247" class="Symbol">{</a><a id="16248" href="/Soundness/#16248" class="Bound">L</a> <a id="16250" class="Symbol">:</a> <a id="16252" href="/Soundness/#16216" class="Bound">Δ</a> <a id="16254" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="16256" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="16257" class="Symbol">}</a> <a id="16259" class="Symbol">{</a><a id="16260" href="/Soundness/#16260" class="Bound">σ</a> <a id="16262" class="Symbol">:</a> <a id="16264" href="/Substitution/#2506" class="Function">Subst</a> <a id="16270" href="/Soundness/#16214" class="Bound">Γ</a> <a id="16272" href="/Soundness/#16216" class="Bound">Δ</a><a id="16273" class="Symbol">}</a>
  <a id="16277" class="Symbol">→</a> <a id="16279" href="/Soundness/#16220" class="Bound">δ</a> <a id="16281" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="16283" href="/Soundness/#16248" class="Bound">L</a> <a id="16285" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="16287" href="/Soundness/#16244" class="Bound">v</a>
  <a id="16291" class="Symbol">→</a> <a id="16293" href="/Untyped/#6931" class="Function">subst</a> <a id="16299" href="/Soundness/#16260" class="Bound">σ</a> <a id="16301" href="/Soundness/#16232" class="Bound">M</a> <a id="16303" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="16305" href="/Soundness/#16248" class="Bound">L</a>
    <a id="16311" class="Comment">---------------------------------------</a>
  <a id="16353" class="Symbol">→</a> <a id="16355" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="16358" href="/Soundness/#16358" class="Bound">γ</a> <a id="16360" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="16362" href="/Denotational/#7234" class="Function">Env</a> <a id="16366" href="/Soundness/#16214" class="Bound">Γ</a> <a id="16368" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="16370" href="/Soundness/#16220" class="Bound">δ</a> <a id="16372" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="16375" href="/Soundness/#16260" class="Bound">σ</a> <a id="16377" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="16379" href="/Soundness/#16358" class="Bound">γ</a>  <a id="16382" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a>  <a id="16385" href="/Soundness/#16358" class="Bound">γ</a> <a id="16387" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="16389" href="/Soundness/#16232" class="Bound">M</a> <a id="16391" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="16393" href="/Soundness/#16244" class="Bound">v</a>

<a id="16396" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16410" class="Symbol">{</a><a id="16411" class="Argument">M</a> <a id="16413" class="Symbol">=</a> <a id="16415" href="/Soundness/#16415" class="Bound">M</a><a id="16416" class="Symbol">}{</a><a id="16418" class="Argument">σ</a> <a id="16420" class="Symbol">=</a> <a id="16422" href="/Soundness/#16422" class="Bound">σ</a><a id="16423" class="Symbol">}</a> <a id="16425" class="Symbol">(</a><a id="16426" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="16430" class="Symbol">{</a><a id="16431" class="Argument">x</a> <a id="16433" class="Symbol">=</a> <a id="16435" href="/Soundness/#16435" class="Bound">y</a><a id="16436" class="Symbol">})</a> <a id="16439" href="/Soundness/#16439" class="Bound">eqL</a> <a id="16443" class="Keyword">with</a> <a id="16448" href="/Soundness/#16415" class="Bound">M</a> 
<a id="16451" class="Symbol">...</a> <a id="16455" class="Symbol">|</a> <a id="16457" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16459" href="/Soundness/#16459" class="Bound">x</a>  <a id="16462" class="Keyword">with</a> <a id="16467" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="16471" class="Symbol">{</a><a id="16472" class="Argument">x</a> <a id="16474" class="Symbol">=</a> <a id="16476" class="Bound">y</a><a id="16477" class="Symbol">}</a>
<a id="16479" class="Symbol">...</a>           <a id="16493" class="Symbol">|</a> <a id="16495" href="/Soundness/#16495" class="Bound">yv</a>  <a id="16499" class="Keyword">rewrite</a> <a id="16507" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16511" class="Bound">eqL</a> <a id="16515" class="Symbol">=</a> <a id="16517" href="/Soundness/#14246" class="Function">subst-reflect-var</a> <a id="16535" class="Symbol">{</a><a id="16536" class="Argument">σ</a> <a id="16538" class="Symbol">=</a> <a id="16540" class="Bound">σ</a><a id="16541" class="Symbol">}</a> <a id="16543" href="/Soundness/#16495" class="Bound">yv</a>
<a id="16546" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16560" class="Symbol">{</a><a id="16561" class="Argument">M</a> <a id="16563" class="Symbol">=</a> <a id="16565" href="/Soundness/#16565" class="Bound">M</a><a id="16566" class="Symbol">}</a> <a id="16568" class="Symbol">(</a><a id="16569" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="16573" class="Symbol">{</a><a id="16574" class="Argument">x</a> <a id="16576" class="Symbol">=</a> <a id="16578" href="/Soundness/#16578" class="Bound">y</a><a id="16579" class="Symbol">})</a> <a id="16582" class="Symbol">()</a> <a id="16585" class="Symbol">|</a> <a id="16587" href="/Soundness/#16587" class="Bound">M₁</a> <a id="16590" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16592" href="/Soundness/#16592" class="Bound">M₂</a>
<a id="16595" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16609" class="Symbol">{</a><a id="16610" class="Argument">M</a> <a id="16612" class="Symbol">=</a> <a id="16614" href="/Soundness/#16614" class="Bound">M</a><a id="16615" class="Symbol">}</a> <a id="16617" class="Symbol">(</a><a id="16618" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="16622" class="Symbol">{</a><a id="16623" class="Argument">x</a> <a id="16625" class="Symbol">=</a> <a id="16627" href="/Soundness/#16627" class="Bound">y</a><a id="16628" class="Symbol">})</a> <a id="16631" class="Symbol">()</a> <a id="16634" class="Symbol">|</a> <a id="16636" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16638" href="/Soundness/#16638" class="Bound">M′</a>

<a id="16642" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16656" class="Symbol">{</a><a id="16657" class="Argument">M</a> <a id="16659" class="Symbol">=</a> <a id="16661" href="/Soundness/#16661" class="Bound">M</a><a id="16662" class="Symbol">}{</a><a id="16664" class="Argument">σ</a> <a id="16666" class="Symbol">=</a> <a id="16668" href="/Soundness/#16668" class="Bound">σ</a><a id="16669" class="Symbol">}</a> <a id="16671" class="Symbol">(</a><a id="16672" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="16679" href="/Soundness/#16679" class="Bound">d₁</a> <a id="16682" href="/Soundness/#16682" class="Bound">d₂</a><a id="16684" class="Symbol">)</a> <a id="16686" href="/Soundness/#16686" class="Bound">eqL</a>
         <a id="16699" class="Keyword">with</a> <a id="16704" href="/Soundness/#16661" class="Bound">M</a> 
<a id="16707" class="Symbol">...</a>    <a id="16714" class="Symbol">|</a> <a id="16716" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="16718" href="/Soundness/#16718" class="Bound">x</a> <a id="16720" class="Keyword">with</a> <a id="16725" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="16732" class="Bound">d₁</a> <a id="16735" class="Bound">d₂</a> 
<a id="16739" class="Symbol">...</a>    <a id="16746" class="Symbol">|</a> <a id="16748" href="/Soundness/#16748" class="Bound">d′</a> <a id="16751" class="Keyword">rewrite</a> <a id="16759" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="16763" class="Bound">eqL</a> <a id="16767" class="Symbol">=</a> <a id="16769" href="/Soundness/#14246" class="Function">subst-reflect-var</a> <a id="16787" class="Symbol">{</a><a id="16788" class="Argument">σ</a> <a id="16790" class="Symbol">=</a> <a id="16792" class="Bound">σ</a><a id="16793" class="Symbol">}</a> <a id="16795" href="/Soundness/#16748" class="Bound">d′</a>
<a id="16798" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16812" class="Symbol">(</a><a id="16813" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="16820" href="/Soundness/#16820" class="Bound">d₁</a> <a id="16823" href="/Soundness/#16823" class="Bound">d₂</a><a id="16825" class="Symbol">)</a> <a id="16827" class="Symbol">()</a> <a id="16830" class="Symbol">|</a> <a id="16832" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="16834" href="/Soundness/#16834" class="Bound">M′</a>
<a id="16837" href="/Soundness/#16195" class="Function">subst-reflect</a><a id="16850" class="Symbol">{</a><a id="16851" href="/Soundness/#16851" class="Bound">Γ</a><a id="16852" class="Symbol">}{</a><a id="16854" href="/Soundness/#16854" class="Bound">Δ</a><a id="16855" class="Symbol">}{</a><a id="16857" href="/Soundness/#16857" class="Bound">γ</a><a id="16858" class="Symbol">}{</a><a id="16860" class="Argument">σ</a> <a id="16862" class="Symbol">=</a> <a id="16864" href="/Soundness/#16864" class="Bound">σ</a><a id="16865" class="Symbol">}</a> <a id="16867" class="Symbol">(</a><a id="16868" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="16875" href="/Soundness/#16875" class="Bound">d₁</a> <a id="16878" href="/Soundness/#16878" class="Bound">d₂</a><a id="16880" class="Symbol">)</a>
   <a id="16885" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16890" class="Symbol">|</a> <a id="16892" href="/Soundness/#16892" class="Bound">M₁</a> <a id="16895" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="16897" href="/Soundness/#16897" class="Bound">M₂</a>
     <a id="16905" class="Keyword">with</a> <a id="16910" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16924" class="Symbol">{</a><a id="16925" class="Argument">M</a> <a id="16927" class="Symbol">=</a> <a id="16929" href="/Soundness/#16892" class="Bound">M₁</a><a id="16931" class="Symbol">}</a> <a id="16933" href="/Soundness/#16875" class="Bound">d₁</a> <a id="16936" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="16941" class="Symbol">|</a> <a id="16943" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="16957" class="Symbol">{</a><a id="16958" class="Argument">M</a> <a id="16960" class="Symbol">=</a> <a id="16962" href="/Soundness/#16897" class="Bound">M₂</a><a id="16964" class="Symbol">}</a> <a id="16966" href="/Soundness/#16878" class="Bound">d₂</a> <a id="16969" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="16974" class="Symbol">...</a>     <a id="16982" class="Symbol">|</a> <a id="16984" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16986" href="/Soundness/#16986" class="Bound">δ₁</a> <a id="16989" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="16991" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="16993" href="/Soundness/#16993" class="Bound">subst-δ₁</a> <a id="17002" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17004" href="/Soundness/#17004" class="Bound">m1</a> <a id="17007" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17009" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17011" class="Symbol">|</a> <a id="17013" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17015" href="/Soundness/#17015" class="Bound">δ₂</a> <a id="17018" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17020" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17022" href="/Soundness/#17022" class="Bound">subst-δ₂</a> <a id="17031" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17033" href="/Soundness/#17033" class="Bound">m2</a> <a id="17036" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17038" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17040" class="Symbol">=</a>
     <a id="17047" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17049" href="/Soundness/#16986" class="Bound">δ₁</a> <a id="17052" href="/Denotational/#8508" class="Function Operator">`⊔</a> <a id="17055" href="/Soundness/#17015" class="Bound">δ₂</a> <a id="17058" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17060" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17062" href="/Soundness/#15172" class="Function">subst-⊔</a> <a id="17070" class="Symbol">{</a><a id="17071" class="Argument">γ₁</a> <a id="17074" class="Symbol">=</a> <a id="17076" href="/Soundness/#16986" class="Bound">δ₁</a><a id="17078" class="Symbol">}{</a><a id="17080" class="Argument">γ₂</a> <a id="17083" class="Symbol">=</a> <a id="17085" href="/Soundness/#17015" class="Bound">δ₂</a><a id="17087" class="Symbol">}{</a><a id="17089" class="Argument">σ</a> <a id="17091" class="Symbol">=</a> <a id="17093" class="Bound">σ</a><a id="17094" class="Symbol">}</a> <a id="17096" href="/Soundness/#16993" class="Bound">subst-δ₁</a> <a id="17105" href="/Soundness/#17022" class="Bound">subst-δ₂</a> <a id="17114" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="17136" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="17143" class="Symbol">(</a><a id="17144" href="/Denotational/#25313" class="Function">Env⊑</a> <a id="17149" href="/Soundness/#17004" class="Bound">m1</a> <a id="17152" class="Symbol">(</a><a id="17153" href="/Denotational/#8846" class="Function">EnvConjR1⊑</a> <a id="17164" href="/Soundness/#16986" class="Bound">δ₁</a> <a id="17167" href="/Soundness/#17015" class="Bound">δ₂</a><a id="17169" class="Symbol">))</a>
                           <a id="17199" class="Symbol">(</a><a id="17200" href="/Denotational/#25313" class="Function">Env⊑</a> <a id="17205" href="/Soundness/#17033" class="Bound">m2</a> <a id="17208" class="Symbol">(</a><a id="17209" href="/Denotational/#8943" class="Function">EnvConjR2⊑</a> <a id="17220" href="/Soundness/#16986" class="Bound">δ₁</a> <a id="17223" href="/Soundness/#17015" class="Bound">δ₂</a><a id="17225" class="Symbol">))</a> <a id="17228" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17230" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17233" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17247" class="Symbol">{</a><a id="17248" class="Argument">M</a> <a id="17250" class="Symbol">=</a> <a id="17252" href="/Soundness/#17252" class="Bound">M</a><a id="17253" class="Symbol">}{</a><a id="17255" class="Argument">σ</a> <a id="17257" class="Symbol">=</a> <a id="17259" href="/Soundness/#17259" class="Bound">σ</a><a id="17260" class="Symbol">}</a> <a id="17262" class="Symbol">(</a><a id="17263" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="17271" href="/Soundness/#17271" class="Bound">d</a><a id="17272" class="Symbol">)</a> <a id="17274" href="/Soundness/#17274" class="Bound">eqL</a> <a id="17278" class="Keyword">with</a> <a id="17283" href="/Soundness/#17252" class="Bound">M</a>
<a id="17285" class="Symbol">...</a>    <a id="17292" class="Symbol">|</a> <a id="17294" href="/Untyped/#4186" class="InductiveConstructor Operator">`</a> <a id="17296" href="/Soundness/#17296" class="Bound">x</a> <a id="17298" class="Keyword">with</a> <a id="17303" class="Symbol">(</a><a id="17304" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="17312" class="Bound">d</a><a id="17313" class="Symbol">)</a>
<a id="17315" class="Symbol">...</a>             <a id="17331" class="Symbol">|</a> <a id="17333" href="/Soundness/#17333" class="Bound">d′</a> <a id="17336" class="Keyword">rewrite</a> <a id="17344" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="17348" class="Bound">eqL</a> <a id="17352" class="Symbol">=</a> <a id="17354" href="/Soundness/#14246" class="Function">subst-reflect-var</a> <a id="17372" class="Symbol">{</a><a id="17373" class="Argument">σ</a> <a id="17375" class="Symbol">=</a> <a id="17377" class="Bound">σ</a><a id="17378" class="Symbol">}</a> <a id="17380" href="/Soundness/#17333" class="Bound">d′</a>
<a id="17383" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17397" class="Symbol">{</a><a id="17398" class="Argument">σ</a> <a id="17400" class="Symbol">=</a> <a id="17402" href="/Soundness/#17402" class="Bound">σ</a><a id="17403" class="Symbol">}</a> <a id="17405" class="Symbol">(</a><a id="17406" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="17414" href="/Soundness/#17414" class="Bound">d</a><a id="17415" class="Symbol">)</a> <a id="17417" href="/Soundness/#17417" class="Bound">eq</a> <a id="17420" class="Symbol">|</a> <a id="17422" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="17424" href="/Soundness/#17424" class="Bound">M′</a>
      <a id="17433" class="Keyword">with</a> <a id="17438" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17452" class="Symbol">{</a><a id="17453" class="Argument">σ</a> <a id="17455" class="Symbol">=</a> <a id="17457" href="/Untyped/#6623" class="Function">exts</a> <a id="17462" href="/Soundness/#17402" class="Bound">σ</a><a id="17463" class="Symbol">}</a> <a id="17465" href="/Soundness/#17414" class="Bound">d</a> <a id="17467" class="Symbol">(</a><a id="17468" href="/Soundness/#15470" class="Function">lambda-inj</a> <a id="17479" href="/Soundness/#17417" class="Bound">eq</a><a id="17481" class="Symbol">)</a>
<a id="17483" class="Symbol">...</a> <a id="17487" class="Symbol">|</a> <a id="17489" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17491" href="/Soundness/#17491" class="Bound">δ′</a> <a id="17494" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17496" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17498" href="/Soundness/#17498" class="Bound">exts-σ-δ′</a> <a id="17508" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17510" href="/Soundness/#17510" class="Bound">m′</a> <a id="17513" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17515" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17517" class="Symbol">=</a> 
    <a id="17524" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17526" href="/Denotational/#7660" class="Function">init</a> <a id="17531" href="/Soundness/#17491" class="Bound">δ′</a> <a id="17534" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17536" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17538" class="Symbol">((λ</a> <a id="17542" href="/Soundness/#17542" class="Bound">x</a> <a id="17544" class="Symbol">→</a> <a id="17546" href="/Soundness/#11384" class="Function">rename-inc-reflect</a> <a id="17565" class="Symbol">(</a><a id="17566" href="/Soundness/#17498" class="Bound">exts-σ-δ′</a> <a id="17576" class="Symbol">(</a><a id="17577" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="17579" href="/Soundness/#17542" class="Bound">x</a><a id="17580" class="Symbol">))))</a> <a id="17585" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
             <a id="17600" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="17608" class="Symbol">(</a><a id="17609" href="/Denotational/#25757" class="Function">up-env</a> <a id="17616" class="Symbol">(</a><a id="17617" href="/Soundness/#16022" class="Function">split</a> <a id="17623" href="/Soundness/#17510" class="Bound">m′</a><a id="17625" class="Symbol">)</a> <a id="17627" class="Symbol">(</a><a id="17628" href="/Compositional/#9536" class="Function">var-inv</a> <a id="17636" class="Symbol">(</a><a id="17637" href="/Soundness/#17498" class="Bound">exts-σ-δ′</a> <a id="17647" href="/Untyped/#3401" class="InductiveConstructor">Z</a><a id="17648" class="Symbol">)))</a> <a id="17652" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17654" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="17656" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17670" class="Symbol">(</a><a id="17671" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="17679" href="/Soundness/#17679" class="Bound">d</a><a id="17680" class="Symbol">)</a> <a id="17682" class="Symbol">()</a> <a id="17685" class="Symbol">|</a> <a id="17687" href="/Soundness/#17687" class="Bound">M₁</a> <a id="17690" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="17692" href="/Soundness/#17692" class="Bound">M₂</a> 

<a id="17697" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17711" class="Symbol">{</a><a id="17712" class="Argument">σ</a> <a id="17714" class="Symbol">=</a> <a id="17716" href="/Soundness/#17716" class="Bound">σ</a><a id="17717" class="Symbol">}</a> <a id="17719" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="17727" href="/Soundness/#17727" class="Bound">eq</a> <a id="17730" class="Symbol">=</a>
    <a id="17736" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17738" href="/Denotational/#8479" class="Function">`⊥</a> <a id="17741" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17743" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17745" href="/Soundness/#14901" class="Function">subst-⊥</a> <a id="17753" class="Symbol">{</a><a id="17754" class="Argument">σ</a> <a id="17756" class="Symbol">=</a> <a id="17758" href="/Soundness/#17716" class="Bound">σ</a><a id="17759" class="Symbol">}</a> <a id="17761" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17763" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="17771" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17773" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>

<a id="17776" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17790" class="Symbol">{</a><a id="17791" class="Argument">σ</a> <a id="17793" class="Symbol">=</a> <a id="17795" href="/Soundness/#17795" class="Bound">σ</a><a id="17796" class="Symbol">}</a> <a id="17798" class="Symbol">(</a><a id="17799" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="17807" href="/Soundness/#17807" class="Bound">d₁</a> <a id="17810" href="/Soundness/#17810" class="Bound">d₂</a><a id="17812" class="Symbol">)</a> <a id="17814" href="/Soundness/#17814" class="Bound">eq</a>
  <a id="17819" class="Keyword">with</a> <a id="17824" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17838" class="Symbol">{</a><a id="17839" class="Argument">σ</a> <a id="17841" class="Symbol">=</a> <a id="17843" href="/Soundness/#17795" class="Bound">σ</a><a id="17844" class="Symbol">}</a> <a id="17846" href="/Soundness/#17807" class="Bound">d₁</a> <a id="17849" href="/Soundness/#17814" class="Bound">eq</a> <a id="17852" class="Symbol">|</a> <a id="17854" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="17868" class="Symbol">{</a><a id="17869" class="Argument">σ</a> <a id="17871" class="Symbol">=</a> <a id="17873" href="/Soundness/#17795" class="Bound">σ</a><a id="17874" class="Symbol">}</a> <a id="17876" href="/Soundness/#17810" class="Bound">d₂</a> <a id="17879" href="/Soundness/#17814" class="Bound">eq</a>
<a id="17882" class="Symbol">...</a> <a id="17886" class="Symbol">|</a> <a id="17888" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17890" href="/Soundness/#17890" class="Bound">δ₁</a> <a id="17893" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17895" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17897" href="/Soundness/#17897" class="Bound">subst-δ₁</a> <a id="17906" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17908" href="/Soundness/#17908" class="Bound">m1</a> <a id="17911" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17913" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17915" class="Symbol">|</a> <a id="17917" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17919" href="/Soundness/#17919" class="Bound">δ₂</a> <a id="17922" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17924" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17926" href="/Soundness/#17926" class="Bound">subst-δ₂</a> <a id="17935" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17937" href="/Soundness/#17937" class="Bound">m2</a> <a id="17940" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17942" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="17944" class="Symbol">=</a>
     <a id="17951" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17953" href="/Soundness/#17890" class="Bound">δ₁</a> <a id="17956" href="/Denotational/#8508" class="Function Operator">`⊔</a> <a id="17959" href="/Soundness/#17919" class="Bound">δ₂</a> <a id="17962" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="17964" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="17966" href="/Soundness/#15172" class="Function">subst-⊔</a> <a id="17974" class="Symbol">{</a><a id="17975" class="Argument">γ₁</a> <a id="17978" class="Symbol">=</a> <a id="17980" href="/Soundness/#17890" class="Bound">δ₁</a><a id="17982" class="Symbol">}{</a><a id="17984" class="Argument">γ₂</a> <a id="17987" class="Symbol">=</a> <a id="17989" href="/Soundness/#17919" class="Bound">δ₂</a><a id="17991" class="Symbol">}{</a><a id="17993" class="Argument">σ</a> <a id="17995" class="Symbol">=</a> <a id="17997" class="Bound">σ</a><a id="17998" class="Symbol">}</a> <a id="18000" href="/Soundness/#17897" class="Bound">subst-δ₁</a> <a id="18009" href="/Soundness/#17926" class="Bound">subst-δ₂</a> <a id="18018" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a>
                    <a id="18040" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="18048" class="Symbol">(</a><a id="18049" href="/Denotational/#25313" class="Function">Env⊑</a> <a id="18054" href="/Soundness/#17908" class="Bound">m1</a> <a id="18057" class="Symbol">(</a><a id="18058" href="/Denotational/#8846" class="Function">EnvConjR1⊑</a> <a id="18069" href="/Soundness/#17890" class="Bound">δ₁</a> <a id="18072" href="/Soundness/#17919" class="Bound">δ₂</a><a id="18074" class="Symbol">))</a>
                            <a id="18105" class="Symbol">(</a><a id="18106" href="/Denotational/#25313" class="Function">Env⊑</a> <a id="18111" href="/Soundness/#17937" class="Bound">m2</a> <a id="18114" class="Symbol">(</a><a id="18115" href="/Denotational/#8943" class="Function">EnvConjR2⊑</a> <a id="18126" href="/Soundness/#17890" class="Bound">δ₁</a> <a id="18129" href="/Soundness/#17919" class="Bound">δ₂</a><a id="18131" class="Symbol">))</a> <a id="18134" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18136" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="18138" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="18152" class="Symbol">(</a><a id="18153" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="18157" href="/Soundness/#18157" class="Bound">d</a> <a id="18159" href="/Soundness/#18159" class="Bound">lt</a><a id="18161" class="Symbol">)</a> <a id="18163" href="/Soundness/#18163" class="Bound">eq</a> 
    <a id="18171" class="Keyword">with</a> <a id="18176" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="18190" href="/Soundness/#18157" class="Bound">d</a> <a id="18192" href="/Soundness/#18163" class="Bound">eq</a>
<a id="18195" class="Symbol">...</a> <a id="18199" class="Symbol">|</a> <a id="18201" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18203" href="/Soundness/#18203" class="Bound">δ</a> <a id="18205" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18207" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18209" href="/Soundness/#18209" class="Bound">subst-δ</a> <a id="18217" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18219" href="/Soundness/#18219" class="Bound">m</a> <a id="18221" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18223" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18225" class="Symbol">=</a> <a id="18227" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18229" href="/Soundness/#18203" class="Bound">δ</a> <a id="18231" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18233" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="18235" href="/Soundness/#18209" class="Bound">subst-δ</a> <a id="18243" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="18245" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="18249" href="/Soundness/#18219" class="Bound">m</a> <a id="18251" class="Bound">lt</a> <a id="18254" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="18256" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<ul>
  <li>
    <p>Case <code class="highlighter-rouge">var</code>: We have subst <code class="highlighter-rouge">σ M ≡ y</code>, so <code class="highlighter-rouge">M</code> must also be a variable, say <code class="highlighter-rouge">x</code>.
We apply the lemma <code class="highlighter-rouge">subst-reflect-var</code> to conclude.</p>
  </li>
  <li>Case <code class="highlighter-rouge">↦-elim</code>: We have <code class="highlighter-rouge">subst σ M ≡ L₁ · L₂</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma again to conclude.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ M₁ · M₂</code>: By the induction hypothesis, we have
some <code class="highlighter-rouge">δ₁</code> and <code class="highlighter-rouge">δ₂</code> such that <code class="highlighter-rouge">δ₁ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁</code>,
as well as <code class="highlighter-rouge">δ₂ ⊢ M₂ ↓ v₁</code> and <code class="highlighter-rouge">γ ⊢ σ ↓ δ₂</code>.
By <code class="highlighter-rouge">Env⊑</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ ↓ v₁ ↦ v₃</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₂ ↓ v₁</code>
(using <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>), and therefore
<code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M₁ · M₂ ↓ v₃</code>.
We conclude this case by obtaining <code class="highlighter-rouge">γ ⊢ σ ↓ δ₁ ⊔ δ₂</code>
by the <code class="highlighter-rouge">subst-⊔</code> lemma.</p>
      </li>
    </ul>
  </li>
  <li>Case <code class="highlighter-rouge">↦-intro</code>: We have <code class="highlighter-rouge">subst σ M ≡ ƛ L′</code>. We proceed by cases on <code class="highlighter-rouge">M</code>.
    <ul>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ x</code>: We apply the <code class="highlighter-rouge">subst-reflect-var</code> lemma.</p>
      </li>
      <li>
        <p>Case <code class="highlighter-rouge">M ≡ ƛ M′</code>: By the induction hypothesis, we have
<code class="highlighter-rouge">(δ′ , v′) ⊢ M′ ↓ v₂</code> and <code class="highlighter-rouge">(δ , v₁) ⊢ exts σ ↓ (δ′ , v′)</code>.
From the later we have <code class="highlighter-rouge">(δ , v₁) ⊢ # 0 ↓ v′</code>.
By the lemma <code class="highlighter-rouge">var-inv</code> we have <code class="highlighter-rouge">v′ ⊑ v₁</code>, so by the <code class="highlighter-rouge">up-env</code> lemma we
have <code class="highlighter-rouge">(δ′ , v₁) ⊢ M′ ↓ v₂</code> and therefore <code class="highlighter-rouge">δ′ ⊢ ƛ M′ ↓ v₁ → v₂</code>.  We
also need to show that <code class="highlighter-rouge">δ </code>⊢ σ ↓ δ′<code class="highlighter-rouge">.  Fix </code>k<code class="highlighter-rouge">. We have
</code>(δ , v₁) ⊢ rename S_ σ k ↓ nth k δ′<code class="highlighter-rouge">.  We then apply the lemma
</code>rename-inc-reflect<code class="highlighter-rouge"> to obtain </code>δ ⊢ σ k ↓ nth k δ′`, so this case is
complete.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Case <code class="highlighter-rouge">⊥-intro</code>: We choose <code class="highlighter-rouge">⊥</code> for <code class="highlighter-rouge">δ</code>.
We have <code class="highlighter-rouge">⊥ ⊢ M ↓ ⊥</code> by <code class="highlighter-rouge">⊥-intro</code>.
We have <code class="highlighter-rouge">δ ⊢ σ ↓ ⊥</code> by the lemma <code class="highlighter-rouge">subst-empty</code>.</p>
  </li>
  <li>Case <code class="highlighter-rouge">⊔-intro</code>: By the induction hypothesis we have
<code class="highlighter-rouge">δ₁ ⊢ M ↓ v₁</code>, <code class="highlighter-rouge">δ₂ ⊢ M ↓ v₂</code>, <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁</code>, and <code class="highlighter-rouge">δ ⊢ σ ↓ δ₂</code>.
We have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁</code> and <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₂</code>
by <code class="highlighter-rouge">Env⊑</code> with <code class="highlighter-rouge">EnvConjR1⊑</code> and <code class="highlighter-rouge">EnvConjR2⊑</code>.
So by <code class="highlighter-rouge">⊔-intro</code> we have <code class="highlighter-rouge">δ₁ ⊔ δ₂ ⊢ M ↓ v₁ ⊔ v₂</code>.
By <code class="highlighter-rouge">subst-⊔</code> we conclude that <code class="highlighter-rouge">δ ⊢ σ ↓ δ₁ ⊔ δ₂</code>.</li>
</ul>

<h3 id="single-substitution-reflects-denotations">Single substitution reflects denotations</h3>

<p>Most of the work is now behind us. We have proved that simultaneous
substitution reflects denotations. Of course, β reduction uses single
substitution, so we need a corollary that proves that single
substitution reflects denotations. That is,
given terms <code class="highlighter-rouge">N : (Γ , ★ ⊢ ★)</code> and <code class="highlighter-rouge">M : (Γ ⊢ ★)</code>,
if <code class="highlighter-rouge">γ ⊢ N [ M ] ↓ w</code>, then <code class="highlighter-rouge">γ ⊢ M ↓ v</code> and <code class="highlighter-rouge">(γ , v) ⊢ N ↓ w</code>
for some value <code class="highlighter-rouge">v</code>. We have <code class="highlighter-rouge">N [ M ] = subst (subst-zero M) N</code>.</p>

<p>We first prove a lemma about <code class="highlighter-rouge">subst-zero</code>, that if
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code>, then
<code class="highlighter-rouge">γ ⊑ (δ , w) × δ ⊢ M ↓ w</code> for some <code class="highlighter-rouge">w</code>.</p>

<pre class="Agda"><a id="subst-zero-reflect"></a><a id="20699" href="/Soundness/#20699" class="Function">subst-zero-reflect</a> <a id="20718" class="Symbol">:</a> <a id="20720" class="Symbol">∀</a> <a id="20722" class="Symbol">{</a><a id="20723" href="/Soundness/#20723" class="Bound">Δ</a><a id="20724" class="Symbol">}</a> <a id="20726" class="Symbol">{</a><a id="20727" href="/Soundness/#20727" class="Bound">δ</a> <a id="20729" class="Symbol">:</a> <a id="20731" href="/Denotational/#7234" class="Function">Env</a> <a id="20735" href="/Soundness/#20723" class="Bound">Δ</a><a id="20736" class="Symbol">}</a> <a id="20738" class="Symbol">{</a><a id="20739" href="/Soundness/#20739" class="Bound">γ</a> <a id="20741" class="Symbol">:</a> <a id="20743" href="/Denotational/#7234" class="Function">Env</a> <a id="20747" class="Symbol">(</a><a id="20748" href="/Soundness/#20723" class="Bound">Δ</a> <a id="20750" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="20752" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="20753" class="Symbol">)}</a> <a id="20756" class="Symbol">{</a><a id="20757" href="/Soundness/#20757" class="Bound">M</a> <a id="20759" class="Symbol">:</a> <a id="20761" href="/Soundness/#20723" class="Bound">Δ</a> <a id="20763" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="20765" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="20766" class="Symbol">}</a>
  <a id="20770" class="Symbol">→</a> <a id="20772" href="/Soundness/#20727" class="Bound">δ</a> <a id="20774" href="/Soundness/#3274" class="Function Operator">`⊢</a> <a id="20777" href="/Untyped/#7359" class="Function">subst-zero</a> <a id="20788" href="/Soundness/#20757" class="Bound">M</a> <a id="20790" href="/Soundness/#3274" class="Function Operator">↓</a> <a id="20792" href="/Soundness/#20739" class="Bound">γ</a>
    <a id="20798" class="Comment">----------------------------------------</a>
  <a id="20841" class="Symbol">→</a> <a id="20843" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="20846" href="/Soundness/#20846" class="Bound">w</a> <a id="20848" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="20850" href="/Denotational/#4000" class="Datatype">Value</a> <a id="20856" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="20858" href="/Soundness/#20739" class="Bound">γ</a> <a id="20860" href="/Denotational/#8260" class="Function Operator">`⊑</a> <a id="20863" class="Symbol">(</a><a id="20864" href="/Soundness/#20727" class="Bound">δ</a> <a id="20866" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="20869" href="/Soundness/#20846" class="Bound">w</a><a id="20870" class="Symbol">)</a> <a id="20872" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a> <a id="20874" href="/Soundness/#20727" class="Bound">δ</a> <a id="20876" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="20878" href="/Soundness/#20757" class="Bound">M</a> <a id="20880" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="20882" href="/Soundness/#20846" class="Bound">w</a>
<a id="20884" href="/Soundness/#20699" class="Function">subst-zero-reflect</a> <a id="20903" class="Symbol">{</a><a id="20904" class="Argument">δ</a> <a id="20906" class="Symbol">=</a> <a id="20908" href="/Soundness/#20908" class="Bound">δ</a><a id="20909" class="Symbol">}</a> <a id="20911" class="Symbol">{</a><a id="20912" class="Argument">γ</a> <a id="20914" class="Symbol">=</a> <a id="20916" href="/Soundness/#20916" class="Bound">γ</a><a id="20917" class="Symbol">}</a> <a id="20919" href="/Soundness/#20919" class="Bound">δσγ</a> <a id="20923" class="Symbol">=</a> <a id="20925" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="20927" href="/Denotational/#7715" class="Function">last</a> <a id="20932" href="/Soundness/#20916" class="Bound">γ</a> <a id="20934" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="20936" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="20938" href="/Soundness/#20969" class="Function">lemma</a> <a id="20944" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="20946" href="/Soundness/#20919" class="Bound">δσγ</a> <a id="20950" href="/Untyped/#3401" class="InductiveConstructor">Z</a> <a id="20952" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="20954" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>   
  <a id="20961" class="Keyword">where</a>
  <a id="20969" href="/Soundness/#20969" class="Function">lemma</a> <a id="20975" class="Symbol">:</a> <a id="20977" href="/Soundness/#20916" class="Bound">γ</a> <a id="20979" href="/Denotational/#8260" class="Function Operator">`⊑</a> <a id="20982" class="Symbol">(</a><a id="20983" href="/Soundness/#20908" class="Bound">δ</a> <a id="20985" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="20988" href="/Denotational/#7715" class="Function">last</a> <a id="20993" href="/Soundness/#20916" class="Bound">γ</a><a id="20994" class="Symbol">)</a>
  <a id="20998" href="/Soundness/#20969" class="Function">lemma</a> <a id="21004" href="/Untyped/#3401" class="InductiveConstructor">Z</a>  <a id="21007" class="Symbol">=</a>  <a id="21010" href="/Denotational/#5541" class="Function">Refl⊑</a>
  <a id="21018" href="/Soundness/#20969" class="Function">lemma</a> <a id="21024" class="Symbol">(</a><a id="21025" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21027" href="/Soundness/#21027" class="Bound">x</a><a id="21028" class="Symbol">)</a> <a id="21030" class="Symbol">=</a> <a id="21032" href="/Compositional/#9536" class="Function">var-inv</a> <a id="21040" class="Symbol">(</a><a id="21041" href="/Soundness/#20919" class="Bound">δσγ</a> <a id="21045" class="Symbol">(</a><a id="21046" href="/Untyped/#3446" class="InductiveConstructor Operator">S</a> <a id="21048" href="/Soundness/#21027" class="Bound">x</a><a id="21049" class="Symbol">))</a></pre>

<p>We choose <code class="highlighter-rouge">w</code> to be the last value in <code class="highlighter-rouge">γ</code> and we obtain <code class="highlighter-rouge">δ ⊢ M ↓ w</code>
by applying the premise to variable <code class="highlighter-rouge">Z</code>. Finally, to prove
<code class="highlighter-rouge">γ ⊑ (δ , w)</code>, we prove a lemma by induction in the input variable.
The base case is trivial because of our choice of <code class="highlighter-rouge">w</code>.
In the induction case, <code class="highlighter-rouge">S x</code>, the premise
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> gives us <code class="highlighter-rouge">δ ⊢ x ↓ γ (S x)</code> and then
using <code class="highlighter-rouge">var-inv</code> we conclude that <code class="highlighter-rouge">γ (S x) ⊑ (δ </code>, w) (S x)`.</p>

<p>Now to prove that substitution reflects denotations.</p>

<pre class="Agda"><a id="substitution-reflect"></a><a id="21544" href="/Soundness/#21544" class="Function">substitution-reflect</a> <a id="21565" class="Symbol">:</a> <a id="21567" class="Symbol">∀</a> <a id="21569" class="Symbol">{</a><a id="21570" href="/Soundness/#21570" class="Bound">Δ</a><a id="21571" class="Symbol">}</a> <a id="21573" class="Symbol">{</a><a id="21574" href="/Soundness/#21574" class="Bound">δ</a> <a id="21576" class="Symbol">:</a> <a id="21578" href="/Denotational/#7234" class="Function">Env</a> <a id="21582" href="/Soundness/#21570" class="Bound">Δ</a><a id="21583" class="Symbol">}</a> <a id="21585" class="Symbol">{</a><a id="21586" href="/Soundness/#21586" class="Bound">N</a> <a id="21588" class="Symbol">:</a> <a id="21590" href="/Soundness/#21570" class="Bound">Δ</a> <a id="21592" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="21594" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="21596" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21598" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21599" class="Symbol">}</a> <a id="21601" class="Symbol">{</a><a id="21602" href="/Soundness/#21602" class="Bound">M</a> <a id="21604" class="Symbol">:</a> <a id="21606" href="/Soundness/#21570" class="Bound">Δ</a> <a id="21608" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="21610" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="21611" class="Symbol">}</a> <a id="21613" class="Symbol">{</a><a id="21614" href="/Soundness/#21614" class="Bound">v</a><a id="21615" class="Symbol">}</a>
  <a id="21619" class="Symbol">→</a> <a id="21621" href="/Soundness/#21574" class="Bound">δ</a> <a id="21623" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="21625" href="/Soundness/#21586" class="Bound">N</a> <a id="21627" href="/Untyped/#7475" class="Function Operator">[</a> <a id="21629" href="/Soundness/#21602" class="Bound">M</a> <a id="21631" href="/Untyped/#7475" class="Function Operator">]</a> <a id="21633" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="21635" href="/Soundness/#21614" class="Bound">v</a>
    <a id="21641" class="Comment">------------------------------------------------</a>
  <a id="21692" class="Symbol">→</a> <a id="21694" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">Σ[</a> <a id="21697" href="/Soundness/#21697" class="Bound">w</a> <a id="21699" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">∈</a> <a id="21701" href="/Denotational/#4000" class="Datatype">Value</a> <a id="21707" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#764" class="Function">]</a> <a id="21709" href="/Soundness/#21574" class="Bound">δ</a> <a id="21711" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="21713" href="/Soundness/#21602" class="Bound">M</a> <a id="21715" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="21717" href="/Soundness/#21697" class="Bound">w</a>  <a id="21720" href="https://agda.github.io/agda-stdlib/v0.17/Data.Product.html#1353" class="Function Operator">×</a>  <a id="21723" class="Symbol">(</a><a id="21724" href="/Soundness/#21574" class="Bound">δ</a> <a id="21726" href="/Denotational/#7407" class="Function Operator">`,</a> <a id="21729" href="/Soundness/#21697" class="Bound">w</a><a id="21730" class="Symbol">)</a> <a id="21732" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="21734" href="/Soundness/#21586" class="Bound">N</a> <a id="21736" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="21738" href="/Soundness/#21614" class="Bound">v</a>
<a id="21740" href="/Soundness/#21544" class="Function">substitution-reflect</a> <a id="21761" href="/Soundness/#21761" class="Bound">d</a> <a id="21763" class="Keyword">with</a> <a id="21768" href="/Soundness/#16195" class="Function">subst-reflect</a> <a id="21782" href="/Soundness/#21761" class="Bound">d</a> <a id="21784" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a>
<a id="21789" class="Symbol">...</a>  <a id="21794" class="Symbol">|</a> <a id="21796" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21798" href="/Soundness/#21798" class="Bound">γ</a> <a id="21800" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21802" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21804" href="/Soundness/#21804" class="Bound">δσγ</a> <a id="21808" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21810" href="/Soundness/#21810" class="Bound">γNv</a> <a id="21814" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21816" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21818" class="Keyword">with</a> <a id="21823" href="/Soundness/#20699" class="Function">subst-zero-reflect</a> <a id="21842" href="/Soundness/#21804" class="Bound">δσγ</a>
<a id="21846" class="Symbol">...</a>    <a id="21853" class="Symbol">|</a> <a id="21855" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21857" href="/Soundness/#21857" class="Bound">w</a> <a id="21859" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21861" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21863" href="/Soundness/#21863" class="Bound">ineq</a> <a id="21868" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21870" href="/Soundness/#21870" class="Bound">δMw</a> <a id="21874" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21876" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21878" class="Symbol">=</a> <a id="21880" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21882" href="/Soundness/#21857" class="Bound">w</a> <a id="21884" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21886" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="21888" href="/Soundness/#21870" class="Bound">δMw</a> <a id="21892" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="21894" href="/Denotational/#25313" class="Function">Env⊑</a> <a id="21899" class="Bound">γNv</a> <a id="21903" href="/Soundness/#21863" class="Bound">ineq</a> <a id="21908" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="21910" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We apply the <code class="highlighter-rouge">subst-reflect</code> lemma to obtain
<code class="highlighter-rouge">δ ⊢ subst-zero M ↓ γ</code> and <code class="highlighter-rouge">γ ⊢ N ↓ v</code> for some <code class="highlighter-rouge">γ</code>.
Using the former, the <code class="highlighter-rouge">subst-zero-reflect</code> lemma gives
us <code class="highlighter-rouge">γ ⊑ (δ , w)</code> and <code class="highlighter-rouge">δ ⊢ M ↓ w</code>. We conclude that
<code class="highlighter-rouge">δ , w ⊢ N ↓ v</code> by applying the <code class="highlighter-rouge">Env⊑</code> lemma, using
<code class="highlighter-rouge">γ ⊢ N ↓ v</code> and <code class="highlighter-rouge">γ ⊑ (δ , w)</code>.</p>

<h3 id="reduction-reflects-denotations-1">Reduction reflects denotations</h3>

<p>Now that we have proved that substitution reflects denotations, we can
easily prove that reduction does too.</p>

<pre class="Agda"><a id="reflect-beta"></a><a id="22372" href="/Soundness/#22372" class="Function">reflect-beta</a> <a id="22385" class="Symbol">:</a> <a id="22387" class="Symbol">∀{</a><a id="22389" href="/Soundness/#22389" class="Bound">Γ</a><a id="22390" class="Symbol">}{</a><a id="22392" href="/Soundness/#22392" class="Bound">γ</a> <a id="22394" class="Symbol">:</a> <a id="22396" href="/Denotational/#7234" class="Function">Env</a> <a id="22400" href="/Soundness/#22389" class="Bound">Γ</a><a id="22401" class="Symbol">}{</a><a id="22403" href="/Soundness/#22403" class="Bound">M</a> <a id="22405" href="/Soundness/#22405" class="Bound">N</a><a id="22406" class="Symbol">}{</a><a id="22408" href="/Soundness/#22408" class="Bound">v</a><a id="22409" class="Symbol">}</a>
    <a id="22415" class="Symbol">→</a> <a id="22417" href="/Soundness/#22392" class="Bound">γ</a> <a id="22419" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="22421" class="Symbol">(</a><a id="22422" href="/Soundness/#22405" class="Bound">N</a> <a id="22424" href="/Untyped/#7475" class="Function Operator">[</a> <a id="22426" href="/Soundness/#22403" class="Bound">M</a> <a id="22428" href="/Untyped/#7475" class="Function Operator">]</a><a id="22429" class="Symbol">)</a> <a id="22431" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="22433" href="/Soundness/#22408" class="Bound">v</a>
    <a id="22439" class="Symbol">→</a> <a id="22441" href="/Soundness/#22392" class="Bound">γ</a> <a id="22443" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="22445" class="Symbol">(</a><a id="22446" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="22448" href="/Soundness/#22405" class="Bound">N</a><a id="22449" class="Symbol">)</a> <a id="22451" href="/Untyped/#4298" class="InductiveConstructor Operator">·</a> <a id="22453" href="/Soundness/#22403" class="Bound">M</a> <a id="22455" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="22457" href="/Soundness/#22408" class="Bound">v</a>
<a id="22459" href="/Soundness/#22372" class="Function">reflect-beta</a> <a id="22472" href="/Soundness/#22472" class="Bound">d</a> 
    <a id="22479" class="Keyword">with</a> <a id="22484" href="/Soundness/#21544" class="Function">substitution-reflect</a> <a id="22505" href="/Soundness/#22472" class="Bound">d</a>
<a id="22507" class="Symbol">...</a> <a id="22511" class="Symbol">|</a> <a id="22513" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22515" href="/Soundness/#22515" class="Bound">v₂′</a> <a id="22519" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22521" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="22523" href="/Soundness/#22523" class="Bound">d₁′</a> <a id="22527" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="22529" href="/Soundness/#22529" class="Bound">d₂′</a> <a id="22533" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22535" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a> <a id="22537" class="Symbol">=</a> <a id="22539" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="22546" class="Symbol">(</a><a id="22547" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="22555" href="/Soundness/#22529" class="Bound">d₂′</a><a id="22558" class="Symbol">)</a> <a id="22560" href="/Soundness/#22523" class="Bound">d₁′</a> 


<a id="reflect"></a><a id="22567" href="/Soundness/#22567" class="Function">reflect</a> <a id="22575" class="Symbol">:</a> <a id="22577" class="Symbol">∀</a> <a id="22579" class="Symbol">{</a><a id="22580" href="/Soundness/#22580" class="Bound">Γ</a><a id="22581" class="Symbol">}</a> <a id="22583" class="Symbol">{</a><a id="22584" href="/Soundness/#22584" class="Bound">γ</a> <a id="22586" class="Symbol">:</a> <a id="22588" href="/Denotational/#7234" class="Function">Env</a> <a id="22592" href="/Soundness/#22580" class="Bound">Γ</a><a id="22593" class="Symbol">}</a> <a id="22595" class="Symbol">{</a><a id="22596" href="/Soundness/#22596" class="Bound">M</a> <a id="22598" href="/Soundness/#22598" class="Bound">M′</a> <a id="22601" href="/Soundness/#22601" class="Bound">N</a> <a id="22603" href="/Soundness/#22603" class="Bound">v</a><a id="22604" class="Symbol">}</a>
  <a id="22608" class="Symbol">→</a> <a id="22610" href="/Soundness/#22584" class="Bound">γ</a> <a id="22612" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="22614" href="/Soundness/#22601" class="Bound">N</a> <a id="22616" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="22618" href="/Soundness/#22603" class="Bound">v</a>  <a id="22621" class="Symbol">→</a>  <a id="22624" href="/Soundness/#22596" class="Bound">M</a> <a id="22626" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="22629" href="/Soundness/#22598" class="Bound">M′</a>  <a id="22633" class="Symbol">→</a>   <a id="22637" href="/Soundness/#22598" class="Bound">M′</a> <a id="22640" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#83" class="Datatype Operator">≡</a> <a id="22642" href="/Soundness/#22601" class="Bound">N</a>
    <a id="22648" class="Comment">---------------------------------</a>
  <a id="22684" class="Symbol">→</a> <a id="22686" href="/Soundness/#22584" class="Bound">γ</a> <a id="22688" href="/Denotational/#9520" class="Datatype Operator">⊢</a> <a id="22690" href="/Soundness/#22596" class="Bound">M</a> <a id="22692" href="/Denotational/#9520" class="Datatype Operator">↓</a> <a id="22694" href="/Soundness/#22603" class="Bound">v</a>
<a id="22696" href="/Soundness/#22567" class="Function">reflect</a> <a id="22704" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="22708" class="Symbol">(</a><a id="22709" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="22712" href="/Soundness/#22712" class="Bound">r</a><a id="22713" class="Symbol">)</a> <a id="22715" class="Symbol">()</a>
<a id="22718" href="/Soundness/#22567" class="Function">reflect</a> <a id="22726" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="22730" class="Symbol">(</a><a id="22731" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="22734" href="/Soundness/#22734" class="Bound">r</a><a id="22735" class="Symbol">)</a> <a id="22737" class="Symbol">()</a>
<a id="22740" href="/Soundness/#22567" class="Function">reflect</a><a id="22747" class="Symbol">{</a><a id="22748" class="Argument">γ</a> <a id="22750" class="Symbol">=</a> <a id="22752" href="/Soundness/#22752" class="Bound">γ</a><a id="22753" class="Symbol">}</a> <a id="22755" class="Symbol">(</a><a id="22756" href="/Denotational/#9574" class="InductiveConstructor">var</a><a id="22759" class="Symbol">{</a><a id="22760" class="Argument">x</a> <a id="22762" class="Symbol">=</a> <a id="22764" href="/Soundness/#22764" class="Bound">x</a><a id="22765" class="Symbol">})</a> <a id="22768" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="22770" href="/Soundness/#22770" class="Bound">mn</a>
    <a id="22777" class="Keyword">with</a> <a id="22782" href="/Denotational/#9574" class="InductiveConstructor">var</a><a id="22785" class="Symbol">{</a><a id="22786" class="Argument">γ</a> <a id="22788" class="Symbol">=</a> <a id="22790" href="/Soundness/#22752" class="Bound">γ</a><a id="22791" class="Symbol">}{</a><a id="22793" class="Argument">x</a> <a id="22795" class="Symbol">=</a> <a id="22797" href="/Soundness/#22764" class="Bound">x</a><a id="22798" class="Symbol">}</a>
<a id="22800" class="Symbol">...</a> <a id="22804" class="Symbol">|</a> <a id="22806" href="/Soundness/#22806" class="Bound">d′</a> <a id="22809" class="Keyword">rewrite</a> <a id="22817" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="22821" class="Bound">mn</a> <a id="22824" class="Symbol">=</a> <a id="22826" href="/Soundness/#22372" class="Function">reflect-beta</a> <a id="22839" href="/Soundness/#22806" class="Bound">d′</a> 
<a id="22843" href="/Soundness/#22567" class="Function">reflect</a> <a id="22851" href="/Denotational/#9574" class="InductiveConstructor">var</a> <a id="22855" class="Symbol">(</a><a id="22856" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="22858" href="/Soundness/#22858" class="Bound">r</a><a id="22859" class="Symbol">)</a> <a id="22861" class="Symbol">()</a>
<a id="22864" href="/Soundness/#22567" class="Function">reflect</a> <a id="22872" class="Symbol">(</a><a id="22873" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="22880" href="/Soundness/#22880" class="Bound">d₁</a> <a id="22883" href="/Soundness/#22883" class="Bound">d₂</a><a id="22885" class="Symbol">)</a> <a id="22887" class="Symbol">(</a><a id="22888" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="22891" href="/Soundness/#22891" class="Bound">r</a><a id="22892" class="Symbol">)</a> <a id="22894" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22899" class="Symbol">=</a> <a id="22901" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="22908" class="Symbol">(</a><a id="22909" href="/Soundness/#22567" class="Function">reflect</a> <a id="22917" href="/Soundness/#22880" class="Bound">d₁</a> <a id="22920" href="/Soundness/#22891" class="Bound">r</a> <a id="22922" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="22926" class="Symbol">)</a> <a id="22928" href="/Soundness/#22883" class="Bound">d₂</a> 
<a id="22932" href="/Soundness/#22567" class="Function">reflect</a> <a id="22940" class="Symbol">(</a><a id="22941" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="22948" href="/Soundness/#22948" class="Bound">d₁</a> <a id="22951" href="/Soundness/#22951" class="Bound">d₂</a><a id="22953" class="Symbol">)</a> <a id="22955" class="Symbol">(</a><a id="22956" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="22959" href="/Soundness/#22959" class="Bound">r</a><a id="22960" class="Symbol">)</a> <a id="22962" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="22967" class="Symbol">=</a> <a id="22969" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="22976" href="/Soundness/#22948" class="Bound">d₁</a> <a id="22979" class="Symbol">(</a><a id="22980" href="/Soundness/#22567" class="Function">reflect</a> <a id="22988" href="/Soundness/#22951" class="Bound">d₂</a> <a id="22991" href="/Soundness/#22959" class="Bound">r</a> <a id="22993" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="22997" class="Symbol">)</a> 
<a id="23000" href="/Soundness/#22567" class="Function">reflect</a> <a id="23008" class="Symbol">(</a><a id="23009" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="23016" href="/Soundness/#23016" class="Bound">d₁</a> <a id="23019" href="/Soundness/#23019" class="Bound">d₂</a><a id="23021" class="Symbol">)</a> <a id="23023" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23025" href="/Soundness/#23025" class="Bound">mn</a>
    <a id="23032" class="Keyword">with</a> <a id="23037" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="23044" href="/Soundness/#23016" class="Bound">d₁</a> <a id="23047" href="/Soundness/#23019" class="Bound">d₂</a>
<a id="23050" class="Symbol">...</a> <a id="23054" class="Symbol">|</a> <a id="23056" href="/Soundness/#23056" class="Bound">d′</a> <a id="23059" class="Keyword">rewrite</a> <a id="23067" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23071" class="Bound">mn</a> <a id="23074" class="Symbol">=</a> <a id="23076" href="/Soundness/#22372" class="Function">reflect-beta</a> <a id="23089" href="/Soundness/#23056" class="Bound">d′</a>
<a id="23092" href="/Soundness/#22567" class="Function">reflect</a> <a id="23100" class="Symbol">(</a><a id="23101" href="/Denotational/#9653" class="InductiveConstructor">↦-elim</a> <a id="23108" href="/Soundness/#23108" class="Bound">d₁</a> <a id="23111" href="/Soundness/#23111" class="Bound">d₂</a><a id="23113" class="Symbol">)</a> <a id="23115" class="Symbol">(</a><a id="23116" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23118" href="/Soundness/#23118" class="Bound">r</a><a id="23119" class="Symbol">)</a> <a id="23121" class="Symbol">()</a>
<a id="23124" href="/Soundness/#22567" class="Function">reflect</a> <a id="23132" class="Symbol">(</a><a id="23133" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="23141" href="/Soundness/#23141" class="Bound">d</a><a id="23142" class="Symbol">)</a> <a id="23144" class="Symbol">(</a><a id="23145" href="/LambdaReduction/#436" class="InductiveConstructor">ξ₁</a> <a id="23148" href="/Soundness/#23148" class="Bound">r</a><a id="23149" class="Symbol">)</a> <a id="23151" class="Symbol">()</a>
<a id="23154" href="/Soundness/#22567" class="Function">reflect</a> <a id="23162" class="Symbol">(</a><a id="23163" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="23171" href="/Soundness/#23171" class="Bound">d</a><a id="23172" class="Symbol">)</a> <a id="23174" class="Symbol">(</a><a id="23175" href="/LambdaReduction/#526" class="InductiveConstructor">ξ₂</a> <a id="23178" href="/Soundness/#23178" class="Bound">r</a><a id="23179" class="Symbol">)</a> <a id="23181" class="Symbol">()</a>
<a id="23184" href="/Soundness/#22567" class="Function">reflect</a> <a id="23192" class="Symbol">(</a><a id="23193" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="23201" href="/Soundness/#23201" class="Bound">d</a><a id="23202" class="Symbol">)</a> <a id="23204" href="/LambdaReduction/#616" class="InductiveConstructor">β</a> <a id="23206" href="/Soundness/#23206" class="Bound">mn</a>
    <a id="23213" class="Keyword">with</a> <a id="23218" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="23226" href="/Soundness/#23201" class="Bound">d</a>
<a id="23228" class="Symbol">...</a> <a id="23232" class="Symbol">|</a> <a id="23234" href="/Soundness/#23234" class="Bound">d′</a> <a id="23237" class="Keyword">rewrite</a> <a id="23245" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23249" class="Bound">mn</a> <a id="23252" class="Symbol">=</a> <a id="23254" href="/Soundness/#22372" class="Function">reflect-beta</a> <a id="23267" href="/Soundness/#23234" class="Bound">d′</a>
<a id="23270" href="/Soundness/#22567" class="Function">reflect</a> <a id="23278" class="Symbol">(</a><a id="23279" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="23287" href="/Soundness/#23287" class="Bound">d</a><a id="23288" class="Symbol">)</a> <a id="23290" class="Symbol">(</a><a id="23291" href="/LambdaReduction/#724" class="InductiveConstructor">ζ</a> <a id="23293" href="/Soundness/#23293" class="Bound">r</a><a id="23294" class="Symbol">)</a> <a id="23296" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a> <a id="23301" class="Symbol">=</a> <a id="23303" href="/Denotational/#9791" class="InductiveConstructor">↦-intro</a> <a id="23311" class="Symbol">(</a><a id="23312" href="/Soundness/#22567" class="Function">reflect</a> <a id="23320" href="/Soundness/#23287" class="Bound">d</a> <a id="23322" href="/Soundness/#23293" class="Bound">r</a> <a id="23324" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23328" class="Symbol">)</a>
<a id="23330" href="/Soundness/#22567" class="Function">reflect</a> <a id="23338" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a> <a id="23346" href="/Soundness/#23346" class="Bound">r</a> <a id="23348" href="/Soundness/#23348" class="Bound">mn</a> <a id="23351" class="Symbol">=</a> <a id="23353" href="/Denotational/#9915" class="InductiveConstructor">⊥-intro</a>
<a id="23361" href="/Soundness/#22567" class="Function">reflect</a> <a id="23369" class="Symbol">(</a><a id="23370" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="23378" href="/Soundness/#23378" class="Bound">d₁</a> <a id="23381" href="/Soundness/#23381" class="Bound">d₂</a><a id="23383" class="Symbol">)</a> <a id="23385" href="/Soundness/#23385" class="Bound">r</a> <a id="23387" href="/Soundness/#23387" class="Bound">mn</a> <a id="23390" class="Keyword">rewrite</a> <a id="23398" href="https://agda.github.io/agda-stdlib/v0.17/Relation.Binary.PropositionalEquality.Core.html#838" class="Function">sym</a> <a id="23402" href="/Soundness/#23387" class="Bound">mn</a> <a id="23405" class="Symbol">=</a>
   <a id="23410" href="/Denotational/#9990" class="InductiveConstructor">⊔-intro</a> <a id="23418" class="Symbol">(</a><a id="23419" href="/Soundness/#22567" class="Function">reflect</a> <a id="23427" href="/Soundness/#23378" class="Bound">d₁</a> <a id="23430" href="/Soundness/#23385" class="Bound">r</a> <a id="23432" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23436" class="Symbol">)</a> <a id="23438" class="Symbol">(</a><a id="23439" href="/Soundness/#22567" class="Function">reflect</a> <a id="23447" href="/Soundness/#23381" class="Bound">d₂</a> <a id="23450" href="/Soundness/#23385" class="Bound">r</a> <a id="23452" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23456" class="Symbol">)</a>
<a id="23458" href="/Soundness/#22567" class="Function">reflect</a> <a id="23466" class="Symbol">(</a><a id="23467" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="23471" href="/Soundness/#23471" class="Bound">d</a> <a id="23473" href="/Soundness/#23473" class="Bound">lt</a><a id="23475" class="Symbol">)</a> <a id="23477" href="/Soundness/#23477" class="Bound">r</a> <a id="23479" href="/Soundness/#23479" class="Bound">mn</a> <a id="23482" class="Symbol">=</a> <a id="23484" href="/Denotational/#10126" class="InductiveConstructor">sub</a> <a id="23488" class="Symbol">(</a><a id="23489" href="/Soundness/#22567" class="Function">reflect</a> <a id="23497" href="/Soundness/#23471" class="Bound">d</a> <a id="23499" href="/Soundness/#23477" class="Bound">r</a> <a id="23501" href="/Soundness/#23479" class="Bound">mn</a><a id="23503" class="Symbol">)</a> <a id="23505" href="/Soundness/#23473" class="Bound">lt</a></pre>

<h2 id="reduction-implies-denotational-equality">Reduction implies denotational equality</h2>

<p>We have proved that reduction both preserves and reflects
denotations. Thus, reduction implies denotational equality.</p>

<pre class="Agda"><a id="reduce-equal"></a><a id="23697" href="/Soundness/#23697" class="Function">reduce-equal</a> <a id="23710" class="Symbol">:</a> <a id="23712" class="Symbol">∀</a> <a id="23714" class="Symbol">{</a><a id="23715" href="/Soundness/#23715" class="Bound">Γ</a><a id="23716" class="Symbol">}</a> <a id="23718" class="Symbol">{</a><a id="23719" href="/Soundness/#23719" class="Bound">M</a> <a id="23721" class="Symbol">:</a> <a id="23723" href="/Soundness/#23715" class="Bound">Γ</a> <a id="23725" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23727" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23728" class="Symbol">}</a> <a id="23730" class="Symbol">{</a><a id="23731" href="/Soundness/#23731" class="Bound">N</a> <a id="23733" class="Symbol">:</a> <a id="23735" href="/Soundness/#23715" class="Bound">Γ</a> <a id="23737" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="23739" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="23740" class="Symbol">}</a>
  <a id="23744" class="Symbol">→</a> <a id="23746" href="/Soundness/#23719" class="Bound">M</a> <a id="23748" href="/LambdaReduction/#386" class="Datatype Operator">—→</a> <a id="23751" href="/Soundness/#23731" class="Bound">N</a>
    <a id="23757" class="Comment">---------</a>
  <a id="23769" class="Symbol">→</a> <a id="23771" href="/Denotational/#17998" class="Function">ℰ</a> <a id="23773" href="/Soundness/#23719" class="Bound">M</a> <a id="23775" href="/Denotational/#18196" class="Function Operator">≃</a> <a id="23777" href="/Denotational/#17998" class="Function">ℰ</a> <a id="23779" href="/Soundness/#23731" class="Bound">N</a>
<a id="23781" href="/Soundness/#23697" class="Function">reduce-equal</a> <a id="23794" class="Symbol">{</a><a id="23795" href="/Soundness/#23795" class="Bound">Γ</a><a id="23796" class="Symbol">}{</a><a id="23798" href="/Soundness/#23798" class="Bound">M</a><a id="23799" class="Symbol">}{</a><a id="23801" href="/Soundness/#23801" class="Bound">N</a><a id="23802" class="Symbol">}</a> <a id="23804" href="/Soundness/#23804" class="Bound">r</a> <a id="23806" href="/Soundness/#23806" class="Bound">γ</a> <a id="23808" href="/Soundness/#23808" class="Bound">v</a> <a id="23810" class="Symbol">=</a>
    <a id="23816" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="23818" class="Symbol">(λ</a> <a id="23821" href="/Soundness/#23821" class="Bound">m</a> <a id="23823" class="Symbol">→</a> <a id="23825" href="/Soundness/#6785" class="Function">preserve</a> <a id="23834" href="/Soundness/#23821" class="Bound">m</a> <a id="23836" href="/Soundness/#23804" class="Bound">r</a><a id="23837" class="Symbol">)</a> <a id="23839" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="23841" class="Symbol">(λ</a> <a id="23844" href="/Soundness/#23844" class="Bound">n</a> <a id="23846" class="Symbol">→</a> <a id="23848" href="/Soundness/#22567" class="Function">reflect</a> <a id="23856" href="/Soundness/#23844" class="Bound">n</a> <a id="23858" href="/Soundness/#23804" class="Bound">r</a> <a id="23860" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Equality.html#140" class="InductiveConstructor">refl</a><a id="23864" class="Symbol">)</a> <a id="23866" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a></pre>

<p>We conclude with the <em>soundness property</em>, that multi-step reduction
to a lambda abstraction implies denotational equivalence with a lambda
abstraction.</p>

<pre class="Agda"><a id="soundness"></a><a id="24047" href="/Soundness/#24047" class="Function">soundness</a> <a id="24057" class="Symbol">:</a> <a id="24059" class="Symbol">∀{</a><a id="24061" href="/Soundness/#24061" class="Bound">Γ</a><a id="24062" class="Symbol">}</a> <a id="24064" class="Symbol">{</a><a id="24065" href="/Soundness/#24065" class="Bound">M</a> <a id="24067" class="Symbol">:</a> <a id="24069" href="/Soundness/#24061" class="Bound">Γ</a> <a id="24071" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24073" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24074" class="Symbol">}</a> <a id="24076" class="Symbol">{</a><a id="24077" href="/Soundness/#24077" class="Bound">N</a> <a id="24079" class="Symbol">:</a> <a id="24081" href="/Soundness/#24061" class="Bound">Γ</a> <a id="24083" href="/Untyped/#3018" class="InductiveConstructor Operator">,</a> <a id="24085" href="/Untyped/#2694" class="InductiveConstructor">★</a> <a id="24087" href="/Untyped/#4150" class="Datatype Operator">⊢</a> <a id="24089" href="/Untyped/#2694" class="InductiveConstructor">★</a><a id="24090" class="Symbol">}</a>
  <a id="24094" class="Symbol">→</a> <a id="24096" href="/Soundness/#24065" class="Bound">M</a> <a id="24098" href="/LambdaReduction/#894" class="Datatype Operator">—↠</a> <a id="24101" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24103" href="/Soundness/#24077" class="Bound">N</a>
    <a id="24109" class="Comment">-----------------</a>
  <a id="24129" class="Symbol">→</a> <a id="24131" href="/Denotational/#17998" class="Function">ℰ</a> <a id="24133" href="/Soundness/#24065" class="Bound">M</a> <a id="24135" href="/Denotational/#18196" class="Function Operator">≃</a> <a id="24137" href="/Denotational/#17998" class="Function">ℰ</a> <a id="24139" class="Symbol">(</a><a id="24140" href="/Untyped/#4238" class="InductiveConstructor Operator">ƛ</a> <a id="24142" href="/Soundness/#24077" class="Bound">N</a><a id="24143" class="Symbol">)</a>
<a id="24145" href="/Soundness/#24047" class="Function">soundness</a> <a id="24155" class="Symbol">(</a><a id="24156" class="DottedPattern Symbol">.(</a><a id="24158" href="/Untyped/#4238" class="DottedPattern InductiveConstructor Operator">ƛ</a> <a id="24160" class="DottedPattern Symbol">_)</a> <a id="24163" href="/LambdaReduction/#944" class="InductiveConstructor Operator">[]</a><a id="24165" class="Symbol">)</a> <a id="24167" href="/Soundness/#24167" class="Bound">γ</a> <a id="24169" href="/Soundness/#24169" class="Bound">v</a> <a id="24171" class="Symbol">=</a> <a id="24173" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟨</a> <a id="24175" class="Symbol">(λ</a> <a id="24178" href="/Soundness/#24178" class="Bound">x</a> <a id="24180" class="Symbol">→</a> <a id="24182" href="/Soundness/#24178" class="Bound">x</a><a id="24183" class="Symbol">)</a> <a id="24185" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">,</a> <a id="24187" class="Symbol">(λ</a> <a id="24190" href="/Soundness/#24190" class="Bound">x</a> <a id="24192" class="Symbol">→</a> <a id="24194" href="/Soundness/#24190" class="Bound">x</a><a id="24195" class="Symbol">)</a> <a id="24197" href="https://agda.github.io/agda-stdlib/v0.17/Agda.Builtin.Sigma.html#139" class="InductiveConstructor Operator">⟩</a>
<a id="24199" href="/Soundness/#24047" class="Function">soundness</a> <a id="24209" class="Symbol">{</a><a id="24210" href="/Soundness/#24210" class="Bound">Γ</a><a id="24211" class="Symbol">}</a> <a id="24213" class="Symbol">(</a><a id="24214" href="/Soundness/#24214" class="Bound">L</a> <a id="24216" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">—→⟨</a> <a id="24220" href="/Soundness/#24220" class="Bound">r</a> <a id="24222" href="/LambdaReduction/#1001" class="InductiveConstructor Operator">⟩</a> <a id="24224" href="/Soundness/#24224" class="Bound">M—↠N</a><a id="24228" class="Symbol">)</a> <a id="24230" href="/Soundness/#24230" class="Bound">γ</a> <a id="24232" href="/Soundness/#24232" class="Bound">v</a> <a id="24234" class="Symbol">=</a>
   <a id="24239" class="Keyword">let</a> <a id="24243" href="/Soundness/#24243" class="Bound">ih</a> <a id="24246" class="Symbol">=</a> <a id="24248" href="/Soundness/#24047" class="Function">soundness</a> <a id="24258" href="/Soundness/#24224" class="Bound">M—↠N</a> <a id="24263" class="Keyword">in</a>
   <a id="24269" class="Keyword">let</a> <a id="24273" href="/Soundness/#24273" class="Bound">e</a> <a id="24275" class="Symbol">=</a> <a id="24277" href="/Soundness/#23697" class="Function">reduce-equal</a> <a id="24290" href="/Soundness/#24220" class="Bound">r</a> <a id="24292" class="Keyword">in</a>
   <a id="24298" href="/Denotational/#18617" class="Function">≃-trans</a> <a id="24306" class="Symbol">{</a><a id="24307" href="/Soundness/#24210" class="Bound">Γ</a><a id="24308" class="Symbol">}</a> <a id="24310" href="/Soundness/#24273" class="Bound">e</a> <a id="24312" href="/Soundness/#24243" class="Bound">ih</a> <a id="24315" href="/Soundness/#24230" class="Bound">γ</a> <a id="24317" href="/Soundness/#24232" class="Bound">v</a></pre>

<h2 id="unicode">Unicode</h2>

<p>This chapter uses the following unicode:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>≟  U+225F  QUESTIONED EQUAL TO (\?=)
</code></pre></div></div>

  </div>

  <p style="text-align:center;">
    
    <a alt="Previous chapter" href="/Compositional/">Prev</a>
    &bullet;
    
    
    <a alt="Source code" href="https://github.com/plfa/plfa.github.io/blob/dev/src/plfa/Soundness.lagda">Source</a>
    
    
    &bullet;
    <a alt="Next chapter" href="/Adequacy/">Next</a>
    
</p>


</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Programming Language Foundations in Agda
</h2><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Philip Wadler</li>
          <li><a class="u-email" href="mailto:wadler@inf.ed.ac.uk">wadler@inf.ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wadler"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wadler</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div><div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Wen Kokke</li>
          <li><a class="u-email" href="mailto:wen.kokke@ed.ac.uk">wen.kokke@ed.ac.uk</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">wenkokke</span></a></li><li><a href="https://www.twitter.com/wenkokke"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">wenkokke</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3"></div>
    </div>This work is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>
  </div>
</footer>
<!-- Import jQuery -->
<script type="text/javascript" src="/assets/jquery.js"></script>

<!-- Script which allows for foldable code blocks -->
<script type="text/javascript">
 $('div.foldable pre').each(function(){
     var autoHeight = $(this).height();
     var lineHeight = parseFloat($(this).css('line-height'));

     var plus    = $("<div></div>");
     var horLine = $("<div></div>");
     var verLine = $("<div></div>");
     $(this).prepend(plus);
     plus.css({
         'position'         : 'relative',
         'float'            : 'right',
         'right'            : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'width'            : lineHeight,
         'height'           : lineHeight});
     verLine.css({
         'position'         : 'relative',
         'height'           : lineHeight,
         'width'            : '3px',
         'background-color' : '#C1E0FF'});
     horLine.css({
         'position'         : 'relative',
         'top'              : '-' + (0.5 * lineHeight + 1.5) + 'px',
         'left'             : '-' + (0.5 * lineHeight - 1.5) + 'px',
         'height'           : '3px',
         'width'            : lineHeight,
         'background-color' : '#C1E0FF'});
     plus.append(verLine);
     plus.append(horLine);

     $(this).height(2.0 * lineHeight);
     $(this).css('overflow','hidden');

     $(this).click(function(){
         if ($(this).height() == autoHeight) {
             $(this).height(2.0 * lineHeight);
             plus.show();
         }
         else {
             $(this).height('auto');
             plus.hide();
         }
     });
 });
</script>

<!-- Import KaTeX -->
<script type="text/javascript" src="/assets/katex.js"></script>

<!-- Script which renders TeX using KaTeX -->
<script type="text/javascript">
 $("script[type='math/tex']").replaceWith(
     function(){
         var tex = $(this).text();
         return "<span class=\"inline-equation\">" +
                katex.renderToString(tex) +
                "</span>";
     });
 $("script[type='math/tex; mode=display']").replaceWith(
     function(){
         var tex = $(this).text().replace(/%.*?(\n|$)/g,"");
         return "<div class=\"equation\">" +
                katex.renderToString("\\displaystyle "+tex) +
                "</div>";
     });
</script>
</body>

</html>
